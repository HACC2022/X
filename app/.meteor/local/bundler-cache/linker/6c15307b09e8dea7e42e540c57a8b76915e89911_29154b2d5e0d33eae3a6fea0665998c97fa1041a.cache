[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar Random = Package.random.Random;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar meteorInstall = Package.modules.meteorInstall;\nvar Promise = Package.promise.Promise;\n\n/* Package-scope variables */\nvar getClientArchVersion, Kadira, Monti, BaseErrorModel, Retry, Ntp, getBrowserInfo, getResolution, getErrorStack, getInfoArray, getTime, getClientArch, checkSizeAndPickFields, httpRequest, ErrorModel;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"montiapm:agent\":{\"lib\":{\"common\":{\"utils.js\":function module(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/common/utils.js                                                                       //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nmodule.export({\n  getErrorParameters: () => getErrorParameters\n});\n\ngetClientArchVersion = function (arch) {\n  const autoupdate = __meteor_runtime_config__.autoupdate;\n\n  if (autoupdate) {\n    return autoupdate.versions[arch] ? autoupdate.versions[arch].version : 'none';\n  } // Meteor 1.7 and older did not have an `autoupdate` object.\n\n\n  switch (arch) {\n    case 'cordova.web':\n      return __meteor_runtime_config__.autoupdateVersionCordova;\n\n    case 'web.browser':\n    case 'web.browser.legacy':\n      // Meteor 1.7 always used the web.browser.legacy version\n      return __meteor_runtime_config__.autoupdateVersion;\n\n    default:\n      return 'none';\n  }\n};\n\nconst createStackTrace = () => {\n  if (Error.captureStackTrace) {\n    let err = {};\n    Error.captureStackTrace(err, Kadira.trackError);\n    return err.stack;\n  }\n\n  const stack = new Error().stack.split('\\n');\n  let toRemove = 0; // Remove frames starting from when trackError was called\n\n  for (; toRemove < stack.length; toRemove++) {\n    if (stack[toRemove].indexOf('trackError') > -1) {\n      toRemove += 1;\n      break;\n    }\n  }\n\n  return stack.slice(toRemove).join('\\n');\n};\n\nconst getErrorParameters = function (args) {\n  let type = null;\n  let message = null;\n  let subType = null;\n  let stack = null;\n\n  if (!(args[0] instanceof Error) && typeof args[0] === 'string' && typeof args[1] === 'string') {\n    // Old usage:\n    // Monti.trackError(\n    //   'type', 'error message', { stacks: 'error stack', subType: 'sub type }\n    // );\n    const options = args[2] || {};\n    type = args[0];\n    subType = Meteor.isClient ? args[0] : options.subType;\n    message = args[1];\n    stack = options.stacks || createStackTrace();\n  } else {\n    // New usage:\n    // Monti.trackError(error, { type: 'type', subType: 'subType' });\n    const error = args[0];\n    const options = args[1] || {};\n    const isErrorObject = typeof error === 'object' && error !== null;\n    message = isErrorObject ? error.message : error;\n    stack = isErrorObject && error.stack || createStackTrace();\n    type = options.type;\n    subType = options.subType;\n  }\n\n  return {\n    type,\n    message,\n    subType,\n    stack\n  };\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"unify.js\":function module(require){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/common/unify.js                                                                       //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nKadira = {};\nKadira.options = {};\nMonti = Kadira;\n\nif (Meteor.wrapAsync) {\n  Kadira._wrapAsync = Meteor.wrapAsync;\n} else {\n  Kadira._wrapAsync = Meteor._wrapAsync;\n}\n\nif (Meteor.isServer) {\n  var EventEmitter = Npm.require('events').EventEmitter;\n\n  var eventBus = new EventEmitter();\n  eventBus.setMaxListeners(0);\n\n  var buildArgs = function (args) {\n    var eventName = args[0] + '-' + args[1];\n    var args = args.slice(2);\n    args.unshift(eventName);\n    return args;\n  };\n\n  Kadira.EventBus = {};\n  ['on', 'emit', 'removeListener', 'removeAllListeners'].forEach(function (m) {\n    Kadira.EventBus[m] = function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var args = buildArgs(args);\n      return eventBus[m].apply(eventBus, args);\n    };\n  });\n}\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"default_error_filters.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/common/default_error_filters.js                                                       //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nvar commonErrRegExps = [/connection timeout\\. no (\\w*) heartbeat received/i, /INVALID_STATE_ERR/i];\nKadira.errorFilters = {\n  filterValidationErrors: function (type, message, err) {\n    if (err && err instanceof Meteor.Error) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n  filterCommonMeteorErrors: function (type, message) {\n    for (var lc = 0; lc < commonErrRegExps.length; lc++) {\n      var regExp = commonErrRegExps[lc];\n\n      if (regExp.test(message)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"send.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/common/send.js                                                                        //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nKadira.send = function (payload, path, callback) {\n  if (!Kadira.connected) {\n    throw new Error(\"You need to connect with Kadira first, before sending messages!\");\n  }\n\n  path = path.substr(0, 1) != '/' ? \"/\" + path : path;\n  var endpoint = Kadira.options.endpoint + path;\n  var retryCount = 0;\n  var retry = new Retry({\n    minCount: 1,\n    minTimeout: 0,\n    baseTimeout: 1000 * 5,\n    maxTimeout: 1000 * 60\n  });\n\n  var sendFunction = Kadira._getSendFunction();\n\n  tryToSend();\n\n  function tryToSend(err) {\n    if (retryCount < 5) {\n      retry.retryLater(retryCount++, send);\n    } else {\n      console.warn('Error sending error traces to Monti APM server');\n      if (callback) callback(err);\n    }\n  }\n\n  function send() {\n    sendFunction(endpoint, payload, function (err, res) {\n      if (err && !res) {\n        tryToSend(err);\n      } else if (res.statusCode == 200) {\n        if (callback) callback(null, res.data);\n      } else {\n        if (callback) callback(new Meteor.Error(res.statusCode, res.content));\n      }\n    });\n  }\n};\n\nKadira._getSendFunction = function () {\n  return Meteor.isServer ? Kadira._serverSend : Kadira._clientSend;\n};\n\nKadira._clientSend = function (endpoint, payload, callback) {\n  httpRequest('POST', endpoint, {\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    content: JSON.stringify(payload)\n  }, callback);\n};\n\nKadira._serverSend = function () {\n  throw new Error('Kadira._serverSend is not supported. Use coreApi instead.');\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"models\":{\"base_error.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/models/base_error.js                                                                  //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nBaseErrorModel = function (options) {\n  this._filters = [];\n};\n\nBaseErrorModel.prototype.addFilter = function (filter) {\n  if (typeof filter === 'function') {\n    this._filters.push(filter);\n  } else {\n    throw new Error(\"Error filter must be a function\");\n  }\n};\n\nBaseErrorModel.prototype.removeFilter = function (filter) {\n  var index = this._filters.indexOf(filter);\n\n  if (index >= 0) {\n    this._filters.splice(index, 1);\n  }\n};\n\nBaseErrorModel.prototype.applyFilters = function (type, message, error, subType) {\n  for (var lc = 0; lc < this._filters.length; lc++) {\n    var filter = this._filters[lc];\n\n    try {\n      var validated = filter(type, message, error, subType);\n      if (!validated) return false;\n    } catch (ex) {\n      // we need to remove this filter\n      // we may ended up in a error cycle\n      this._filters.splice(lc, 1);\n\n      throw new Error(\"an error thrown from a filter you've suplied\", ex.message);\n    }\n  }\n\n  return true;\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"retry.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/retry.js                                                                              //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\n// Retry logic with an exponential backoff.\n//\n// options:\n//  baseTimeout: time for initial reconnect attempt (ms).\n//  exponent: exponential factor to increase timeout each attempt.\n//  maxTimeout: maximum time between retries (ms).\n//  minCount: how many times to reconnect \"instantly\".\n//  minTimeout: time to wait for the first `minCount` retries (ms).\n//  fuzz: factor to randomize retry times by (to avoid retry storms).\n//TODO: remove this class and use Meteor Retry in a later version of meteor.\nRetry = class {\n  constructor() {\n    let {\n      baseTimeout = 1000,\n      // 1 second\n      exponent = 2.2,\n      // The default is high-ish to ensure a server can recover from a\n      // failure caused by load.\n      maxTimeout = 5 * 60000,\n      // 5 minutes\n      minTimeout = 10,\n      minCount = 2,\n      fuzz = 0.5 // +- 25%\n\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.baseTimeout = baseTimeout;\n    this.exponent = exponent;\n    this.maxTimeout = maxTimeout;\n    this.minTimeout = minTimeout;\n    this.minCount = minCount;\n    this.fuzz = fuzz;\n    this.retryTimer = null;\n  } // Reset a pending retry, if any.\n\n\n  clear() {\n    if (this.retryTimer) clearTimeout(this.retryTimer);\n    this.retryTimer = null;\n  } // Calculate how long to wait in milliseconds to retry, based on the\n  // `count` of which retry this is.\n\n\n  _timeout(count) {\n    if (count < this.minCount) return this.minTimeout;\n    let timeout = Math.min(this.maxTimeout, this.baseTimeout * Math.pow(this.exponent, count)); // fuzz the timeout randomly, to avoid reconnect storms when a\n    // server goes down.\n\n    timeout = timeout * (Random.fraction() * this.fuzz + (1 - this.fuzz / 2));\n    return Math.ceil(timeout);\n  } // Call `fn` after a delay, based on the `count` of which retry this is.\n\n\n  retryLater(count, fn) {\n    const timeout = this._timeout(count);\n\n    if (this.retryTimer) clearTimeout(this.retryTimer);\n    this.retryTimer = setTimeout(fn, timeout);\n    return timeout;\n  }\n\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"ntp.js\":function module(require){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/ntp.js                                                                                //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nvar logger = getLogger();\n\nNtp = function (endpoint) {\n  this.path = '/simplentp/sync';\n  this.setEndpoint(endpoint);\n  this.diff = 0;\n  this.synced = false;\n  this.reSyncCount = 0;\n  this.reSync = new Retry({\n    baseTimeout: 1000 * 60,\n    maxTimeout: 1000 * 60 * 10,\n    minCount: 0\n  });\n};\n\nNtp._now = function () {\n  var now = Date.now();\n\n  if (typeof now == 'number') {\n    return now;\n  } else if (now instanceof Date) {\n    // some extenal JS libraries override Date.now and returns a Date object\n    // which directly affect us. So we need to prepare for that\n    return now.getTime();\n  } else {\n    // trust me. I've seen now === undefined\n    return new Date().getTime();\n  }\n};\n\nNtp.prototype.setEndpoint = function (endpoint) {\n  this.endpoint = endpoint ? endpoint + this.path : null;\n};\n\nNtp.prototype.getTime = function () {\n  return Ntp._now() + Math.round(this.diff);\n};\n\nNtp.prototype.syncTime = function (localTime) {\n  return localTime + Math.ceil(this.diff);\n};\n\nNtp.prototype.sync = function () {\n  if (this.endpoint === null) {\n    return;\n  }\n\n  logger('init sync');\n  var self = this;\n  var retryCount = 0;\n  var retry = new Retry({\n    baseTimeout: 1000 * 20,\n    maxTimeout: 1000 * 60,\n    minCount: 1,\n    minTimeout: 0\n  });\n  syncTime();\n\n  function syncTime() {\n    if (retryCount < 5) {\n      logger('attempt time sync with server', retryCount); // if we send 0 to the retryLater, cacheDns will run immediately\n\n      retry.retryLater(retryCount++, cacheDns);\n    } else {\n      logger('maximum retries reached');\n      self.reSync.retryLater(self.reSyncCount++, function () {\n        var args = [].slice.call(arguments);\n        self.sync.apply(self, args);\n      });\n    }\n  } // first attempt is to cache dns. So, calculation does not\n  // include DNS resolution time\n\n\n  function cacheDns() {\n    self.getServerTime(function (err) {\n      if (!err) {\n        calculateTimeDiff();\n      } else {\n        syncTime();\n      }\n    });\n  }\n\n  function calculateTimeDiff() {\n    var clientStartTime = new Date().getTime();\n    self.getServerTime(function (err, serverTime) {\n      if (!err && serverTime) {\n        // (Date.now() + clientStartTime)/2 : Midpoint between req and res\n        var networkTime = (new Date().getTime() - clientStartTime) / 2;\n        var serverStartTime = serverTime - networkTime;\n        self.diff = serverStartTime - clientStartTime;\n        self.synced = true; // we need to send 1 into retryLater.\n\n        self.reSync.retryLater(self.reSyncCount++, function () {\n          var args = [].slice.call(arguments);\n          self.sync.apply(self, args);\n        });\n        logger('successfully updated diff value', self.diff);\n      } else {\n        syncTime();\n      }\n    });\n  }\n};\n\nNtp.prototype.getServerTime = function (callback) {\n  var self = this;\n\n  if (self.endpoint === null) {\n    throw new Error('getServerTime requires the endpoint to be set');\n  }\n\n  if (Meteor.isServer) {\n    Kadira.coreApi.get(self.path, {\n      noRetries: true\n    }).then(content => {\n      var serverTime = parseInt(content);\n      callback(null, serverTime);\n    }).catch(err => {\n      callback(err);\n    });\n  } else {\n    httpRequest('GET', self.endpoint + \"?noCache=\".concat(new Date().getTime(), \"-\").concat(Math.random()), function (err, res) {\n      if (err) {\n        callback(err);\n      } else {\n        var serverTime = parseInt(res.content);\n        callback(null, serverTime);\n      }\n    });\n  }\n};\n\nfunction getLogger() {\n  if (Meteor.isServer) {\n    return Npm.require('debug')(\"kadira:ntp\");\n  } else {\n    return function (message) {\n      try {\n        var canLogKadira = global.localStorage.getItem('LOG_KADIRA') !== null && typeof console !== 'undefined';\n      } catch (e) {} //older browsers can sometimes throw because of getItem\n\n\n      if (canLogKadira) {\n        if (message) {\n          message = \"kadira:ntp \" + message;\n          arguments[0] = message;\n        }\n\n        console.log.apply(console, arguments);\n      }\n    };\n  }\n}\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"client\":{\"utils.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/utils.js                                                                       //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\ngetBrowserInfo = function () {\n  return {\n    browser: window.navigator.userAgent,\n    userId: Meteor.userId && Meteor.userId(),\n    url: location.href,\n    resolution: getResolution(),\n    clientArch: getClientArch()\n  };\n};\n\ngetResolution = function () {\n  if (screen && screen.width && screen.height) {\n    var resolution = screen.width + 'x' + screen.height;\n    return resolution;\n  }\n};\n\nconst toArray = function () {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return args;\n};\n\ngetErrorStack = function (zone, callback) {\n  var trace = [];\n  var eventMap = zone.eventMap || {};\n  var infoMap = zone.infoMap || {};\n  trace.push({\n    at: new Date().getTime(),\n    stack: zone.erroredStack.get()\n  });\n  processZone();\n\n  function processZone() {\n    // we assume, first two zones are not interesting\n    // bacause, they are some internal meteor loading stuffs\n    if (zone && zone.depth > 2) {\n      var stack = \"\";\n\n      if (zone.currentStack) {\n        stack = zone.currentStack.get();\n      }\n\n      var events = eventMap[zone.id] || [];\n      var info = getInfoArray(infoMap[zone.id]);\n      var ownerArgsEvent = events && events[0] && events[0].type == 'owner-args' && events.shift();\n      var runAt = ownerArgsEvent ? ownerArgsEvent.at : zone.runAt;\n      var ownerArgs = ownerArgsEvent ? toArray.apply(null, ownerArgsEvent.args) : []; // limiting\n\n      events = events.slice(-5).map(checkSizeAndPickFields(100));\n      info = info.slice(-5).map(checkSizeAndPickFields(100));\n      ownerArgs = checkSizeAndPickFields(200)(ownerArgs.slice(0, 5));\n      zone.owner && delete zone.owner.zoneId;\n      trace.push({\n        createdAt: zone.createdAt,\n        runAt: runAt,\n        stack: stack,\n        owner: zone.owner,\n        ownerArgs: ownerArgs,\n        events: events,\n        info: info,\n        zoneId: zone.id\n      });\n      zone = zone.parent;\n      setTimeout(processZone, 0);\n    } else {\n      callback(trace);\n    }\n  }\n};\n\ngetInfoArray = function () {\n  let info = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return Object.keys(info).map(function (key, type) {\n    const value = info[key];\n    value.type = type;\n    return value;\n  });\n};\n\ngetTime = function () {\n  if (Kadira && Kadira.syncedDate) {\n    return Kadira.syncedDate.getTime();\n  } else {\n    return new Date().getTime();\n  }\n};\n\ngetClientArch = function () {\n  if (Meteor.isCordova) {\n    return 'cordova.web';\n  } else if (typeof Meteor.isModern === 'undefined' || Meteor.isModern) {\n    return 'web.browser';\n  } else {\n    return 'web.browser.legacy';\n  }\n};\n\ncheckSizeAndPickFields = function (maxFieldSize) {\n  return function (obj) {\n    maxFieldSize = maxFieldSize || 100;\n\n    for (var key in obj) {\n      var value = obj[key];\n\n      try {\n        var valueStringified = JSON.stringify(value);\n\n        if (valueStringified.length > maxFieldSize) {\n          obj[key] = valueStringified.substr(0, maxFieldSize) + \" ...\";\n        } else {\n          obj[key] = value;\n        }\n      } catch (ex) {\n        obj[key] = 'Error: cannot stringify value';\n      }\n    }\n\n    return obj;\n  };\n};\n\nhttpRequest = function (method, url, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  /**\n   * IE8 and IE9 does not support CORS with the usual XMLHttpRequest object\n   * If XDomainRequest exists, use it to send errors.\n   * XDR can POST data to HTTPS endpoints only if current page uses HTTPS\n   */\n\n\n  if (window.XDomainRequest) {\n    var xdr = new XDomainRequest();\n    url = matchPageProtocol(url);\n\n    xdr.onload = function () {\n      var headers = {\n        'Content-Type': xdr.contentType\n      };\n      var data = {};\n\n      try {\n        data = JSON.parse(xdr.responseText);\n      } catch (e) {}\n\n      callback(null, {\n        content: xdr.responseText,\n        data: data,\n        headers: headers,\n        statusCode: 200\n      });\n    };\n\n    xdr.onerror = function () {\n      callback({\n        statusCode: 404\n      });\n    };\n\n    xdr.onprogress = function () {// onprogress must be set. Otherwise, ie doesn't handle duplicate requests\n      // correctly.\n    };\n\n    xdr.open(method, url);\n    setTimeout(() => {\n      var content = options.content;\n\n      if (typeof content === 'object') {\n        content = JSON.stringify(content);\n      } // delaying send fixes issues when multiple xdr requests are made\n      // at the same time.\n\n\n      xdr.send(options.content || null);\n    }, 0);\n\n    function matchPageProtocol(endpoint) {\n      var withoutProtocol = endpoint.substr(endpoint.indexOf(':') + 1);\n      return window.location.protocol + withoutProtocol;\n    }\n  } else {\n    // Based on Meteor's HTTP package. Uses XMLHttpRequest\n    var content = options.content; // wrap callback to add a 'response' property on an error, in case\n    // we have both (http 4xx/5xx error, which has a response payload)\n\n    callback = function (callback) {\n      var called = false;\n      return function (error, response) {\n        if (!called) {\n          called = true;\n\n          if (error && response) {\n            error.response = response;\n          }\n\n          callback(error, response);\n        }\n      };\n    }(callback);\n\n    try {\n      if (typeof XMLHttpRequest === \"undefined\") {\n        throw new Error(\"Can't create XMLHttpRequest\");\n      }\n\n      var xhr = new XMLHttpRequest();\n      xhr.open(method, url, true);\n\n      if (options.headers) {\n        Object.keys(options.headers).forEach(function (key) {\n          xhr.setRequestHeader(key, options.headers[key]);\n        });\n      }\n\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 4) {\n          // COMPLETE\n          if (!xhr.status) {\n            // no HTTP response\n            callback(new Error(\"Connection lost\"));\n          } else {\n            var response = {};\n            response.statusCode = xhr.status;\n            response.content = xhr.responseText; // Read Content-Type header, up to a ';' if there is one.\n            // A typical header might be \"application/json; charset=utf-8\"\n            // or just \"application/json\".\n\n            var contentType = (xhr.getResponseHeader('content-type') || ';').split(';')[0]; // Only try to parse data as JSON if server sets correct content type.\n\n            if (['application/json', 'text/javascript', 'application/javascript', 'application/x-javascript'].indexOf(contentType) >= 0) {\n              try {\n                response.data = JSON.parse(response.content);\n              } catch (err) {\n                response.data = null;\n              }\n            } else {\n              response.data = null;\n            }\n\n            var error = null;\n\n            if (response.statusCode >= 400) {\n              var message = \"failed [\" + response.statusCode + \"]\";\n\n              if (response.content) {\n                var stringContent = typeof response.content == \"string\" ? response.content : response.content.toString();\n                stringContent = stringContent.replace(/\\n/g, ' ');\n                stringContent = stringContent.length > 500 ? stringContent.slice(0, length) + '...' : stringContent;\n                message += ' ' + stringContent;\n              }\n\n              error = new Error(message);\n            }\n\n            callback(error, response);\n          }\n        }\n      };\n\n      xhr.send(content);\n    } catch (err) {\n      callback(err);\n    }\n  }\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"models\":{\"errors.js\":function module(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/models/errors.js                                                               //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\n\nErrorModel = function (options) {\n  BaseErrorModel.call(this);\n  options = options || {};\n  options.maxErrorsPerInterval = options.maxErrorsPerInterval || 10;\n  options.intervalInMillis = options.intervalInMillis || 1000 * 60 * 2; //2 mins\n\n  options.waitForNtpSyncInterval = options.waitForNtpSyncInterval || 0;\n  var self = this;\n  self.options = options; // errorsSentCount will be reseted at the start of the interval\n\n  self.errorsSentCount = 0;\n  self.errorsSent = Object.create(null);\n  self.intervalTimeoutHandler = setInterval(function () {\n    self.errorsSentCount = 0;\n\n    self._flushErrors();\n  }, self.options.intervalInMillis);\n};\n\nObject.assign(ErrorModel.prototype, BaseErrorModel.prototype);\n\nErrorModel.prototype.sendError = function (errorDef, err, force) {\n  var self = this;\n\n  if (!this.applyFilters('client', errorDef.name, err, errorDef.subType)) {\n    return;\n  }\n\n  ;\n\n  if (!this.canSendErrors()) {\n    // reached maximum error count for this interval (1 min)\n    return;\n  }\n\n  if (force) {\n    sendError();\n  } else {\n    if (Kadira.syncedDate.synced || self.options.waitForNtpSyncInterval == 0) {\n      sendError();\n    } else {\n      setTimeout(forceSendError, self.options.waitForNtpSyncInterval);\n    }\n  }\n\n  function forceSendError() {\n    self.sendError(errorDef, err, true);\n  }\n\n  function sendError() {\n    if (!self.errorsSent[errorDef.name]) {\n      // sync time with the server\n      if (errorDef.startTime) {\n        errorDef.startTime = Kadira.syncedDate.syncTime(errorDef.startTime);\n      }\n\n      errorDef.count = 1;\n\n      var payload = self._buildPayload([errorDef]);\n\n      Kadira.send(payload, '/errors');\n      self.errorsSent[errorDef.name] = _objectSpread({}, errorDef);\n      self.errorsSent[errorDef.name].count = 0;\n      self.errorsSentCount++;\n    } else {\n      self.increamentErrorCount(errorDef.name);\n    }\n  }\n};\n\nErrorModel.prototype._buildPayload = function (errors) {\n  var arch = getClientArch();\n  return {\n    host: Kadira.options.hostname,\n    recordIPAddress: Kadira.options.recordIPAddress,\n    errors: errors,\n    arch: arch,\n    archVersion: getClientArchVersion(arch)\n  };\n};\n\nErrorModel.prototype._flushErrors = function () {\n  const errors = Object.values(this.errorsSent).filter(e => e.count > 0);\n\n  if (errors.length > 0) {\n    Kadira.send(this._buildPayload(errors), '/errors');\n  }\n\n  this.errorsSent = Object.create(null);\n};\n\nErrorModel.prototype.isErrorExists = function (name) {\n  return !!this.errorsSent[name];\n};\n\nErrorModel.prototype.increamentErrorCount = function (name) {\n  var error = this.errorsSent[name];\n\n  if (error) {\n    error.count++;\n  }\n};\n\nErrorModel.prototype.canSendErrors = function () {\n  return this.errorsSentCount < this.options.maxErrorsPerInterval;\n};\n\nErrorModel.prototype.close = function () {\n  clearTimeout(this.intervalTimeoutHandler);\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"error_reporters\":{\"zone.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/error_reporters/zone.js                                                        //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nif (window.Zone && Zone.inited) {\n  Zone.Reporters.add('kadira', kadiraZoneReporter);\n}\n\nfunction kadiraZoneReporter(zone) {\n  // track only if error tracking is enabled\n  if (!Kadira.options.enableErrorTracking) {\n    return;\n  }\n\n  var errorName = Zone.Reporters.getErrorMessage(zone.erroredStack._e);\n\n  if (Kadira.errors.isErrorExists(errorName)) {\n    Kadira.errors.increamentErrorCount(errorName);\n  } else if (Kadira.errors.canSendErrors()) {\n    getErrorStack(zone, function (stacks) {\n      Kadira.errors.sendError({\n        appId: Kadira.options.appId,\n        name: errorName,\n        type: 'client',\n        startTime: zone.runAt,\n        subType: 'zone',\n        info: getBrowserInfo(),\n        stacks: JSON.stringify(stacks)\n      });\n    });\n  }\n}\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"window_error.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/error_reporters/window_error.js                                                //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nvar prevWindowOnError = window.onerror || Function.prototype;\n\nfunction handleOnError(message, url, line, col, error) {\n  // track only if error tracking is enabled\n  if (!Kadira.options.enableErrorTracking) {\n    return prevWindowOnError(message, url, line, col, error);\n  }\n\n  url = url || '<anonymous>';\n  line = line || 0;\n  col = col || 0;\n\n  if (error) {\n    var stack = error.stack;\n  } else {\n    var stack = 'Error:\\n    at window.onerror (' + url + ':' + line + ':' + col + ')';\n  }\n\n  var now = new Date().getTime();\n  Kadira.errors.sendError({\n    appId: Kadira.options.appId,\n    name: message,\n    type: 'client',\n    startTime: now,\n    subType: 'window.onerror',\n    info: getBrowserInfo(),\n    _internalDetails: {\n      origError: {\n        message,\n        url,\n        line,\n        col,\n        error\n      }\n    },\n    stacks: JSON.stringify([{\n      at: now,\n      events: [],\n      stack: stack\n    }])\n  });\n  return prevWindowOnError(message, url, line, col, error);\n  ;\n}\n\nKadira._setupOnErrorReporter = function setupOnError() {\n  if (window.onerror !== handleOnError) {\n    prevWindowOnError = window.onerror || prevWindowOnError;\n    window.onerror = handleOnError;\n  }\n};\n\nKadira._setupOnErrorReporter();\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"meteor_debug.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/error_reporters/meteor_debug.js                                                //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nvar originalMeteorDebug = Meteor._debug;\nlet lastMessageToIgnore = null;\nlet messagesToIgnore = 0; // Sometimes one of the other error reporter tracks an error, but Meteor also\n// sends the details to Meteor._debug. In some places, Meteor splits the\n// information across multiple Meteor._debug calls.\n//\n// Does not report Meteor._debug errors until it sees the given message\n// or it has ignored maxMessages.\n\nKadira._ignoreDebugMessagesUntil = function (message, maxMessages) {\n  lastMessageToIgnore = message;\n  messagesToIgnore = maxMessages;\n};\n\nMeteor._debug = function (m, s) {\n  // We need to assign variables like this. Otherwise, \n  // we can't see proper error messages.\n  // See: https://github.com/meteorhacks/kadira/issues/193\n  var message = m;\n  var stack = s;\n  var args = arguments;\n\n  function runOriginal() {\n    return originalMeteorDebug.apply(Meteor, args);\n  } // track only if error tracking is enabled\n\n\n  if (!Kadira.options.enableErrorTracking) {\n    return runOriginal();\n  } // do not track if a zone is available (let zone handle the error)\n\n\n  if (window.zone) {\n    return runOriginal();\n  } // Do not report messages until either we see the\n  // lastMessageToIgnore or we have ignored the number of\n  // messages in messagesToIgnore\n\n\n  if (lastMessageToIgnore) {\n    if (message === lastMessageToIgnore || messagesToIgnore === 1) {\n      lastMessageToIgnore = null;\n      messagesToIgnore = 0;\n    } else {\n      messagesToIgnore -= 1;\n    }\n\n    return runOriginal();\n  } // We hate Meteor._debug (no single usage pattern)\n\n\n  if (message instanceof Error) {\n    stack = message.stack;\n    message = message.message;\n  } else if (typeof message == 'string' && stack === undefined) {\n    stack = getStackFromMessage(message);\n    message = firstLine(message);\n  } else if (typeof message == 'string' && stack instanceof Error) {\n    const separator = message.endsWith(':') ? '' : ':';\n    message = \"\".concat(message).concat(separator, \" \").concat(stack.message);\n    stack = getStackFromMessage(stack.stack);\n  } // sometimes Meteor._debug is called with the stack concat to the message\n  // FIXME Meteor._debug can be called in many ways\n\n\n  if (message && stack === undefined) {\n    stack = getStackFromMessage(message);\n    message = firstLine(message);\n  }\n\n  var now = new Date().getTime();\n  Kadira.errors.sendError({\n    appId: Kadira.options.appId,\n    name: message,\n    type: 'client',\n    startTime: now,\n    subType: 'meteor._debug',\n    info: getBrowserInfo(),\n    stacks: JSON.stringify([{\n      at: now,\n      events: [],\n      stack: stack\n    }])\n  });\n  return runOriginal();\n}; // Identifies lines that are a stack trace frame:\n// 1. Has \"at\" proceeded and followed by at least one space\n// 2. Or has an \"@\" symbol\n\n\nvar stackRegex = /(^.*@.*$|^\\s+at\\s.+$)/gm;\n\nfunction getStackFromMessage(message) {\n  // add empty string to add the empty line at start\n  var stack = [''];\n  var match;\n\n  while (match = stackRegex.exec(message)) {\n    stack.push(match[0]);\n  }\n\n  return stack.join('\\n');\n}\n\nfunction firstLine(message) {\n  return message.split('\\n')[0];\n}\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"unhandled_rejection.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/error_reporters/unhandled_rejection.js                                         //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nwindow.addEventListener(\"unhandledrejection\", function (e) {\n  if (!Kadira.options.enableErrorTracking) {\n    return;\n  }\n\n  var message = e.reason;\n  var stack = '';\n\n  if (typeof message === 'object' && message !== null) {\n    stack = message.stack;\n    message = message.message;\n  }\n\n  var now = new Date().getTime();\n  Kadira.errors.sendError({\n    appId: Kadira.options.appId,\n    name: message,\n    type: 'client',\n    startTime: now,\n    subType: 'window.onunhandledrejection',\n    info: getBrowserInfo(),\n    _internalDetails: {\n      origError: {\n        reason: e.reason\n      }\n    },\n    stacks: JSON.stringify([{\n      at: now,\n      events: [],\n      stack: stack\n    }])\n  });\n});\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"tracker.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/error_reporters/tracker.js                                                     //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nconst origCompute = Tracker.Computation.prototype._compute;\nconst origAfterFlush = Tracker.afterFlush;\nconst origRunFlush = Tracker._runFlush; // Internal variable in the Tracker package set during Tracker._runFlush\n// If it is true, Tracker throws the error instead of using Meteor._debug\n// In that case, we should not report the error in afterFlush and\n// instead let another reporter handle it\n\nlet throwFirstError = false;\n\nTracker._runFlush = function () {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  throwFirstError = !!options.throwFirstError;\n  return origRunFlush.apply(this, arguments);\n};\n\nTracker.afterFlush = function (func) {\n  return origAfterFlush(function () {\n    try {\n      return func();\n    } catch (e) {\n      if (Kadira.options.enableErrorTracking && !throwFirstError) {\n        var message = e.message;\n        var stack = e.stack;\n        var now = new Date().getTime();\n        Kadira.errors.sendError({\n          appId: Kadira.options.appId,\n          name: message,\n          type: 'client',\n          startTime: now,\n          subType: 'tracker.afterFlush',\n          info: getBrowserInfo(),\n          stacks: JSON.stringify([{\n            at: now,\n            events: [],\n            stack\n          }])\n        }); // Once the error is thrown, Tracker will call\n        // Meteor._debug 2 or 3 times. The last time will\n        // have the stack trace.\n\n        Kadira._ignoreDebugMessagesUntil(stack, 3);\n      }\n\n      throw e;\n    }\n  });\n};\n\nTracker.Computation.prototype._compute = function () {\n  try {\n    return origCompute.apply(this, arguments);\n  } catch (e) {\n    // During the first run, Tracker throws the error\n    // It will be handled by a different error reporter\n    if (Kadira.options.enableErrorTracking && !this.firstRun) {\n      var message = e.message;\n      var stack = e.stack;\n      var now = new Date().getTime();\n      Kadira.errors.sendError({\n        appId: Kadira.options.appId,\n        name: message,\n        type: 'client',\n        startTime: now,\n        subType: 'tracker.compute',\n        info: getBrowserInfo(),\n        stacks: JSON.stringify([{\n          at: now,\n          events: [],\n          stack\n        }])\n      }); // Once the error is thrown, Tracker will call\n      // Meteor._debug 2 or 3 times. The last time will\n      // have the stack trace.\n\n      Kadira._ignoreDebugMessagesUntil(stack, 3);\n    }\n\n    throw e;\n  }\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"kadira.js\":function module(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/client/kadira.js                                                                      //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\nlet _objectSpread;\n\nmodule.link(\"@babel/runtime/helpers/objectSpread2\", {\n  default(v) {\n    _objectSpread = v;\n  }\n\n}, 0);\nlet getErrorParameters;\nmodule.link(\"../common/utils\", {\n  getErrorParameters(v) {\n    getErrorParameters = v;\n  }\n\n}, 0);\n\nKadira.enableErrorTracking = function () {\n  Kadira.options.enableErrorTracking = true;\n};\n\nKadira.disableErrorTracking = function () {\n  Kadira.options.enableErrorTracking = false;\n};\n\nKadira.trackError = function () {\n  if (!Kadira.options.enableErrorTracking) {\n    return;\n  }\n\n  const {\n    message,\n    subType,\n    stack\n  } = getErrorParameters(arguments);\n\n  if (message) {\n    var now = new Date().getTime();\n    Kadira.errors.sendError({\n      appId: Kadira.options.appId,\n      name: message,\n      startTime: now,\n      type: 'client',\n      subType: subType || 'Monti.trackError',\n      info: getBrowserInfo(),\n      stacks: JSON.stringify([{\n        at: now,\n        events: [],\n        stack\n      }])\n    });\n  }\n}; // Create new NTP object and error model immediately so it can be used\n// endpoints is set later using __meteor_runtime_config__ or publication\n\n\nKadira.syncedDate = new Ntp(null);\nKadira.errors = new ErrorModel({\n  waitForNtpSyncInterval: 1000 * 5,\n  // 5 secs\n  intervalInMillis: 1000 * 60 * 1,\n  // 1minutes\n  maxErrorsPerInterval: 5\n}); // __meteor_runtime_config__ cannot be dynamically set for cordova apps\n// using a null subscription to send required options to client\n\nif (Meteor.isCordova) {\n  var SettingsCollection = new Meteor.Collection('kadira_settings');\n  SettingsCollection.find().observe({\n    added: initialize\n  });\n} else {\n  initialize(__meteor_runtime_config__.kadira);\n}\n\nvar initialized = false;\n\nfunction initialize() {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (initialized) {\n    return;\n  }\n\n  initialized = true;\n  Kadira.options = _objectSpread({\n    errorDumpInterval: 1000 * 60,\n    maxErrorsPerInterval: 10,\n    collectAllStacks: false,\n    enableErrorTracking: false\n  }, options);\n\n  if (Kadira.options.appId && Kadira.options.endpoint) {\n    // update endpoint after receiving correct data\n    Kadira.syncedDate.setEndpoint(Kadira.options.endpoint);\n    Kadira.connected = true;\n    Meteor.startup(function () {\n      // if we don't do this this might block the initial rendering\n      // or, it will show up bottom of the page, which is not cool\n      setTimeout(function () {\n        Kadira.syncedDate.sync();\n      }, Kadira.options.clientEngineSyncDelay);\n    });\n  }\n\n  if (Kadira.connected && Kadira.options.enableErrorTracking) {\n    Kadira.enableErrorTracking();\n  }\n\n  if (window.Zone && Zone.inited) {\n    Zone.collectAllStacks = Kadira.options.collectAllStacks;\n  }\n}\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"profiler\":{\"client.js\":function module(){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                                   //\n// packages/montiapm_agent/lib/profiler/client.js                                                                    //\n//                                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                     //\n// For just making a notice\n// montiapm:profiler will override this method to add\n// actual functionality\nKadira.profileCpu = function profileCpu() {\n  var message = \"Please install montiapm:profiler\" + \" to take a CPU profile.\";\n  console.log(message);\n};\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nrequire(\"/node_modules/meteor/montiapm:agent/lib/common/utils.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/common/unify.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/models/base_error.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/retry.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/ntp.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/utils.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/models/errors.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/error_reporters/zone.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/error_reporters/window_error.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/error_reporters/meteor_debug.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/error_reporters/unhandled_rejection.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/error_reporters/tracker.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/client/kadira.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/profiler/client.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/common/default_error_filters.js\");\nrequire(\"/node_modules/meteor/montiapm:agent/lib/common/send.js\");\n\n/* Exports */\nPackage._define(\"montiapm:agent\", {\n  Kadira: Kadira,\n  Monti: Monti\n});\n\n})();\n","servePath":"/packages/montiapm_agent.js","sourceMap":{"version":3,"sources":["packages/montiapm:agent/lib/common/utils.js","packages/montiapm:agent/lib/common/unify.js","packages/montiapm:agent/lib/common/default_error_filters.js","packages/montiapm:agent/lib/common/send.js","packages/montiapm:agent/lib/models/base_error.js","packages/montiapm:agent/lib/retry.js","packages/montiapm:agent/lib/ntp.js","packages/montiapm:agent/lib/client/utils.js","packages/montiapm:agent/lib/client/models/errors.js","packages/montiapm:agent/lib/client/error_reporters/zone.js","packages/montiapm:agent/lib/client/error_reporters/window_error.js","packages/montiapm:agent/lib/client/error_reporters/meteor_debug.js","packages/montiapm:agent/lib/client/error_reporters/unhandled_rejection.js","packages/montiapm:agent/lib/client/error_reporters/tracker.js","packages/montiapm:agent/lib/client/kadira.js","packages/montiapm:agent/lib/profiler/client.js"],"names":["module","export","getErrorParameters","getClientArchVersion","arch","autoupdate","__meteor_runtime_config__","versions","version","autoupdateVersionCordova","autoupdateVersion","createStackTrace","Error","captureStackTrace","err","Kadira","trackError","stack","split","toRemove","length","indexOf","slice","join","args","type","message","subType","options","Meteor","isClient","stacks","error","isErrorObject","Monti","wrapAsync","_wrapAsync","isServer","EventEmitter","Npm","require","eventBus","setMaxListeners","buildArgs","eventName","unshift","EventBus","forEach","m","apply","commonErrRegExps","errorFilters","filterValidationErrors","filterCommonMeteorErrors","lc","regExp","test","send","payload","path","callback","connected","substr","endpoint","retryCount","retry","Retry","minCount","minTimeout","baseTimeout","maxTimeout","sendFunction","_getSendFunction","tryToSend","retryLater","console","warn","res","statusCode","data","content","_serverSend","_clientSend","httpRequest","headers","JSON","stringify","BaseErrorModel","_filters","prototype","addFilter","filter","push","removeFilter","index","splice","applyFilters","validated","ex","constructor","exponent","fuzz","retryTimer","clear","clearTimeout","_timeout","count","timeout","Math","min","pow","Random","fraction","ceil","fn","setTimeout","logger","getLogger","Ntp","setEndpoint","diff","synced","reSyncCount","reSync","_now","now","Date","getTime","round","syncTime","localTime","sync","self","cacheDns","call","arguments","getServerTime","calculateTimeDiff","clientStartTime","serverTime","networkTime","serverStartTime","coreApi","get","noRetries","then","parseInt","catch","random","canLogKadira","global","localStorage","getItem","e","log","getBrowserInfo","browser","window","navigator","userAgent","userId","url","location","href","resolution","getResolution","clientArch","getClientArch","screen","width","height","toArray","getErrorStack","zone","trace","eventMap","infoMap","at","erroredStack","processZone","depth","currentStack","events","id","info","getInfoArray","ownerArgsEvent","shift","runAt","ownerArgs","map","checkSizeAndPickFields","owner","zoneId","createdAt","parent","Object","keys","key","value","syncedDate","isCordova","isModern","maxFieldSize","obj","valueStringified","method","XDomainRequest","xdr","matchPageProtocol","onload","contentType","parse","responseText","onerror","onprogress","open","withoutProtocol","protocol","called","response","XMLHttpRequest","xhr","setRequestHeader","onreadystatechange","readyState","status","getResponseHeader","stringContent","toString","replace","_objectSpread","link","default","v","ErrorModel","maxErrorsPerInterval","intervalInMillis","waitForNtpSyncInterval","errorsSentCount","errorsSent","create","intervalTimeoutHandler","setInterval","_flushErrors","assign","sendError","errorDef","force","name","canSendErrors","forceSendError","startTime","_buildPayload","increamentErrorCount","errors","host","hostname","recordIPAddress","archVersion","values","isErrorExists","close","Zone","inited","Reporters","add","kadiraZoneReporter","enableErrorTracking","errorName","getErrorMessage","_e","appId","prevWindowOnError","Function","handleOnError","line","col","_internalDetails","origError","_setupOnErrorReporter","setupOnError","originalMeteorDebug","_debug","lastMessageToIgnore","messagesToIgnore","_ignoreDebugMessagesUntil","maxMessages","s","runOriginal","undefined","getStackFromMessage","firstLine","separator","endsWith","stackRegex","match","exec","addEventListener","reason","origCompute","Tracker","Computation","_compute","origAfterFlush","afterFlush","origRunFlush","_runFlush","throwFirstError","func","firstRun","disableErrorTracking","SettingsCollection","Collection","find","observe","added","initialize","kadira","initialized","errorDumpInterval","collectAllStacks","startup","clientEngineSyncDelay","profileCpu"],"mappings":"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","file":"/packages/montiapm_agent.js","sourcesContent":["getClientArchVersion = function (arch) {\n  const autoupdate = __meteor_runtime_config__.autoupdate\n\n  if (autoupdate) {\n    return autoupdate.versions[arch] ? autoupdate.versions[arch].version : 'none';\n  }\n\n  // Meteor 1.7 and older did not have an `autoupdate` object.\n  switch (arch) {\n    case 'cordova.web':\n      return __meteor_runtime_config__.autoupdateVersionCordova;\n    case 'web.browser':\n    case 'web.browser.legacy':\n      // Meteor 1.7 always used the web.browser.legacy version\n      return __meteor_runtime_config__.autoupdateVersion;\n\n    default:\n      return 'none';\n  }\n}\n\nconst createStackTrace = () => {\n  if (Error.captureStackTrace) {\n    let err = {};\n    Error.captureStackTrace(err, Kadira.trackError);\n    return err.stack;\n  }\n\n  const stack = new Error().stack.split('\\n');\n  let toRemove = 0;\n\n  // Remove frames starting from when trackError was called\n  for (; toRemove < stack.length; toRemove++) {\n    if (stack[toRemove].indexOf('trackError') > -1) {\n      toRemove += 1;\n      break;\n    }\n  }\n\n  return stack.slice(toRemove).join('\\n');\n}\n\nexport const getErrorParameters = function (args) {\n  let type = null;\n  let message = null;\n  let subType = null;\n  let stack = null;\n\n  if (\n    !(args[0] instanceof Error) &&\n    typeof args[0] === 'string' &&\n    typeof args[1] === 'string'\n  ) {\n    // Old usage:\n    // Monti.trackError(\n    //   'type', 'error message', { stacks: 'error stack', subType: 'sub type }\n    // );\n\n    const options = args[2] || {};\n\n    type = args[0];\n    subType = Meteor.isClient? args[0] : options.subType;\n    message = args[1];\n    stack = options.stacks || createStackTrace();\n\n  } else {\n    // New usage:\n    // Monti.trackError(error, { type: 'type', subType: 'subType' });\n    const error = args[0];\n    const options = args[1] || {};\n    const isErrorObject = typeof error === 'object' && error !== null\n    \n    message = isErrorObject ? error.message : error;\n    stack = isErrorObject && error.stack || createStackTrace();\n    type = options.type;\n    subType = options.subType;\n  }\n\n  return { type, message, subType, stack }\n}\n","Kadira = {};\nKadira.options = {};\n\nMonti = Kadira;\n\nif(Meteor.wrapAsync) {\n  Kadira._wrapAsync = Meteor.wrapAsync;\n} else {\n  Kadira._wrapAsync = Meteor._wrapAsync;\n}\n\nif(Meteor.isServer) {\n  var EventEmitter = Npm.require('events').EventEmitter;\n  var eventBus = new EventEmitter();\n  eventBus.setMaxListeners(0);\n\n  var buildArgs = function(args) {\n    var eventName = args[0] + '-' + args[1];\n    var args = args.slice(2);\n    args.unshift(eventName);\n    return args;\n  };\n  \n  Kadira.EventBus = {};\n  ['on', 'emit', 'removeListener', 'removeAllListeners'].forEach(function(m) {\n    Kadira.EventBus[m] = function(...args) {\n      var args = buildArgs(args);\n      return eventBus[m].apply(eventBus, args);\n    };\n  });\n}","var commonErrRegExps = [\n  /connection timeout\\. no (\\w*) heartbeat received/i,\n  /INVALID_STATE_ERR/i,\n];\n\nKadira.errorFilters = {\n  filterValidationErrors: function(type, message, err) {\n    if(err && err instanceof Meteor.Error) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  filterCommonMeteorErrors: function(type, message) {\n    for(var lc=0; lc<commonErrRegExps.length; lc++) {\n      var regExp = commonErrRegExps[lc];\n      if(regExp.test(message)) {\n        return false;\n      }\n    }\n    return true;\n  }\n};","Kadira.send = function (payload, path, callback) {\n  if(!Kadira.connected)  {\n    throw new Error(\"You need to connect with Kadira first, before sending messages!\");\n  }\n\n  path = (path.substr(0, 1) != '/')? \"/\" + path : path;\n  var endpoint = Kadira.options.endpoint + path;\n  var retryCount = 0;\n  var retry = new Retry({\n    minCount: 1,\n    minTimeout: 0,\n    baseTimeout: 1000*5,\n    maxTimeout: 1000*60,\n  });\n\n  var sendFunction = Kadira._getSendFunction();\n  tryToSend();\n\n  function tryToSend(err) {\n    if(retryCount < 5) {\n      retry.retryLater(retryCount++, send);\n    } else {\n      console.warn('Error sending error traces to Monti APM server');\n      if(callback) callback(err);\n    }\n  }\n\n  function send() {\n    sendFunction(endpoint, payload, function(err, res) {\n      if(err && !res) {\n        tryToSend(err);\n      } else if(res.statusCode == 200) {\n        if(callback) callback(null, res.data);\n      } else {\n        if(callback) callback(new Meteor.Error(res.statusCode, res.content));\n      }\n    });\n  }\n};\n\nKadira._getSendFunction = function() {\n  return (Meteor.isServer)? Kadira._serverSend : Kadira._clientSend;\n};\n\nKadira._clientSend = function (endpoint, payload, callback) {\n  httpRequest('POST', endpoint, {\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    content: JSON.stringify(payload)\n  }, callback);\n}\n\nKadira._serverSend = function () {\n  throw new Error('Kadira._serverSend is not supported. Use coreApi instead.');\n}\n","BaseErrorModel = function(options) {\n  this._filters = [];\n};\n\nBaseErrorModel.prototype.addFilter = function(filter) {\n  if(typeof filter === 'function') {\n    this._filters.push(filter);\n  } else {\n    throw new Error(\"Error filter must be a function\");\n  }\n};\n\nBaseErrorModel.prototype.removeFilter = function(filter) {\n  var index = this._filters.indexOf(filter);\n  if(index >= 0) {\n    this._filters.splice(index, 1);\n  }\n};\n\nBaseErrorModel.prototype.applyFilters = function(type, message, error, subType) {\n  for(var lc=0; lc<this._filters.length; lc++) {\n    var filter = this._filters[lc];\n    try {\n      var validated = filter(type, message, error, subType);\n      if(!validated) return false;\n    } catch (ex) {\n      // we need to remove this filter\n      // we may ended up in a error cycle\n      this._filters.splice(lc, 1);\n      throw new Error(\"an error thrown from a filter you've suplied\", ex.message);\n    }\n  }\n\n  return true;\n};","// Retry logic with an exponential backoff.\n//\n// options:\n//  baseTimeout: time for initial reconnect attempt (ms).\n//  exponent: exponential factor to increase timeout each attempt.\n//  maxTimeout: maximum time between retries (ms).\n//  minCount: how many times to reconnect \"instantly\".\n//  minTimeout: time to wait for the first `minCount` retries (ms).\n//  fuzz: factor to randomize retry times by (to avoid retry storms).\n\n//TODO: remove this class and use Meteor Retry in a later version of meteor.\n\nRetry = class {\n  constructor ({\n    baseTimeout = 1000, // 1 second\n    exponent = 2.2,\n    // The default is high-ish to ensure a server can recover from a\n    // failure caused by load.\n    maxTimeout = 5 * 60000, // 5 minutes\n    minTimeout = 10,\n    minCount = 2,\n    fuzz = 0.5, // +- 25%\n  } = {}) {\n    this.baseTimeout = baseTimeout;\n    this.exponent = exponent;\n    this.maxTimeout = maxTimeout;\n    this.minTimeout = minTimeout;\n    this.minCount = minCount;\n    this.fuzz = fuzz;\n    this.retryTimer = null;\n  }\n\n  // Reset a pending retry, if any.\n  clear() {\n    if(this.retryTimer)\n      clearTimeout(this.retryTimer);\n    this.retryTimer = null;\n  }\n\n  // Calculate how long to wait in milliseconds to retry, based on the\n  // `count` of which retry this is.\n  _timeout(count) {\n    if(count < this.minCount)\n      return this.minTimeout;\n\n    let timeout = Math.min(\n      this.maxTimeout,\n      this.baseTimeout * Math.pow(this.exponent, count));\n    // fuzz the timeout randomly, to avoid reconnect storms when a\n    // server goes down.\n    timeout = timeout * ((Random.fraction() * this.fuzz) +\n                         (1 - this.fuzz/2));\n    return Math.ceil(timeout);\n  }\n\n  // Call `fn` after a delay, based on the `count` of which retry this is.\n  retryLater(count, fn) {\n    const timeout = this._timeout(count);\n    if(this.retryTimer)\n      clearTimeout(this.retryTimer);\n\n    this.retryTimer = setTimeout(fn, timeout);\n    return timeout;\n  }\n\n}\n\n","var logger = getLogger();\n\nNtp = function (endpoint) {\n  this.path = '/simplentp/sync';\n  this.setEndpoint(endpoint);\n  this.diff = 0;\n  this.synced = false;\n  this.reSyncCount = 0;\n  this.reSync = new Retry({\n    baseTimeout: 1000*60,\n    maxTimeout: 1000*60*10,\n    minCount: 0\n  });\n}\n\nNtp._now = function() {\n  var now = Date.now();\n  if(typeof now == 'number') {\n    return now;\n  } else if(now instanceof Date) {\n    // some extenal JS libraries override Date.now and returns a Date object\n    // which directly affect us. So we need to prepare for that\n    return now.getTime();\n  } else {\n    // trust me. I've seen now === undefined\n    return (new Date()).getTime();\n  }\n};\n\nNtp.prototype.setEndpoint = function(endpoint) {\n  this.endpoint = endpoint ? endpoint + this.path : null;\n};\n\nNtp.prototype.getTime = function() {\n  return Ntp._now() + Math.round(this.diff);\n};\n\nNtp.prototype.syncTime = function(localTime) {\n  return localTime + Math.ceil(this.diff);\n};\n\nNtp.prototype.sync = function() {\n  if (this.endpoint === null) {\n    return;\n  }\n\n  logger('init sync');\n  var self = this;\n  var retryCount = 0;\n  var retry = new Retry({\n    baseTimeout: 1000*20,\n    maxTimeout: 1000*60,\n    minCount: 1,\n    minTimeout: 0\n  });\n  syncTime();\n\n  function syncTime () {\n    if(retryCount<5) {\n      logger('attempt time sync with server', retryCount);\n      // if we send 0 to the retryLater, cacheDns will run immediately\n      retry.retryLater(retryCount++, cacheDns);\n    } else {\n      logger('maximum retries reached');\n      self.reSync.retryLater(self.reSyncCount++, function () {\n        var args = [].slice.call(arguments);\n        self.sync.apply(self, args);\n      });\n    }\n  }\n\n  // first attempt is to cache dns. So, calculation does not\n  // include DNS resolution time\n  function cacheDns () {\n    self.getServerTime(function(err) {\n      if(!err) {\n        calculateTimeDiff();\n      } else {\n        syncTime();\n      }\n    });\n  }\n\n  function calculateTimeDiff () {\n    var clientStartTime = (new Date()).getTime();\n    self.getServerTime(function(err, serverTime) {\n      if(!err && serverTime) {\n        // (Date.now() + clientStartTime)/2 : Midpoint between req and res\n        var networkTime = ((new Date()).getTime() - clientStartTime)/2\n        var serverStartTime = serverTime - networkTime;\n        self.diff = serverStartTime - clientStartTime;\n        self.synced = true;\n        // we need to send 1 into retryLater.\n        self.reSync.retryLater(self.reSyncCount++, function () {\n          var args = [].slice.call(arguments);\n          self.sync.apply(self, args);\n        });\n        logger('successfully updated diff value', self.diff);\n      } else {\n        syncTime();\n      }\n    });\n  }\n}\n\nNtp.prototype.getServerTime = function(callback) {\n  var self = this;\n\n  if (self.endpoint === null) {\n    throw new Error('getServerTime requires the endpoint to be set');\n  }\n\n  if(Meteor.isServer) {\n    Kadira.coreApi.get(self.path, { noRetries: true }).then(content => {\n      var serverTime = parseInt(content);\n      callback(null, serverTime);\n    })\n      .catch(err => {\n        callback(err);\n      });\n  } else {\n    httpRequest('GET', self.endpoint + `?noCache=${new Date().getTime()}-${Math.random()}`, function(err, res) {\n      if (err) {\n        callback(err);\n      } else {\n        var serverTime = parseInt(res.content);\n        callback(null, serverTime);\n      }\n    });\n  }\n};\n\nfunction getLogger() {\n  if(Meteor.isServer) {\n    return Npm.require('debug')(\"kadira:ntp\");\n  } else {\n    return function(message) {\n      try {\n        var canLogKadira = global.localStorage.getItem('LOG_KADIRA') !== null && typeof console !== 'undefined';\n      } catch (e) { } //older browsers can sometimes throw because of getItem\n      if (canLogKadira) {\n        if (message) {\n          message = \"kadira:ntp \" + message;\n          arguments[0] = message;\n        }\n        console.log.apply(console, arguments);\n      }\n    }\n  }\n}\n","getBrowserInfo = function () {\n  return {\n    browser: window.navigator.userAgent,\n    userId: Meteor.userId && Meteor.userId(),\n    url: location.href,\n    resolution: getResolution(),\n    clientArch: getClientArch(),\n  };\n}\n\ngetResolution = function () {\n  if(screen && screen.width && screen.height) {\n    var resolution = screen.width + 'x' + screen.height;\n    return resolution;\n  }\n}\n\nconst toArray = (...args) => args;\n\ngetErrorStack = function (zone, callback) {\n  var trace = [];\n  var eventMap = zone.eventMap || {};\n  var infoMap = zone.infoMap || {};\n\n  trace.push({\n    at: (new Date().getTime()),\n    stack: zone.erroredStack.get()\n  });\n\n  processZone();\n  function processZone() {\n    // we assume, first two zones are not interesting\n    // bacause, they are some internal meteor loading stuffs\n    if(zone && zone.depth > 2) {\n      var stack = \"\";\n      if(zone.currentStack) {\n        stack = zone.currentStack.get();\n      }\n\n      var events = eventMap[zone.id] || [];\n      var info = getInfoArray(infoMap[zone.id]);\n      var ownerArgsEvent = events && events[0] && events[0].type == 'owner-args' && events.shift();\n      var runAt = (ownerArgsEvent)? ownerArgsEvent.at : zone.runAt;\n      var ownerArgs = (ownerArgsEvent)? toArray.apply(null, ownerArgsEvent.args) : [];\n\n      // limiting\n      events = events.slice(-5).map(checkSizeAndPickFields(100));\n      info = info.slice(-5).map(checkSizeAndPickFields(100));\n      ownerArgs = checkSizeAndPickFields(200)(ownerArgs.slice(0,5));\n\n      zone.owner && delete zone.owner.zoneId;\n\n      trace.push({\n        createdAt: zone.createdAt,\n        runAt: runAt,\n        stack: stack,\n        owner: zone.owner,\n        ownerArgs: ownerArgs,\n        events: events,\n        info: info,\n        zoneId: zone.id\n      });\n      zone = zone.parent;\n\n      setTimeout(processZone, 0);\n    } else {\n      callback(trace);\n    }\n  }\n}\n\ngetInfoArray = function (info = {}) {\n  return Object.keys(info)\n    .map(function (key, type) {\n      const value = info[key];\n      value.type = type;\n      return value;\n    });\n}\n\ngetTime = function () {\n  if(Kadira && Kadira.syncedDate) {\n    return Kadira.syncedDate.getTime();\n  } else {\n    return (new Date().getTime());\n  }\n}\n\ngetClientArch = function () {\n  if (Meteor.isCordova) {\n    return 'cordova.web';\n  } else if (typeof Meteor.isModern === 'undefined' || Meteor.isModern) {\n    return 'web.browser'\n  } else {\n    return 'web.browser.legacy'\n  }\n}\n\ncheckSizeAndPickFields = function(maxFieldSize) {\n  return function(obj) {\n    maxFieldSize = maxFieldSize || 100;\n    for(var key in obj) {\n      var value = obj[key];\n      try {\n        var valueStringified = JSON.stringify(value);\n        if(valueStringified.length > maxFieldSize) {\n          obj[key] = valueStringified.substr(0, maxFieldSize) + \" ...\";\n        } else {\n          obj[key] = value;\n        }\n      } catch(ex) {\n        obj[key] = 'Error: cannot stringify value';\n      }\n    }\n    return obj;\n  }\n}\n\nhttpRequest = function (method, url, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  /**\n   * IE8 and IE9 does not support CORS with the usual XMLHttpRequest object\n   * If XDomainRequest exists, use it to send errors.\n   * XDR can POST data to HTTPS endpoints only if current page uses HTTPS\n   */\n  if (window.XDomainRequest) {\n    var xdr = new XDomainRequest();\n    url = matchPageProtocol(url);\n\n    xdr.onload = function () {\n      var headers = { 'Content-Type': xdr.contentType };\n      var data = {};\n      try {\n        data = JSON.parse(xdr.responseText);\n      } catch (e) {}\n\n      callback(null, { content: xdr.responseText, data: data, headers: headers, statusCode: 200 });\n    }\n\n    xdr.onerror = function () {\n      callback({ statusCode: 404 });\n    };\n    xdr.onprogress = function () {\n      // onprogress must be set. Otherwise, ie doesn't handle duplicate requests\n      // correctly.\n    };\n\n    xdr.open(method, url);\n\n    setTimeout(() => {\n      var content = options.content;\n      if (typeof content === 'object') {\n        content = JSON.stringify(content);\n      }\n      // delaying send fixes issues when multiple xdr requests are made\n      // at the same time.\n      xdr.send(options.content || null);\n    }, 0)\n\n    function matchPageProtocol (endpoint) {\n      var withoutProtocol = endpoint.substr(endpoint.indexOf(':') + 1);\n      return window.location.protocol + withoutProtocol;\n    }\n  } else {\n    // Based on Meteor's HTTP package. Uses XMLHttpRequest\n    var content = options.content;\n\n    // wrap callback to add a 'response' property on an error, in case\n    // we have both (http 4xx/5xx error, which has a response payload)\n    callback = (function (callback) {\n      var called = false;\n      return function (error, response) {\n        if (!called) {\n          called = true;\n          if (error && response) {\n            error.response = response;\n          }\n          callback(error, response);\n        }\n      };\n    })(callback);\n\n    try {\n      if (typeof XMLHttpRequest === \"undefined\") {\n        throw new Error(\"Can't create XMLHttpRequest\");\n      }\n      \n      var xhr = new XMLHttpRequest();\n\n      xhr.open(method, url, true);\n\n      if (options.headers) {\n        Object.keys(options.headers).forEach(function (key) {\n          xhr.setRequestHeader(key, options.headers[key]);\n        });\n      }\n\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 4) { // COMPLETE\n          if (!xhr.status) {\n            // no HTTP response\n            callback(new Error(\"Connection lost\"));\n          } else {\n            var response = {};\n            response.statusCode = xhr.status;\n            response.content = xhr.responseText;\n\n            // Read Content-Type header, up to a ';' if there is one.\n            // A typical header might be \"application/json; charset=utf-8\"\n            // or just \"application/json\".\n            var contentType = (xhr.getResponseHeader('content-type') || ';').split(';')[0];\n\n            // Only try to parse data as JSON if server sets correct content type.\n            if (['application/json',\n              'text/javascript',\n              'application/javascript',\n              'application/x-javascript',\n            ].indexOf(contentType) >= 0) {\n              try {\n                response.data = JSON.parse(response.content);\n              } catch (err) {\n                response.data = null;\n              }\n            } else {\n              response.data = null;\n            }\n\n            var error = null;\n            if (response.statusCode >= 400) {\n              var message = \"failed [\" + response.statusCode + \"]\";\n\n              if (response.content) {\n                var stringContent = typeof response.content == \"string\" ?\n                  response.content : response.content.toString();\n                stringContent = stringContent.replace(/\\n/g, ' ');\n                stringContent = stringContent.length > 500 ? stringContent.slice(0, length) + '...' : stringContent;\n                message += ' ' + stringContent;\n              }\n\n              error = new Error(message);\n            }\n\n            callback(error, response);\n          }\n        }\n      };\n\n      xhr.send(content);\n\n    } catch (err) {\n      callback(err);\n    }\n  }\n};\n","ErrorModel = function(options) {\n  BaseErrorModel.call(this);\n  options = options || {};\n  options.maxErrorsPerInterval = options.maxErrorsPerInterval || 10;\n  options.intervalInMillis = options.intervalInMillis || 1000 * 60 *2; //2 mins\n  options.waitForNtpSyncInterval = options.waitForNtpSyncInterval || 0;\n  var self = this;\n\n  self.options = options;\n\n  // errorsSentCount will be reseted at the start of the interval\n  self.errorsSentCount = 0;\n  self.errorsSent = Object.create(null);\n  self.intervalTimeoutHandler = setInterval(function() {\n    self.errorsSentCount = 0;\n    self._flushErrors();\n  }, self.options.intervalInMillis);\n};\n\nObject.assign(ErrorModel.prototype, BaseErrorModel.prototype);\n\nErrorModel.prototype.sendError = function(errorDef, err, force) {\n  var self = this;\n  if(!this.applyFilters('client', errorDef.name, err, errorDef.subType)) {\n    return;\n  };\n\n  if(!this.canSendErrors()) {\n    // reached maximum error count for this interval (1 min)\n    return;\n  }\n\n  if(force) {\n    sendError();\n  } else {\n    if(Kadira.syncedDate.synced || self.options.waitForNtpSyncInterval == 0) {\n      sendError();\n    } else {\n      setTimeout(forceSendError, self.options.waitForNtpSyncInterval);\n    }\n  }\n\n  function forceSendError() {\n    self.sendError(errorDef, err, true);\n  }\n\n  function sendError() {\n    if(!self.errorsSent[errorDef.name]) {\n      // sync time with the server\n      if(errorDef.startTime) {\n        errorDef.startTime = Kadira.syncedDate.syncTime(errorDef.startTime);\n      }\n      errorDef.count = 1;\n      var payload = self._buildPayload([errorDef]);\n      Kadira.send(payload, '/errors');\n\n      self.errorsSent[errorDef.name] = { ...errorDef };\n      self.errorsSent[errorDef.name].count = 0;\n      self.errorsSentCount++;\n    } else {\n      self.increamentErrorCount(errorDef.name);\n    }\n  }\n};\n\nErrorModel.prototype._buildPayload = function(errors) {\n  var arch = getClientArch();\n\n  return {\n    host: Kadira.options.hostname,\n    recordIPAddress: Kadira.options.recordIPAddress,\n    errors: errors,\n    arch: arch,\n    archVersion: getClientArchVersion(arch)\n  }\n}\n\nErrorModel.prototype._flushErrors = function() {\n  const errors = Object.values(this.errorsSent).filter(e => e.count > 0);\n\n  if(errors.length > 0) {\n    Kadira.send(this._buildPayload(errors), '/errors');\n  }\n\n  this.errorsSent = Object.create(null);\n};\n\nErrorModel.prototype.isErrorExists = function(name) {\n  return !!this.errorsSent[name];\n};\n\nErrorModel.prototype.increamentErrorCount = function(name) {\n  var error = this.errorsSent[name];\n  if(error) {\n    error.count++;\n  }\n};\n\nErrorModel.prototype.canSendErrors = function() {\n  return this.errorsSentCount < this.options.maxErrorsPerInterval;\n};\n\nErrorModel.prototype.close = function() {\n  clearTimeout(this.intervalTimeoutHandler);\n};\n","if(window.Zone && Zone.inited) {\n  Zone.Reporters.add('kadira', kadiraZoneReporter);\n}\n\nfunction kadiraZoneReporter(zone) {\n  // track only if error tracking is enabled\n  if(!Kadira.options.enableErrorTracking) {\n    return;\n  }\n\n  var errorName = Zone.Reporters.getErrorMessage(zone.erroredStack._e);\n  if(Kadira.errors.isErrorExists(errorName)) {\n    Kadira.errors.increamentErrorCount(errorName);\n  } else if(Kadira.errors.canSendErrors()) {\n    getErrorStack(zone, function(stacks) {\n      Kadira.errors.sendError({\n        appId : Kadira.options.appId,\n        name : errorName,\n        type : 'client',\n        startTime : zone.runAt,\n        subType : 'zone',\n        info : getBrowserInfo(),\n        stacks : JSON.stringify(stacks),\n      });\n    });\n  }\n}\n","var prevWindowOnError = window.onerror || Function.prototype;\n\nfunction handleOnError(message, url, line, col, error) {\n  // track only if error tracking is enabled\n  if(!Kadira.options.enableErrorTracking) {\n    return prevWindowOnError(message, url, line, col, error);\n  }\n\n  url = url || '<anonymous>';\n  line = line || 0;\n  col = col || 0;\n\n  if(error) {\n    var stack = error.stack;\n  } else {\n    var stack = 'Error:\\n    at window.onerror ('+url+':'+line+':'+col+')';\n  }\n\n  var now = (new Date().getTime());\n  Kadira.errors.sendError({\n    appId : Kadira.options.appId,\n    name : message,\n    type : 'client',\n    startTime : now,\n    subType : 'window.onerror',\n    info : getBrowserInfo(),\n    _internalDetails: {\n      origError: {\n        message,\n        url,\n        line,\n        col,\n        error\n      }\n    },\n    stacks : JSON.stringify([{at: now, events: [], stack: stack}]),\n  });\n\n  return prevWindowOnError(message, url, line, col, error);;\n}\n\nKadira._setupOnErrorReporter = function setupOnError () {\n  if (window.onerror !== handleOnError) {\n    prevWindowOnError = window.onerror || prevWindowOnError;\n\n    window.onerror = handleOnError;\n  }\n}\n\nKadira._setupOnErrorReporter();\n","var originalMeteorDebug = Meteor._debug;\n\nlet lastMessageToIgnore = null;\nlet messagesToIgnore = 0;\n\n// Sometimes one of the other error reporter tracks an error, but Meteor also\n// sends the details to Meteor._debug. In some places, Meteor splits the\n// information across multiple Meteor._debug calls.\n//\n// Does not report Meteor._debug errors until it sees the given message\n// or it has ignored maxMessages.\nKadira._ignoreDebugMessagesUntil = function (message, maxMessages) {\n  lastMessageToIgnore = message;\n  messagesToIgnore = maxMessages;\n};\n\nMeteor._debug = function(m, s) {\n  // We need to assign variables like this. Otherwise, \n  // we can't see proper error messages.\n  // See: https://github.com/meteorhacks/kadira/issues/193\n  var message = m;\n  var stack = s;\n  var args = arguments;\n\n  function runOriginal() {\n    return originalMeteorDebug.apply(Meteor, args);\n  }\n  \n  // track only if error tracking is enabled\n  if(!Kadira.options.enableErrorTracking) {\n    return runOriginal();\n  }\n\n  // do not track if a zone is available (let zone handle the error)\n  if(window.zone) {\n    return runOriginal();\n  }\n\n  // Do not report messages until either we see the\n  // lastMessageToIgnore or we have ignored the number of\n  // messages in messagesToIgnore\n  if (lastMessageToIgnore) {\n    if (message === lastMessageToIgnore || messagesToIgnore === 1) {\n      lastMessageToIgnore = null;\n      messagesToIgnore = 0;\n    } else {\n      messagesToIgnore -= 1;\n    }\n\n    return runOriginal();\n  }\n\n  // We hate Meteor._debug (no single usage pattern)\n  if(message instanceof Error) {\n    stack = message.stack;\n    message = message.message\n  } else if(typeof message == 'string' && stack === undefined) {\n    stack = getStackFromMessage(message);\n    message = firstLine(message);\n  } else if(typeof message == 'string' && stack instanceof Error) {\n    const separator = message.endsWith(':') ? '' : ':'\n    message = `${message}${separator} ${stack.message}`;\n    stack = getStackFromMessage(stack.stack);\n  }\n\n  // sometimes Meteor._debug is called with the stack concat to the message\n  // FIXME Meteor._debug can be called in many ways\n  if(message && stack === undefined) {\n    stack = getStackFromMessage(message);\n    message = firstLine(message);\n  }\n\n  var now = (new Date().getTime());\n  Kadira.errors.sendError({\n    appId : Kadira.options.appId,\n    name : message,\n    type : 'client',\n    startTime : now,\n    subType : 'meteor._debug',\n    info : getBrowserInfo(),\n    stacks : JSON.stringify([{at: now, events: [], stack: stack}]),\n  });\n\n  return runOriginal();\n};\n\n// Identifies lines that are a stack trace frame:\n// 1. Has \"at\" proceeded and followed by at least one space\n// 2. Or has an \"@\" symbol\nvar stackRegex = /(^.*@.*$|^\\s+at\\s.+$)/gm;\nfunction getStackFromMessage (message) {\n  // add empty string to add the empty line at start\n  var stack = [''];\n  var match;\n  while(match = stackRegex.exec(message)) {\n    stack.push(match[0]);\n  }\n  return stack.join('\\n');\n}\n\nfunction firstLine (message) {\n  return message.split('\\n')[0];\n}\n","window.addEventListener(\"unhandledrejection\", function(e) {\n  if (!Kadira.options.enableErrorTracking) {\n    return;\n  }\n\n  var message = e.reason;\n  var stack = '';\n\n  if (typeof message === 'object' && message !== null) {\n    stack = message.stack\n    message = message.message\n  }\n\n  var now = (new Date().getTime());\n\n  Kadira.errors.sendError({\n    appId: Kadira.options.appId,\n    name: message,\n    type: 'client',\n    startTime: now,\n    subType: 'window.onunhandledrejection',\n    info: getBrowserInfo(),\n    _internalDetails: {\n      origError: {\n        reason: e.reason,\n      }\n    },\n    stacks: JSON.stringify([{at: now, events: [], stack: stack}])\n  });\n});\n","const origCompute = Tracker.Computation.prototype._compute;\nconst origAfterFlush = Tracker.afterFlush;\nconst origRunFlush = Tracker._runFlush;\n\n// Internal variable in the Tracker package set during Tracker._runFlush\n// If it is true, Tracker throws the error instead of using Meteor._debug\n// In that case, we should not report the error in afterFlush and\n// instead let another reporter handle it\nlet throwFirstError = false;\n\nTracker._runFlush = function (options = {}) {\n  throwFirstError = !!options.throwFirstError\n  return origRunFlush.apply(this, arguments);\n}\n\nTracker.afterFlush = function (func) {\n  return origAfterFlush(function() {\n    try {\n      return func();\n    } catch (e) {\n      if (Kadira.options.enableErrorTracking && !throwFirstError) {\n        var message = e.message;\n        var stack = e.stack;\n        var now = (new Date().getTime());\n  \n        Kadira.errors.sendError({\n          appId: Kadira.options.appId,\n          name: message,\n          type: 'client',\n          startTime: now,\n          subType: 'tracker.afterFlush',\n          info: getBrowserInfo(),\n          stacks: JSON.stringify([{at: now, events: [], stack}])\n        });\n  \n        // Once the error is thrown, Tracker will call\n        // Meteor._debug 2 or 3 times. The last time will\n        // have the stack trace.\n        Kadira._ignoreDebugMessagesUntil(stack, 3);\n      }\n\n      throw e;\n    }\n  });\n}\n\nTracker.Computation.prototype._compute = function () {\n  try {\n    return origCompute.apply(this, arguments)\n  } catch(e) {\n    // During the first run, Tracker throws the error\n    // It will be handled by a different error reporter\n    if (Kadira.options.enableErrorTracking && !this.firstRun) {\n      var message = e.message;\n      var stack = e.stack;\n      var now = (new Date().getTime());\n\n      Kadira.errors.sendError({\n        appId: Kadira.options.appId,\n        name: message,\n        type: 'client',\n        startTime: now,\n        subType: 'tracker.compute',\n        info: getBrowserInfo(),\n        stacks: JSON.stringify([{at: now, events: [], stack}])\n      });\n\n      // Once the error is thrown, Tracker will call\n      // Meteor._debug 2 or 3 times. The last time will\n      // have the stack trace.\n      Kadira._ignoreDebugMessagesUntil(stack, 3);\n    }\n\n    throw e;\n  }\n}\n","import { getErrorParameters  } from \"../common/utils\";\n\nKadira.enableErrorTracking = function () {\n  Kadira.options.enableErrorTracking = true;\n};\n\nKadira.disableErrorTracking = function () {\n  Kadira.options.enableErrorTracking = false;\n};\n\nKadira.trackError = function () {\n  if (!Kadira.options.enableErrorTracking) {\n    return;\n  }\n  \n  const { message, subType, stack } = getErrorParameters(arguments);\n\n  if (message) {\n    var now = (new Date()).getTime();\n\n    Kadira.errors.sendError({\n      appId: Kadira.options.appId,\n      name: message,\n      startTime: now,\n      type: 'client',\n      subType: subType || 'Monti.trackError',\n      info: getBrowserInfo(),\n      stacks: JSON.stringify([{ at: now, events: [], stack }]),\n    });\n  }\n};\n\n// Create new NTP object and error model immediately so it can be used\n// endpoints is set later using __meteor_runtime_config__ or publication\nKadira.syncedDate = new Ntp(null);\nKadira.errors = new ErrorModel({\n  waitForNtpSyncInterval: 1000 * 5, // 5 secs\n  intervalInMillis: 1000 * 60 * 1, // 1minutes\n  maxErrorsPerInterval: 5\n});\n\n// __meteor_runtime_config__ cannot be dynamically set for cordova apps\n// using a null subscription to send required options to client\nif (Meteor.isCordova) {\n  var SettingsCollection = new Meteor.Collection('kadira_settings');\n  SettingsCollection.find().observe({ added: initialize });\n} else {\n  initialize(__meteor_runtime_config__.kadira);\n}\n\nvar initialized = false;\nfunction initialize(options = {}) {\n  if (initialized) { return }\n  initialized = true;\n\n  Kadira.options = {\n    errorDumpInterval: 1000 * 60,\n    maxErrorsPerInterval: 10,\n    collectAllStacks: false,\n    enableErrorTracking: false,\n    ...options,\n  };\n\n  if (Kadira.options.appId && Kadira.options.endpoint) {\n    // update endpoint after receiving correct data\n    Kadira.syncedDate.setEndpoint(Kadira.options.endpoint);\n    Kadira.connected = true;\n    Meteor.startup(function () {\n      // if we don't do this this might block the initial rendering\n      // or, it will show up bottom of the page, which is not cool\n      setTimeout(function () {\n        Kadira.syncedDate.sync();\n      }, Kadira.options.clientEngineSyncDelay);\n    });\n  }\n\n  if (Kadira.connected && Kadira.options.enableErrorTracking) {\n    Kadira.enableErrorTracking();\n  }\n\n  if (window.Zone && Zone.inited) {\n    Zone.collectAllStacks = Kadira.options.collectAllStacks;\n  }\n}\n","// For just making a notice\n// montiapm:profiler will override this method to add\n// actual functionality\nKadira.profileCpu = function profileCpu() {\n  var message =\n    \"Please install montiapm:profiler\" +\n    \" to take a CPU profile.\";\n  console.log(message);\n};"]}}]