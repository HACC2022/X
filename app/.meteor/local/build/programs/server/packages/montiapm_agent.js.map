{"version":3,"sources":["meteor://ðŸ’»app/packages/montiapm:agent/lib/common/utils.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/common/unify.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/common/default_error_filters.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/common/send.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/base_error.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/0model.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/methods.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/pubsub.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/system.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/errors.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/models/http.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/jobs.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/retry.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/utils.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/ntp.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/sourcemaps.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/wait_time_builder.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/check_for_oplog.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/tracer/tracer.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/tracer/default_filters.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/tracer/tracer_store.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/docsize_cache.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/kadira.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_server.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_session.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_subscription.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_observers.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_ddp_stringify.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/instrument.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/db.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/http.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/email.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/async.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/error.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/set_labels.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/fast_render.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/fs.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/gc.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/mongo_driver_events.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/picker.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_routers.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/hijack/wrap_webapp.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/environment_variables.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/auto_connect.js","meteor://ðŸ’»app/packages/montiapm:agent/lib/conflicting_agents.js"],"names":["module","export","getErrorParameters","getClientArchVersion","arch","autoupdate","__meteor_runtime_config__","versions","version","autoupdateVersionCordova","autoupdateVersion","createStackTrace","Error","captureStackTrace","err","Kadira","trackError","stack","split","toRemove","length","indexOf","slice","join","args","type","message","subType","options","Meteor","isClient","stacks","error","isErrorObject","Monti","wrapAsync","_wrapAsync","isServer","EventEmitter","Npm","require","eventBus","setMaxListeners","buildArgs","eventName","unshift","EventBus","forEach","m","apply","commonErrRegExps","errorFilters","filterValidationErrors","filterCommonMeteorErrors","lc","regExp","test","send","payload","path","callback","connected","substr","endpoint","retryCount","retry","Retry","minCount","minTimeout","baseTimeout","maxTimeout","sendFunction","_getSendFunction","tryToSend","retryLater","console","warn","res","statusCode","data","content","_serverSend","_clientSend","httpRequest","headers","JSON","stringify","BaseErrorModel","_filters","prototype","addFilter","filter","push","removeFilter","index","splice","applyFilters","validated","ex","KadiraModel","_getDateId","timestamp","remainder","dateId","DDSketch","METHOD_METRICS_FIELDS","MethodsModel","metricsThreshold","methodMetricsByMinute","Object","create","errorMap","_metricsThreshold","_","extend","maxEventTimesForMethods","tracerStore","TracerStore","interval","maxTotalPoints","archiveEvery","start","_getMetrics","method","methods","count","errors","fetchedDocSize","sentMsgSize","histogram","alpha","field","setStartTime","metricsByMinute","startTime","processMethod","methodTrace","at","_appendMetrics","errored","name","addTrace","id","methodMetrics","value","metrics","add","total","endTime","trackDocSize","size","Ntp","_now","trackMsgSize","buildPayload","buildDetailedInfo","methodRequests","key","syncedDate","syncTime","methodName","collectTraces","logger","PubsubModel","subscriptions","_trackSub","session","msg","params","publication","_getPublicationName","subscriptionId","subs","_startTime","_trackUnsub","sub","_subscriptionId","_name","subscriptionState","unsubs","lifeTime","_trackReady","trace","readyTracked","resTime","_trackError","pubs","activeSubs","activeDocs","totalObservers","cachedObservers","createdObservers","deletedObservers","observerLifetime","polledDocuments","oplogUpdatedDocuments","oplogInsertedDocuments","oplogDeletedDocuments","initiallyAddedDocuments","liveAddedDocuments","liveChangedDocuments","liveRemovedDocuments","polledDocSize","initiallyFetchedDocSize","liveFetchedDocSize","initiallySentMsgSize","liveSentMsgSize","_getSubscriptionInfo","self","totalDocsSent","totalDataSent","iterate","server","sessions","_namedSubs","countSubData","_universalSubs","avgObserverReuse","each","countSubscriptions","countDocuments","countObservers","_documents","collection","countKeys","_totalObservers","_cachedObservers","buildDetailInfo","pubMetrics","subscriptionData","dateMetrics","singlePubMetrics","pubRequests","incrementHandleCount","isCached","publicationName","getProperty","trackCreatedObserver","info","trackDeletedObserver","Date","getTime","trackDocumentChanges","op","trackPolledDocuments","trackLiveUpdates","createHistogram","link","v","GCMetrics","default","getFiberMetrics","resetFiberMetrics","getMongoDriverStats","resetMongoDriverStats","EventLoopMonitor","SystemModel","newSessions","sessionTimeout","evloopHistogram","evloopMonitor","on","lag","gcMetrics","cpuTime","process","hrtime","previousCpuUsage","cpuUsage","cpuHistory","currentCpuUsage","setInterval","now","memoryUsage","memory","rss","memoryArrayBuffers","arrayBuffers","memoryExternal","external","memoryHeapUsed","heapUsed","memoryHeapTotal","heapTotal","activeRequests","_getActiveRequests","activeHandles","_getActiveHandles","pctEvloopBlock","status","pctBlock","gcMajorDuration","gcMajor","gcMinorDuration","gcMinor","gcIncrementalDuration","gcIncremental","gcWeakCBDuration","gcWeakCB","reset","driverMetrics","mongoPoolSize","poolSize","mongoPoolPrimaryCheckouts","primaryCheckouts","mongoPoolOtherCheckouts","otherCheckouts","mongoPoolCheckoutTime","checkoutTime","mongoPoolMaxCheckoutTime","maxCheckoutTime","mongoPoolPending","pending","mongoPoolCheckedOutConnections","checkedOut","mongoPoolCreatedConnections","created","fiberMetrics","createdFibers","activeFibers","active","fiberPoolSize","pcpu","pcpuUser","pcpuSystem","lastCpuUsage","usage","user","sys","map","entry","time","systemMetrics","hrtimeToMS","elapTimeMS","elapUsage","elapUserMS","elapSystMS","system","totalUsageMS","totalUsagePercent","docSzCache","setPcpu","handleSessionActivity","countNewSession","isSessionActive","_activeAt","isLocalAddress","socket","inactiveTime","isLocalHostRegex","isLocalAddressRegex","host","address","remoteAddress","ErrorModel","appId","call","maxErrors","assign","values","metric","errorCount","errorDef","_formatError","details","errorEvent","events","errorObject","HttpModel","processRequest","req","routeId","routes","statusCodes","requestMetrics","statusMetric","httpMetrics","httpRequests","requestName","exportDefault","Jobs","getAsync","coreApi","getJob","then","catch","setAsync","changes","updateJob","set","get","constructor","exponent","fuzz","retryTimer","clear","clearTimeout","_timeout","timeout","Math","min","pow","Random","fraction","ceil","fn","setTimeout","HaveAsyncCallback","lastArg","UniqueId","DefaultUniqueId","CreateUserStack","OptimizedApply","context","a","getClientVersions","obj","Map","Set","keys","getLogger","setEndpoint","diff","synced","reSyncCount","reSync","round","localTime","sync","cacheDns","arguments","getServerTime","calculateTimeDiff","clientStartTime","serverTime","networkTime","serverStartTime","noRetries","parseInt","random","canLogKadira","global","localStorage","getItem","e","log","url","fs","clientPaths","__meteor_bootstrap__","configJson","clientArchs","serverDir","absClientPaths","reduce","result","resolve","dirname","handleApiResponse","body","unavailable","parse","neededSourcemaps","promises","sourcemap","uploadSourceMaps","getSourcemapPath","file","sourceMapPath","sendSourcemap","Promise","all","sendData","unavailableSourcemaps","sourcemapPath","stream","createReadStream","archVersion","encodeURIComponent","sendStream","preparePath","urlPath","posix","normalize","checkForDynamicImport","filePath","archPath","dynamicPath","stat","reject","clientProgram","WebApp","clientPrograms","manifest","fileInfo","find","startsWith","sourceMap","WaitTimeBuilder","WAITON_MESSAGE_FIELDS","_waitListStore","_currentProcessingMessages","_messageCache","register","msgId","mainKey","_getMessageKey","inQueue","toArray","waitList","_getCacheMessage","currentlyProcessingMessage","build","filteredWaitList","_cleanCacheMessage","bind","sessionId","cachedMessage","pick","_key","_registered","trackWaitTime","unblock","started","unblocked","wrappedUnblock","waitTime","OplogCheck","_070","cursorDescription","limit","code","reason","solution","exists$","any","selector","onlyScalers","Collection","ObjectID","_071","matcher","Minimongo","Matcher","env","MONGO_OPLOG_URL","disableOplog","_disableOplog","miniMongoMatcher","miniMongoSorter","Sorter","sort","sorter","fields","LocalCollection","_checkSupportedProjection","skip","where","hasWhere","geo","hasGeoQuery","limitButNoSort","olderVersion","driver","cursorSupported","gitCheckout","release","preRunningMatchers","globalMatchers","versionMatchers","checkWhyNoOplog","observerDriver","runMatchers","meteorVersion","matcherInfo","matched","matcherList","eventLogger","REPETITIVE_EVENTS","TRACE_TYPES","MAX_TRACE_EVENTS","Tracer","_filterFields","maxArrayItemsToFilter","userId","traceInfo","_id","event","metaData","lastEvent","getLastEvent","isEventsProcessed","endAt","nested","_applyFilters","eventStackTrace","dir","depth","lastNested","eventEnd","endLastEvent","forcedEnd","_hasUsefulNested","every","buildEvent","elapsedTimeForEvent","builtEvent","prevEnd","i","nestedEvent","computeTime","undefined","buildTrace","firstEvent","processedEvents","totalNonCompute","prevEvent","lastEventData","removeCount","compute","filterFn","redactField","eventType","clone","_applyObjectFilters","toFilter","filterObject","cloned","Array","isArray","tracer","stripSensitive","typesToStrip","receiverType","strippedTypes","item","stripSensitiveThorough","fieldsToKeep","stripSelectors","collectionList","collMap","collName","coll","maxTotals","currentMaxTrace","traceArchive","processedCnt","kind","EJSON","_handleErrors","traces","_timeoutHandler","processTraces","stop","clearInterval","errorKey","erroredTrace","kinds","currentMaxTotal","exceedingPoints","archiveDefault","canArchive","_isTraceOutlier","dataSet","_isOutlier","dataPoint","maxMadZ","median","_getMedian","mad","_calculateMad","madZ","_funcMedianDeviation","sortedDataSet","b","_pickQuartile","num","pos","medianDeviations","x","abs","_getMean","dataPoints","point","LRU","crypto","jsonStringify","DocSzCache","maxItems","maxValues","items","max","getSize","query","opts","getKey","DocSzCacheItem","needsUpdate","doc","element","Buffer","byteLength","addData","getValue","getItemScore","updated","score","currentTime","timeSinceUpdate","shift","sortNumber","sorted","idx","floor","packageMap","hostname","Fibers","KadiraCore","models","currentSub","kadiraInfo","EnvironmentVariable","waitTimeBuilder","pubsub","http","buildInterval","_buildPayload","connect","appSecret","payloadTimeout","clientEngineSyncDelay","thresholds","isHostNameSet","proxy","recordIPAddress","documentSizeCacheSize","last","enableErrorTracking","isProduction","authHeaders","trim","agentVersion","_checkAuth","_sendAppStats","_schedulePayloadSend","addFilterFn","kadira","disableErrorTracking","startup","TrackUncaughtExceptions","TrackUnhandledRejections","TrackMeteorDebug","publish","added","ready","clientVersions","_isDetailedInfo","_countDataSent","_detailInfoSentInterval","appStats","protocolVersion","packageVersions","Package","_sendPayload","run","_getInfo","currentFiber","useEnvironmentVariable","current","__kadiraInfo","_setInfo","startContinuousProfiling","MontiProfiler","startContinuous","onProfile","profile","profiles","ignoreErrorTracking","_skipKadira","startEvent","endEvent","Fiber","wrapServer","serverProto","originalHandleConnect","_handleConnect","_meteorSession","emit","MeteorDebugIgnore","MAX_PARAMS_LENGTH","wrapSession","sessionProto","originalProcessMessage","processMessage","stringifiedParams","startData","waitEventId","_waitEventId","originalMethodHandler","protocol_handlers","waitOn","response","withValue","orginalSubHandler","orginalUnSubHandler","unsub","originalSend","currentError","method_handlers","handler","wrapMethodHanderForErrors","originalMeteorMethods","methodMap","originalHandler","source","wrapSubscription","subscriptionProto","originalRunHandler","_runHandler","originalReady","_apmReadyTracked","_session","originalError","errorForApm","originalDeactivate","_deactivate","funcName","originalFunc","collectionName","wrapOplogObserveDriver","proto","originalPublishNewResults","_publishNewResults","newResults","newBuffer","_cursorDescription","docSize","_ownerInfo","_polledDocuments","_docSize","polledFetches","originalHandleOplogEntryQuerying","_handleOplogEntryQuerying","originalHandleOplogEntrySteadyOrFetching","_handleOplogEntrySteadyOrFetching","fnName","originalFn","c","_liveUpdatesCounts","_initialAdds","initialFetches","originalStop","wrapPollingObserveDriver","originalPollMongo","_pollMongo","_results","_map","_polledDocSize","wrapMultiplexer","originalInitalAdd","addHandleAndSendInitialAdds","handle","_firstInitialAddTime","_wasMultiplexerReady","_ready","_queueLength","_queue","_taskHandles","_elapsedPollingTime","wrapForCountingObservers","mongoConnectionProto","MeteorX","MongoConnection","originalObserveChanges","_observeChanges","ordered","callbacks","ret","_multiplexer","__kadiraTracked","ownerInfo","_observeDriver","wrapStringifyDDP","originalStringifyDDP","DDPCommon","stringifyDDP","msgString","msgSize","wrapWebApp","wrapFastRender","wrapFs","wrapPicker","wrapRouters","wrapFibers","instrumented","_startInstrumenting","onReady","Server","Session","Subscription","MongoOplogDriver","MongoPollingDriver","Multiplexer","hijackDBOps","setLabels","originalOpen","MongoInternals","RemoteCollectionDriver","open","mongo","getSyncronousCursor","MongoColl","Mongo","findOne","cursor","fetch","_synchronousCursor","func","mod","upsert","eventId","endOptions","async","updatedDocs","numberAffected","insertedId","removedDocs","cursorProto","MongoCursor","cursorOptions","previousTrackNextObject","trackNextObject","endData","oplog","wasMultiplexerReady","queueLength","elapsedPollingTime","observerDriverClass","usesOplog","_cache","docs","noOfCachedDocs","initialPollingTime","_lastPollTime","reasonInfo","noOplogCode","noOplogReason","noOplogSolution","docsFetched","SyncronousCursor","origNextObject","_nextObject","shouldTrack","HTTP","originalCall","Email","EventSymbol","Symbol","StartTracked","wrapped","originalYield","yield","originalRun","originalThrowInto","throwInto","ensureFiberCounted","fiber","val","activeFiberTotal","activeFiberCount","previousTotalCreated","fibersCreated","printErrorAndKill","_tracked","getTrace","timer","throwError","nextTick","exit","originalMeteorDebug","_debug","isArgs","alreadyTracked","errorMessage","separator","endsWith","kadira_Session_send","originalSendAdds","_sendAdds","kadira_Multiplexer_sendAdds","originalMongoInsert","_insert","kadira_MongoConnection_insert","cb","originalMongoUpdate","_update","kadira_MongoConnection_update","originalMongoRemove","_remove","kadira_MongoConnection_remove","originalPubsubAdded","sendAdded","kadira_Session_sendAdded","originalPubsubChanged","sendChanged","kadira_Session_sendChanged","originalPubsubRemoved","sendRemoved","kadira_Session_sendRemoved","originalCursorForEach","kadira_Cursor_forEach","originalCursorMap","kadira_Cursor_map","originalCursorFetch","kadira_Cursor_fetch","originalCursorCount","kadira_Cursor_count","originalCursorObserveChanges","observeChanges","kadira_Cursor_observeChanges","originalCursorObserve","observe","kadira_Cursor_observe","originalCrossbarListen","DDPServer","_Crossbar","listen","kadira_Crossbar_listen","trigger","originalCrossbarFire","fire","kadira_Crossbar_fire","notification","FastRender","origRoute","route","_callback","suggestedRouteName","handleErrorEvent","wrapCallback","createWrapper","eventEmitter","listenerCount","removeListener","fsKadiraInfo","originalStat","originalCreateReadStream","PerformanceObserver","constants","performance","_observer","observer","list","getEntries","_mapKindToMetric","duration","clearGC","entryTypes","buffered","gcKind","NODE_PERFORMANCE_GC_MAJOR","NODE_PERFORMANCE_GC_MINOR","NODE_PERFORMANCE_GC_INCREMENTAL","NODE_PERFORMANCE_GC_WEAKCB","client","serverStatus","totalCheckoutTime","measurementCount","pendingTotal","checkedOutTotal","getServerStatus","getPrimary","DEFAULT_MAX_POOL_SIZE","getPoolSize","topology","s","maxPoolSize","_client","defaultRemoteCollectionDriver","versionParts","NpmModules","mongodb","part","useUnifiedTopology","primaryDescription","getServerDescription","pool","totalConnections","totalConnectionCount","availableConnections","availableConnectionCount","primary","delete","connectionId","checkoutDuration","disableCreate","lastIsMaster","lastHello","servers","description","Picker","origProcessRoute","_processRoute","connectRoutes","connectRoute","router","oldAdd","checkHandlersInFiber","WebAppInternals","MAX_BODY_SIZE","MAX_STRINGIFIED_BODY_SIZE","canWrapStaticHandler","staticFilesByArch","handlersLength","rawConnectHandlers","inFiber","outsideFiber","use","_req","_res","next","pop","InfoSymbol","parseUrl","registerBoilerplateDataCallback","request","isAppRoute","origCategorizeRequest","categorizeRequest","pathname","asyncEvent","isStatic","isJson","hasSmallBody","built","wrapHandler","errorHandler","wrapper","nextCalled","wrappedNext","potentialPromise","finished","wrapConnect","app","wrapStack","oldUse","wrappedHandler","asyncApply","meteorInternalHandlers","connectHandlers","connectApp","oldStaticFilesMiddleware","staticFilesMiddleware","staticHandler","_staticFiles","normalizedPrefix","replace","_parseEnv","normalizedName","_options","parser","str","parseBool","toLowerCase","parseString","MONTI_APP_ID","MONTI_APP_SECRET","MONTI_OPTIONS_CLIENT_ENGINE_SYNC_DELAY","MONTI_OPTIONS_ERROR_DUMP_INTERVAL","MONTI_OPTIONS_MAX_ERRORS_PER_INTERVAL","MONTI_OPTIONS_COLLECT_ALL_STACKS","MONTI_OPTIONS_ENABLE_ERROR_TRACKING","MONTI_OPTIONS_ENDPOINT","MONTI_OPTIONS_HOSTNAME","MONTI_OPTIONS_PAYLOAD_TIMEOUT","MONTI_OPTIONS_PROXY","MONTI_OPTIONS_DOCUMENT_SIZE_CACHE_SIZE","MONTI_UPLOAD_SOURCE_MAPS","MONTI_RECORD_IP_ADDRESS","MONTI_EVENT_STACK_TRACE","_connectWithEnv","_connectWithSettings","montiSettings","settings","monti","conflictingPackages"],"mappings":"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","file":"/packages/montiapm_agent.js","sourcesContent":["getClientArchVersion = function (arch) {\n  const autoupdate = __meteor_runtime_config__.autoupdate\n\n  if (autoupdate) {\n    return autoupdate.versions[arch] ? autoupdate.versions[arch].version : 'none';\n  }\n\n  // Meteor 1.7 and older did not have an `autoupdate` object.\n  switch (arch) {\n    case 'cordova.web':\n      return __meteor_runtime_config__.autoupdateVersionCordova;\n    case 'web.browser':\n    case 'web.browser.legacy':\n      // Meteor 1.7 always used the web.browser.legacy version\n      return __meteor_runtime_config__.autoupdateVersion;\n\n    default:\n      return 'none';\n  }\n}\n\nconst createStackTrace = () => {\n  if (Error.captureStackTrace) {\n    let err = {};\n    Error.captureStackTrace(err, Kadira.trackError);\n    return err.stack;\n  }\n\n  const stack = new Error().stack.split('\\n');\n  let toRemove = 0;\n\n  // Remove frames starting from when trackError was called\n  for (; toRemove < stack.length; toRemove++) {\n    if (stack[toRemove].indexOf('trackError') > -1) {\n      toRemove += 1;\n      break;\n    }\n  }\n\n  return stack.slice(toRemove).join('\\n');\n}\n\nexport const getErrorParameters = function (args) {\n  let type = null;\n  let message = null;\n  let subType = null;\n  let stack = null;\n\n  if (\n    !(args[0] instanceof Error) &&\n    typeof args[0] === 'string' &&\n    typeof args[1] === 'string'\n  ) {\n    // Old usage:\n    // Monti.trackError(\n    //   'type', 'error message', { stacks: 'error stack', subType: 'sub type }\n    // );\n\n    const options = args[2] || {};\n\n    type = args[0];\n    subType = Meteor.isClient? args[0] : options.subType;\n    message = args[1];\n    stack = options.stacks || createStackTrace();\n\n  } else {\n    // New usage:\n    // Monti.trackError(error, { type: 'type', subType: 'subType' });\n    const error = args[0];\n    const options = args[1] || {};\n    const isErrorObject = typeof error === 'object' && error !== null\n    \n    message = isErrorObject ? error.message : error;\n    stack = isErrorObject && error.stack || createStackTrace();\n    type = options.type;\n    subType = options.subType;\n  }\n\n  return { type, message, subType, stack }\n}\n","Kadira = {};\nKadira.options = {};\n\nMonti = Kadira;\n\nif(Meteor.wrapAsync) {\n  Kadira._wrapAsync = Meteor.wrapAsync;\n} else {\n  Kadira._wrapAsync = Meteor._wrapAsync;\n}\n\nif(Meteor.isServer) {\n  var EventEmitter = Npm.require('events').EventEmitter;\n  var eventBus = new EventEmitter();\n  eventBus.setMaxListeners(0);\n\n  var buildArgs = function(args) {\n    var eventName = args[0] + '-' + args[1];\n    var args = args.slice(2);\n    args.unshift(eventName);\n    return args;\n  };\n  \n  Kadira.EventBus = {};\n  ['on', 'emit', 'removeListener', 'removeAllListeners'].forEach(function(m) {\n    Kadira.EventBus[m] = function(...args) {\n      var args = buildArgs(args);\n      return eventBus[m].apply(eventBus, args);\n    };\n  });\n}","var commonErrRegExps = [\n  /connection timeout\\. no (\\w*) heartbeat received/i,\n  /INVALID_STATE_ERR/i,\n];\n\nKadira.errorFilters = {\n  filterValidationErrors: function(type, message, err) {\n    if(err && err instanceof Meteor.Error) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  filterCommonMeteorErrors: function(type, message) {\n    for(var lc=0; lc<commonErrRegExps.length; lc++) {\n      var regExp = commonErrRegExps[lc];\n      if(regExp.test(message)) {\n        return false;\n      }\n    }\n    return true;\n  }\n};","Kadira.send = function (payload, path, callback) {\n  if(!Kadira.connected)  {\n    throw new Error(\"You need to connect with Kadira first, before sending messages!\");\n  }\n\n  path = (path.substr(0, 1) != '/')? \"/\" + path : path;\n  var endpoint = Kadira.options.endpoint + path;\n  var retryCount = 0;\n  var retry = new Retry({\n    minCount: 1,\n    minTimeout: 0,\n    baseTimeout: 1000*5,\n    maxTimeout: 1000*60,\n  });\n\n  var sendFunction = Kadira._getSendFunction();\n  tryToSend();\n\n  function tryToSend(err) {\n    if(retryCount < 5) {\n      retry.retryLater(retryCount++, send);\n    } else {\n      console.warn('Error sending error traces to Monti APM server');\n      if(callback) callback(err);\n    }\n  }\n\n  function send() {\n    sendFunction(endpoint, payload, function(err, res) {\n      if(err && !res) {\n        tryToSend(err);\n      } else if(res.statusCode == 200) {\n        if(callback) callback(null, res.data);\n      } else {\n        if(callback) callback(new Meteor.Error(res.statusCode, res.content));\n      }\n    });\n  }\n};\n\nKadira._getSendFunction = function() {\n  return (Meteor.isServer)? Kadira._serverSend : Kadira._clientSend;\n};\n\nKadira._clientSend = function (endpoint, payload, callback) {\n  httpRequest('POST', endpoint, {\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    content: JSON.stringify(payload)\n  }, callback);\n}\n\nKadira._serverSend = function () {\n  throw new Error('Kadira._serverSend is not supported. Use coreApi instead.');\n}\n","BaseErrorModel = function(options) {\n  this._filters = [];\n};\n\nBaseErrorModel.prototype.addFilter = function(filter) {\n  if(typeof filter === 'function') {\n    this._filters.push(filter);\n  } else {\n    throw new Error(\"Error filter must be a function\");\n  }\n};\n\nBaseErrorModel.prototype.removeFilter = function(filter) {\n  var index = this._filters.indexOf(filter);\n  if(index >= 0) {\n    this._filters.splice(index, 1);\n  }\n};\n\nBaseErrorModel.prototype.applyFilters = function(type, message, error, subType) {\n  for(var lc=0; lc<this._filters.length; lc++) {\n    var filter = this._filters[lc];\n    try {\n      var validated = filter(type, message, error, subType);\n      if(!validated) return false;\n    } catch (ex) {\n      // we need to remove this filter\n      // we may ended up in a error cycle\n      this._filters.splice(lc, 1);\n      throw new Error(\"an error thrown from a filter you've suplied\", ex.message);\n    }\n  }\n\n  return true;\n};","KadiraModel = function() {\n\n};\n\nKadiraModel.prototype._getDateId = function(timestamp) {\n  var remainder = timestamp % (1000 * 60);\n  var dateId = timestamp - remainder;\n  return dateId;\n};","const { DDSketch } = require('monti-apm-sketches-js');\n\nvar METHOD_METRICS_FIELDS = ['wait', 'db', 'http', 'email', 'async', 'compute', 'total'];\n\nMethodsModel = function (metricsThreshold) {\n  this.methodMetricsByMinute = Object.create(null);\n  this.errorMap = Object.create(null);\n\n  this._metricsThreshold = _.extend({\n    \"wait\": 100,\n    \"db\": 100,\n    \"http\": 1000,\n    \"email\": 100,\n    \"async\": 100,\n    \"compute\": 100,\n    \"total\": 200\n  }, metricsThreshold || Object.create(null));\n\n  //store max time elapsed methods for each method, event(metrics-field)\n  this.maxEventTimesForMethods = Object.create(null);\n\n  this.tracerStore = new TracerStore({\n    interval: 1000 * 60, //process traces every minute\n    maxTotalPoints: 30, //for 30 minutes\n    archiveEvery: 5 //always trace for every 5 minutes,\n  });\n\n  this.tracerStore.start();\n};\n\n_.extend(MethodsModel.prototype, KadiraModel.prototype);\n\nMethodsModel.prototype._getMetrics = function(timestamp, method) {\n  var dateId = this._getDateId(timestamp);\n\n  if(!this.methodMetricsByMinute[dateId]) {\n    this.methodMetricsByMinute[dateId] = {\n      methods: Object.create(null),\n    };\n  }\n\n  var methods = this.methodMetricsByMinute[dateId].methods;\n\n  //initialize method\n  if(!methods[method]) {\n    methods[method] = {\n      count: 0,\n      errors: 0,\n      fetchedDocSize: 0,\n      sentMsgSize: 0,\n      histogram: new DDSketch({\n        alpha: 0.02\n      })\n    };\n\n    METHOD_METRICS_FIELDS.forEach(function(field) {\n      methods[method][field] = 0;\n    });\n  }\n\n  return this.methodMetricsByMinute[dateId].methods[method];\n};\n\nMethodsModel.prototype.setStartTime = function(timestamp) {\n  this.metricsByMinute[dateId].startTime = timestamp;\n}\n\nMethodsModel.prototype.processMethod = function(methodTrace) {\n  var dateId = this._getDateId(methodTrace.at);\n\n  //append metrics to previous values\n  this._appendMetrics(dateId, methodTrace);\n  if(methodTrace.errored) {\n    this.methodMetricsByMinute[dateId].methods[methodTrace.name].errors ++\n  }\n\n  this.tracerStore.addTrace(methodTrace);\n};\n\nMethodsModel.prototype._appendMetrics = function(id, methodTrace) {\n  var methodMetrics = this._getMetrics(id, methodTrace.name)\n\n  // startTime needs to be converted into serverTime before sending\n  if(!this.methodMetricsByMinute[id].startTime){\n    this.methodMetricsByMinute[id].startTime = methodTrace.at;\n  }\n\n  //merge\n  METHOD_METRICS_FIELDS.forEach(function(field) {\n    var value = methodTrace.metrics[field];\n    if(value > 0) {\n      methodMetrics[field] += value;\n    }\n  });\n\n  methodMetrics.count++;\n  methodMetrics.histogram.add(methodTrace.metrics.total);\n  this.methodMetricsByMinute[id].endTime = methodTrace.metrics.at;\n};\n\nMethodsModel.prototype.trackDocSize = function(method, size) {\n  var timestamp = Ntp._now();\n  var dateId = this._getDateId(timestamp);\n\n  var methodMetrics = this._getMetrics(dateId, method);\n  methodMetrics.fetchedDocSize += size;\n}\n\nMethodsModel.prototype.trackMsgSize = function(method, size) {\n  var timestamp = Ntp._now();\n  var dateId = this._getDateId(timestamp);\n\n  var methodMetrics = this._getMetrics(dateId, method);\n  methodMetrics.sentMsgSize += size;\n}\n\n/*\n  There are two types of data\n\n  1. methodMetrics - metrics about the methods (for every 10 secs)\n  2. methodRequests - raw method request. normally max, min for every 1 min and errors always\n*/\nMethodsModel.prototype.buildPayload = function(buildDetailedInfo) {\n  var payload = {\n    methodMetrics: [],\n    methodRequests: []\n  };\n\n  //handling metrics\n  var methodMetricsByMinute = this.methodMetricsByMinute;\n  this.methodMetricsByMinute = Object.create(null);\n\n  //create final paylod for methodMetrics\n  for(var key in methodMetricsByMinute) {\n    var methodMetrics = methodMetricsByMinute[key];\n    // converting startTime into the actual serverTime\n    var startTime = methodMetrics.startTime;\n    methodMetrics.startTime = Kadira.syncedDate.syncTime(startTime);\n\n    for(var methodName in methodMetrics.methods) {\n      METHOD_METRICS_FIELDS.forEach(function(field) {\n        methodMetrics.methods[methodName][field] /=\n          methodMetrics.methods[methodName].count;\n      });\n    }\n\n    payload.methodMetrics.push(methodMetricsByMinute[key]);\n  }\n\n  //collect traces and send them with the payload\n  payload.methodRequests = this.tracerStore.collectTraces();\n\n  return payload;\n};\n","var logger = Npm.require('debug')('kadira:pubsub');\nconst { DDSketch } = require('monti-apm-sketches-js');\n\nPubsubModel = function() {\n  this.metricsByMinute = Object.create(null);\n  this.subscriptions = Object.create(null);\n\n  this.tracerStore = new TracerStore({\n    interval: 1000 * 60, //process traces every minute\n    maxTotalPoints: 30, //for 30 minutes\n    archiveEvery: 5 //always trace for every 5 minutes,\n  });\n\n  this.tracerStore.start();\n}\n\nPubsubModel.prototype._trackSub = function(session, msg) {\n  logger('SUB:', session.id, msg.id, msg.name, msg.params);\n  var publication = this._getPublicationName(msg.name);\n  var subscriptionId = msg.id;\n  var timestamp = Ntp._now();\n  var metrics = this._getMetrics(timestamp, publication);\n\n  metrics.subs++;\n  this.subscriptions[msg.id] = {\n    // We use localTime here, because when we used synedTime we might get\n    // minus or more than we've expected\n    //   (before serverTime diff changed overtime)\n    startTime: timestamp,\n    publication: publication,\n    params: msg.params,\n    id: msg.id\n  };\n\n  //set session startedTime\n  session._startTime = session._startTime || timestamp;\n};\n\n_.extend(PubsubModel.prototype, KadiraModel.prototype);\n\nPubsubModel.prototype._trackUnsub = function(session, sub) {\n  logger('UNSUB:', session.id, sub._subscriptionId);\n  var publication = this._getPublicationName(sub._name);\n  var subscriptionId = sub._subscriptionId;\n  var subscriptionState = this.subscriptions[subscriptionId];\n\n  var startTime = null;\n  //sometime, we don't have these states\n  if(subscriptionState) {\n    startTime = subscriptionState.startTime;\n  } else {\n    //if this is null subscription, which is started automatically\n    //hence, we don't have a state\n    startTime = session._startTime;\n  }\n\n  //in case, we can't get the startTime\n  if(startTime) {\n    var timestamp = Ntp._now();\n    var metrics = this._getMetrics(timestamp, publication);\n    //track the count\n    if(sub._name != null) {\n      // we can't track subs for `null` publications.\n      // so we should not track unsubs too\n      metrics.unsubs++;\n    }\n    //use the current date to get the lifeTime of the subscription\n    metrics.lifeTime += timestamp - startTime;\n    //this is place we can clean the subscriptionState if exists\n    delete this.subscriptions[subscriptionId];\n  }\n};\n\nPubsubModel.prototype._trackReady = function(session, sub, trace) {\n  logger('READY:', session.id, sub._subscriptionId);\n  //use the current time to track the response time\n  var publication = this._getPublicationName(sub._name);\n  var subscriptionId = sub._subscriptionId;\n  var timestamp = Ntp._now();\n  var metrics = this._getMetrics(timestamp, publication);\n\n  var subscriptionState = this.subscriptions[subscriptionId];\n  if(subscriptionState && !subscriptionState.readyTracked) {\n    var resTime = timestamp - subscriptionState.startTime\n    metrics.resTime += resTime;\n    subscriptionState.readyTracked = true;\n    metrics.histogram.add(resTime);\n  }\n\n  if(trace) {\n    this.tracerStore.addTrace(trace);\n  }\n};\n\nPubsubModel.prototype._trackError = function(session, sub, trace) {\n  logger('ERROR:', session.id, sub._subscriptionId);\n  //use the current time to track the response time\n  var publication = this._getPublicationName(sub._name);\n  var subscriptionId = sub._subscriptionId;\n  var timestamp = Ntp._now();\n  var metrics = this._getMetrics(timestamp, publication);\n\n  metrics.errors++;\n\n  if(trace) {\n    this.tracerStore.addTrace(trace);\n  }\n};\n\nPubsubModel.prototype._getMetrics = function(timestamp, publication) {\n  var dateId = this._getDateId(timestamp);\n\n  if(!this.metricsByMinute[dateId]) {\n    this.metricsByMinute[dateId] = {\n      // startTime needs to be convert to serverTime before sending to the server\n      startTime: timestamp,\n      pubs: Object.create(null)\n    };\n  }\n\n  if(!this.metricsByMinute[dateId].pubs[publication]) {\n    this.metricsByMinute[dateId].pubs[publication] = {\n      subs: 0,\n      unsubs: 0,\n      resTime: 0,\n      activeSubs: 0,\n      activeDocs: 0,\n      lifeTime: 0,\n      totalObservers: 0,\n      cachedObservers: 0,\n      createdObservers: 0,\n      deletedObservers: 0,\n      errors: 0,\n      observerLifetime: 0,\n      polledDocuments: 0,\n      oplogUpdatedDocuments: 0,\n      oplogInsertedDocuments: 0,\n      oplogDeletedDocuments: 0,\n      initiallyAddedDocuments: 0,\n      liveAddedDocuments: 0,\n      liveChangedDocuments: 0,\n      liveRemovedDocuments: 0,\n      polledDocSize: 0,\n      fetchedDocSize: 0,\n      initiallyFetchedDocSize: 0,\n      liveFetchedDocSize: 0,\n      initiallySentMsgSize: 0,\n      liveSentMsgSize: 0,\n      histogram: new DDSketch({\n        alpha: 0.02\n      })\n    };\n  }\n\n  return this.metricsByMinute[dateId].pubs[publication];\n};\n\nPubsubModel.prototype._getPublicationName = function(name) {\n  return name || \"null(autopublish)\";\n};\n\nPubsubModel.prototype._getSubscriptionInfo = function() {\n  var self = this;\n  var activeSubs = Object.create(null);\n  var activeDocs = Object.create(null);\n  var totalDocsSent = Object.create(null);\n  var totalDataSent = Object.create(null);\n  var totalObservers = Object.create(null);\n  var cachedObservers = Object.create(null);\n\n  iterate(Meteor.server.sessions, session => {\n    iterate(session._namedSubs, countSubData);\n    iterate(session._universalSubs, countSubData);\n  });\n\n  var avgObserverReuse = Object.create(null);\n  _.each(totalObservers, function(value, publication) {\n    avgObserverReuse[publication] = cachedObservers[publication] / totalObservers[publication];\n  });\n\n  return {\n    activeSubs: activeSubs,\n    activeDocs: activeDocs,\n    avgObserverReuse: avgObserverReuse\n  };\n\n  function countSubData (sub) {\n    var publication = self._getPublicationName(sub._name);\n    countSubscriptions(sub, publication);\n    countDocuments(sub, publication);\n    countObservers(sub, publication);\n  }\n\n  function countSubscriptions (sub, publication) {\n    activeSubs[publication] = activeSubs[publication] || 0;\n    activeSubs[publication]++;\n  }\n\n  function countDocuments (sub, publication) {\n    activeDocs[publication] = activeDocs[publication] || 0;\n    iterate(sub._documents, collection => {\n      activeDocs[publication] += countKeys(collection);\n    });\n  }\n\n  function countObservers(sub, publication) {\n    totalObservers[publication] = totalObservers[publication] || 0;\n    cachedObservers[publication] = cachedObservers[publication] || 0;\n\n    totalObservers[publication] += sub._totalObservers;\n    cachedObservers[publication] += sub._cachedObservers;\n  }\n}\n\nPubsubModel.prototype.buildPayload = function(buildDetailInfo) {\n  var metricsByMinute = this.metricsByMinute;\n  this.metricsByMinute = Object.create(null);\n\n  var payload = {\n    pubMetrics: []\n  };\n\n  var subscriptionData = this._getSubscriptionInfo();\n  var activeSubs = subscriptionData.activeSubs;\n  var activeDocs = subscriptionData.activeDocs;\n  var avgObserverReuse = subscriptionData.avgObserverReuse;\n\n  //to the averaging\n  for(var dateId in metricsByMinute) {\n    var dateMetrics = metricsByMinute[dateId];\n    // We need to convert startTime into actual serverTime\n    dateMetrics.startTime = Kadira.syncedDate.syncTime(dateMetrics.startTime);\n\n    for(var publication in metricsByMinute[dateId].pubs) {\n      var singlePubMetrics = metricsByMinute[dateId].pubs[publication];\n      // We only calculate resTime for new subscriptions\n      singlePubMetrics.resTime /= singlePubMetrics.subs;\n      singlePubMetrics.resTime = singlePubMetrics.resTime || 0;\n      // We only track lifeTime in the unsubs\n      singlePubMetrics.lifeTime /= singlePubMetrics.unsubs;\n      singlePubMetrics.lifeTime = singlePubMetrics.lifeTime || 0;\n\n      // Count the average for observer lifetime\n      if(singlePubMetrics.deletedObservers > 0) {\n        singlePubMetrics.observerLifetime /= singlePubMetrics.deletedObservers;\n      }\n\n      // If there are two ore more dateIds, we will be using the currentCount for all of them.\n      // We can come up with a better solution later on.\n      singlePubMetrics.activeSubs = activeSubs[publication] || 0;\n      singlePubMetrics.activeDocs = activeDocs[publication] || 0;\n      singlePubMetrics.avgObserverReuse = avgObserverReuse[publication] || 0;\n    }\n\n    payload.pubMetrics.push(metricsByMinute[dateId]);\n  }\n\n  //collect traces and send them with the payload\n  payload.pubRequests = this.tracerStore.collectTraces();\n\n  return payload;\n};\n\nPubsubModel.prototype.incrementHandleCount = function(trace, isCached) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(trace.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  var session = getProperty(Meteor.server.sessions, trace.session);\n  if(session) {\n    var sub = getProperty(session._namedSubs, trace.id);\n    if(sub) {\n      sub._totalObservers = sub._totalObservers || 0;\n      sub._cachedObservers = sub._cachedObservers || 0;\n    }\n  }\n  // not sure, we need to do this? But I don't need to break the however\n  sub = sub || {_totalObservers:0 , _cachedObservers: 0};\n\n  publication.totalObservers++;\n  sub._totalObservers++;\n  if(isCached) {\n    publication.cachedObservers++;\n    sub._cachedObservers++;\n  }\n}\n\nPubsubModel.prototype.trackCreatedObserver = function(info) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  publication.createdObservers++;\n}\n\nPubsubModel.prototype.trackDeletedObserver = function(info) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  publication.deletedObservers++;\n  publication.observerLifetime += (new Date()).getTime() - info.startTime;\n}\n\nPubsubModel.prototype.trackDocumentChanges = function(info, op) {\n  // It's possibel that info to be null\n  // Specially when getting changes at the very begining.\n  // This may be false, but nice to have a check\n  if(!info) {\n    return\n  }\n\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  if(op.op === \"d\") {\n    publication.oplogDeletedDocuments++;\n  } else if(op.op === \"i\") {\n    publication.oplogInsertedDocuments++;\n  } else if(op.op === \"u\") {\n    publication.oplogUpdatedDocuments++;\n  }\n}\n\nPubsubModel.prototype.trackPolledDocuments = function(info, count) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n  publication.polledDocuments += count;\n}\n\nPubsubModel.prototype.trackLiveUpdates = function(info, type, count) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(info.name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  if(type === \"_addPublished\") {\n    publication.liveAddedDocuments += count;\n  } else if(type === \"_removePublished\") {\n    publication.liveRemovedDocuments += count;\n  } else if(type === \"_changePublished\") {\n    publication.liveChangedDocuments += count;\n  } else if(type === \"_initialAdds\") {\n    publication.initiallyAddedDocuments += count;\n  } else {\n    throw new Error(\"Kadira: Unknown live update type\");\n  }\n}\n\nPubsubModel.prototype.trackDocSize = function(name, type, size) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  if(type === \"polledFetches\") {\n    publication.polledDocSize += size;\n  } else if(type === \"liveFetches\") {\n    publication.liveFetchedDocSize += size;\n  } else if(type === \"cursorFetches\") {\n    publication.fetchedDocSize += size;\n  } else if(type === \"initialFetches\") {\n    publication.initiallyFetchedDocSize += size;\n  } else {\n    throw new Error(\"Kadira: Unknown docs fetched type\");\n  }\n}\n\nPubsubModel.prototype.trackMsgSize = function(name, type, size) {\n  var timestamp = Ntp._now();\n  var publicationName = this._getPublicationName(name);\n  var publication = this._getMetrics(timestamp, publicationName);\n\n  if(type === \"liveSent\") {\n    publication.liveSentMsgSize += size;\n  } else if(type === \"initialSent\") {\n    publication.initiallySentMsgSize += size;\n  } else {\n    throw new Error(\"Kadira: Unknown docs fetched type\");\n  }\n}\n","var EventLoopMonitor = Npm.require('evloop-monitor');\nimport { createHistogram } from '../utils.js';\nimport GCMetrics from '../hijack/gc.js';\nimport { getFiberMetrics, resetFiberMetrics } from '../hijack/async.js';\nimport { getMongoDriverStats, resetMongoDriverStats } from '../hijack/mongo_driver_events.js';\n\nSystemModel = function () {\n  this.startTime = Ntp._now();\n  this.newSessions = 0;\n  this.sessionTimeout = 1000 * 60 * 30; //30 min\n\n  this.evloopHistogram = createHistogram();\n  this.evloopMonitor = new EventLoopMonitor(200);\n  this.evloopMonitor.start();\n  this.evloopMonitor.on('lag', lag => {\n    // store as microsecond\n    this.evloopHistogram.add(lag * 1000);\n  });\n\n  this.gcMetrics = new GCMetrics();\n  this.gcMetrics.start();\n\n\n  this.cpuTime = process.hrtime();\n  this.previousCpuUsage = process.cpuUsage();\n  this.cpuHistory = [];\n  this.currentCpuUsage = 0;\n\n  setInterval(() => {\n    this.cpuUsage();\n  }, 2000);\n}\n\n_.extend(SystemModel.prototype, KadiraModel.prototype);\n\nSystemModel.prototype.buildPayload = function() {\n  var metrics = {};\n  var now = Ntp._now();\n  metrics.startTime = Kadira.syncedDate.syncTime(this.startTime);\n  metrics.endTime = Kadira.syncedDate.syncTime(now);\n  metrics.sessions = countKeys(Meteor.server.sessions);\n\n  let memoryUsage = process.memoryUsage();\n  metrics.memory = memoryUsage.rss / (1024*1024);\n  metrics.memoryArrayBuffers = (memoryUsage.arrayBuffers || 0) / (1024*1024);\n  metrics.memoryExternal = memoryUsage.external / (1024*1024);\n  metrics.memoryHeapUsed = memoryUsage.heapUsed / (1024*1024);\n  metrics.memoryHeapTotal = memoryUsage.heapTotal / (1024*1024);\n\n  metrics.newSessions = this.newSessions;\n  this.newSessions = 0;\n\n  metrics.activeRequests = process._getActiveRequests().length;\n  metrics.activeHandles = process._getActiveHandles().length;\n\n  // track eventloop metrics\n  metrics.pctEvloopBlock = this.evloopMonitor.status().pctBlock;\n  metrics.evloopHistogram = this.evloopHistogram;\n  this.evloopHistogram = createHistogram();\n\n  metrics.gcMajorDuration = this.gcMetrics.metrics.gcMajor;\n  metrics.gcMinorDuration = this.gcMetrics.metrics.gcMinor;\n  metrics.gcIncrementalDuration = this.gcMetrics.metrics.gcIncremental;\n  metrics.gcWeakCBDuration = this.gcMetrics.metrics.gcWeakCB;\n  this.gcMetrics.reset();\n\n  const driverMetrics = getMongoDriverStats();\n  resetMongoDriverStats();\n\n  metrics.mongoPoolSize = driverMetrics.poolSize;\n  metrics.mongoPoolPrimaryCheckouts = driverMetrics.primaryCheckouts;\n  metrics.mongoPoolOtherCheckouts = driverMetrics.otherCheckouts;\n  metrics.mongoPoolCheckoutTime = driverMetrics.checkoutTime;\n  metrics.mongoPoolMaxCheckoutTime = driverMetrics.maxCheckoutTime;\n  metrics.mongoPoolPending = driverMetrics.pending;\n  metrics.mongoPoolCheckedOutConnections = driverMetrics.checkedOut;\n  metrics.mongoPoolCreatedConnections = driverMetrics.created;\n\n  const fiberMetrics = getFiberMetrics();\n  resetFiberMetrics();\n  metrics.createdFibers = fiberMetrics.created;\n  metrics.activeFibers = fiberMetrics.active;\n  metrics.fiberPoolSize = fiberMetrics.poolSize;\n\n  metrics.pcpu = 0;\n  metrics.pcpuUser = 0;\n  metrics.pcpuSystem = 0;\n\n  if (this.cpuHistory.length > 0) {\n    let lastCpuUsage = this.cpuHistory[this.cpuHistory.length - 1];\n    metrics.pcpu = lastCpuUsage.usage * 100;\n    metrics.pcpuUser = lastCpuUsage.user * 100;\n    metrics.pcpuSystem = lastCpuUsage.sys * 100;\n  }\n\n  metrics.cpuHistory = this.cpuHistory.map(entry => {\n    return {\n      time: Kadira.syncedDate.syncTime(entry.time),\n      usage: entry.usage,\n      sys: entry.sys,\n      user: entry.user\n    };\n  });\n\n  this.cpuHistory = [];\n  this.startTime = now;\n  return {systemMetrics: [metrics]};\n};\n\nfunction hrtimeToMS(hrtime) {\n  return hrtime[0] * 1000 + hrtime[1] / 1000000;\n}\n\nSystemModel.prototype.cpuUsage = function() {\n  var elapTimeMS = hrtimeToMS(process.hrtime(this.cpuTime));\n  var elapUsage = process.cpuUsage(this.previousCpuUsage);\n  var elapUserMS = elapUsage.user / 1000;\n  var elapSystMS = elapUsage.system / 1000;\n  var totalUsageMS = elapUserMS + elapSystMS;\n  var totalUsagePercent = totalUsageMS / elapTimeMS;\n\n  this.cpuHistory.push({\n    time: Ntp._now(),\n    usage: totalUsagePercent,\n    user: elapUserMS / elapTimeMS,\n    sys: elapSystMS / elapUsage.system\n  });\n\n  this.currentCpuUsage = totalUsagePercent * 100;\n  Kadira.docSzCache.setPcpu(this.currentCpuUsage);\n\n  this.cpuTime = process.hrtime();\n  this.previousCpuUsage = process.cpuUsage();\n}\n\nSystemModel.prototype.handleSessionActivity = function(msg, session) {\n  if(msg.msg === 'connect' && !msg.session) {\n    this.countNewSession(session);\n  } else if(['sub', 'method'].indexOf(msg.msg) != -1) {\n    if(!this.isSessionActive(session)) {\n      this.countNewSession(session);\n    }\n  }\n  session._activeAt = Date.now();\n}\n\nSystemModel.prototype.countNewSession = function(session) {\n  if(!isLocalAddress(session.socket)) {\n    this.newSessions++;\n  }\n}\n\nSystemModel.prototype.isSessionActive = function(session) {\n  var inactiveTime = Date.now() - session._activeAt;\n  return inactiveTime < this.sessionTimeout;\n}\n\n// ------------------------------------------------------------------------- //\n\n// http://regex101.com/r/iF3yR3/2\nvar isLocalHostRegex = /^(?:.*\\.local|localhost)(?:\\:\\d+)?|127(?:\\.\\d{1,3}){3}|192\\.168(?:\\.\\d{1,3}){2}|10(?:\\.\\d{1,3}){3}|172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2}$/;\n\n// http://regex101.com/r/hM5gD8/1\nvar isLocalAddressRegex = /^127(?:\\.\\d{1,3}){3}|192\\.168(?:\\.\\d{1,3}){2}|10(?:\\.\\d{1,3}){3}|172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2}$/;\n\nfunction isLocalAddress (socket) {\n  var host = socket.headers['host'];\n  if(host) return isLocalHostRegex.test(host);\n  var address = socket.headers['x-forwarded-for'] || socket.remoteAddress;\n  if(address) return isLocalAddressRegex.test(address);\n}\n","ErrorModel = function (appId) {\n  BaseErrorModel.call(this);\n  var self = this;\n  this.appId = appId;\n  this.errors = {};\n  this.startTime = Date.now();\n  this.maxErrors = 10;\n}\n\nObject.assign(ErrorModel.prototype, KadiraModel.prototype);\nObject.assign(ErrorModel.prototype, BaseErrorModel.prototype);\n\nErrorModel.prototype.buildPayload = function() {\n  var metrics = _.values(this.errors);\n  this.startTime = Ntp._now();\n\n  metrics.forEach(function (metric) {\n    metric.startTime = Kadira.syncedDate.syncTime(metric.startTime)\n  });\n\n  this.errors = {};\n  return {errors: metrics};\n};\n\nErrorModel.prototype.errorCount = function () {\n  return _.values(this.errors).length;\n};\n\nErrorModel.prototype.trackError = function(ex, trace) {\n  var key = trace.type + ':' + ex.message;\n  if(this.errors[key]) {\n    this.errors[key].count++;\n  } else if (this.errorCount() < this.maxErrors) {\n    var errorDef = this._formatError(ex, trace);\n    if(this.applyFilters(errorDef.type, errorDef.name, ex, errorDef.subType)) {\n      this.errors[key] = this._formatError(ex, trace);\n    }\n  }\n};\n\nErrorModel.prototype._formatError = function(ex, trace) {\n  var time = Date.now();\n  var stack = ex.stack;\n\n  // to get Meteor's Error details\n  if(ex.details) {\n    stack = \"Details: \" + ex.details + \"\\r\\n\" + stack;\n  }\n\n  // Update trace's error event with the next stack\n  var errorEvent = trace.events && trace.events[trace.events.length -1];\n  var errorObject = errorEvent && errorEvent[2] && errorEvent[2].error;\n\n  if(errorObject) {\n    errorObject.stack = stack;\n  }\n\n  return {\n    appId: this.appId,\n    name: ex.message,\n    type: trace.type,\n    startTime: time,\n    subType: trace.subType || trace.name,\n    trace: trace,\n    stacks: [{stack: stack}],\n    count: 1\n  }\n};\n","const { DDSketch } = require('monti-apm-sketches-js');\n\nconst METHOD_METRICS_FIELDS = ['db', 'http', 'email', 'async', 'compute', 'total', 'fs'];\n\n\nconst HttpModel = function () {\n  this.metricsByMinute = Object.create(null);\n  this.tracerStore = new TracerStore({\n    interval: 1000 * 10,\n    maxTotalPoints: 30,\n    archiveEvery: 10\n  });\n\n  this.tracerStore.start();\n}\n\n_.extend(HttpModel.prototype, KadiraModel.prototype);\n\nHttpModel.prototype.processRequest = function (trace, req, res) {\n  const dateId = this._getDateId(trace.at);\n  this._appendMetrics(dateId, trace, res);\n  this.tracerStore.addTrace(trace);\n}\n\nHttpModel.prototype._getMetrics = function (timestamp, routeId) {\n  const dateId = this._getDateId(timestamp);\n\n  if (!this.metricsByMinute[dateId]) {\n    this.metricsByMinute[dateId] = {\n      routes: Object.create(null)\n    };\n  }\n\n  const routes = this.metricsByMinute[dateId].routes;\n\n  if (!routes[routeId]) {\n    routes[routeId] = {\n      histogram: new DDSketch({\n        alpha: 0.02,\n      }),\n      count: 0,\n      errors: 0,\n      statusCodes: Object.create(null)\n    };\n\n    METHOD_METRICS_FIELDS.forEach(function (field) {\n      routes[routeId][field] = 0;\n    });\n  }\n\n  return this.metricsByMinute[dateId].routes[routeId];\n}\n\nHttpModel.prototype._appendMetrics = function (dateId, trace, res) {\n  var requestMetrics = this._getMetrics(dateId, trace.name);\n\n  if (!this.metricsByMinute[dateId].startTime) {\n    this.metricsByMinute[dateId].startTime = trace.at;\n  }\n\n  // merge\n  METHOD_METRICS_FIELDS.forEach(field => {\n    var value = trace.metrics[field];\n    if (value > 0) {\n      requestMetrics[field] += value;\n    }\n  });\n\n  const statusCode = res.statusCode;\n  let statusMetric;\n\n  if (statusCode < 200) {\n    statusMetric = '1xx';\n  } else if (statusCode < 300) {\n    statusMetric = '2xx';\n  } else if (statusCode < 400) {\n    statusMetric = '3xx';\n  } else if (statusCode < 500) {\n    statusMetric = '4xx';\n  } else if (statusCode < 600) {\n    statusMetric = '5xx';\n  }\n\n  requestMetrics.statusCodes[statusMetric] = requestMetrics.statusCodes[statusMetric] || 0;\n  requestMetrics.statusCodes[statusMetric] += 1;\n\n  requestMetrics.count += 1;\n  requestMetrics.histogram.add(trace.metrics.total);\n  this.metricsByMinute[dateId].endTime = trace.metrics.at;\n}\n\nHttpModel.prototype.buildPayload = function() {\n  var payload = {\n    httpMetrics: [],\n    httpRequests: []\n  };\n\n  var metricsByMinute = this.metricsByMinute;\n  this.metricsByMinute = Object.create(null);\n\n  for(var key in metricsByMinute) {\n    var metrics = metricsByMinute[key];\n    // convert startTime into the actual serverTime\n    var startTime = metrics.startTime;\n    metrics.startTime = Kadira.syncedDate.syncTime(startTime);\n\n    for(var requestName in metrics.routes) {\n      METHOD_METRICS_FIELDS.forEach(function (field) {\n        metrics.routes[requestName][field] /= metrics.routes[requestName].count;\n      });\n    }\n\n    payload.httpMetrics.push(metricsByMinute[key]);\n  }\n\n  payload.httpRequests = this.tracerStore.collectTraces();\n\n  return payload;\n}\n\nexport default HttpModel;\n","var Jobs = Kadira.Jobs = {};\n\nJobs.getAsync = function(id, callback) {\n  Kadira.coreApi.getJob(id)\n    .then(function(data) {\n      callback(null, data);\n    })\n    .catch(function(err) {\n      callback(err)\n    });\n};\n\n\nJobs.setAsync = function(id, changes, callback) {\n  Kadira.coreApi.updateJob(id, changes)\n    .then(function(data) {\n      callback(null, data);\n    })\n    .catch(function(err) {\n      callback(err)\n    });\n};\n\nJobs.set = Kadira._wrapAsync(Jobs.setAsync);\nJobs.get = Kadira._wrapAsync(Jobs.getAsync);\n","// Retry logic with an exponential backoff.\n//\n// options:\n//  baseTimeout: time for initial reconnect attempt (ms).\n//  exponent: exponential factor to increase timeout each attempt.\n//  maxTimeout: maximum time between retries (ms).\n//  minCount: how many times to reconnect \"instantly\".\n//  minTimeout: time to wait for the first `minCount` retries (ms).\n//  fuzz: factor to randomize retry times by (to avoid retry storms).\n\n//TODO: remove this class and use Meteor Retry in a later version of meteor.\n\nRetry = class {\n  constructor ({\n    baseTimeout = 1000, // 1 second\n    exponent = 2.2,\n    // The default is high-ish to ensure a server can recover from a\n    // failure caused by load.\n    maxTimeout = 5 * 60000, // 5 minutes\n    minTimeout = 10,\n    minCount = 2,\n    fuzz = 0.5, // +- 25%\n  } = {}) {\n    this.baseTimeout = baseTimeout;\n    this.exponent = exponent;\n    this.maxTimeout = maxTimeout;\n    this.minTimeout = minTimeout;\n    this.minCount = minCount;\n    this.fuzz = fuzz;\n    this.retryTimer = null;\n  }\n\n  // Reset a pending retry, if any.\n  clear() {\n    if(this.retryTimer)\n      clearTimeout(this.retryTimer);\n    this.retryTimer = null;\n  }\n\n  // Calculate how long to wait in milliseconds to retry, based on the\n  // `count` of which retry this is.\n  _timeout(count) {\n    if(count < this.minCount)\n      return this.minTimeout;\n\n    let timeout = Math.min(\n      this.maxTimeout,\n      this.baseTimeout * Math.pow(this.exponent, count));\n    // fuzz the timeout randomly, to avoid reconnect storms when a\n    // server goes down.\n    timeout = timeout * ((Random.fraction() * this.fuzz) +\n                         (1 - this.fuzz/2));\n    return Math.ceil(timeout);\n  }\n\n  // Call `fn` after a delay, based on the `count` of which retry this is.\n  retryLater(count, fn) {\n    const timeout = this._timeout(count);\n    if(this.retryTimer)\n      clearTimeout(this.retryTimer);\n\n    this.retryTimer = setTimeout(fn, timeout);\n    return timeout;\n  }\n\n}\n\n","const { DDSketch } = require('monti-apm-sketches-js');\n\nHaveAsyncCallback = function(args) {\n  var lastArg = args[args.length -1];\n  return (typeof lastArg) == 'function';\n};\n\nUniqueId = function(start) {\n  this.id = 0;\n}\n\nUniqueId.prototype.get = function() {\n  return \"\" + this.id++;\n};\n\nDefaultUniqueId = new UniqueId();\n\n// creates a stack trace, removing frames in montiapm:agent's code\nCreateUserStack = function (error) {\n  const stack = (error || new Error()).stack.split('\\n');\n  let toRemove = 1;\n\n  // Find how many frames need to be removed\n  // to make the user's code the first frame\n  for (; toRemove < stack.length; toRemove++) {\n    if (stack[toRemove].indexOf('montiapm:agent') === -1) {\n      break;\n    }\n  }\n\n  return stack.slice(toRemove).join('\\n');\n}\n\n// Optimized version of apply which tries to call as possible as it can\n// Then fall back to apply\n// This is because, v8 is very slow to invoke apply.\nOptimizedApply = function OptimizedApply(context, fn, args) {\n  var a = args;\n  switch(a.length) {\n    case 0:\n      return fn.call(context);\n    case 1:\n      return fn.call(context, a[0]);\n    case 2:\n      return fn.call(context, a[0], a[1]);\n    case 3:\n      return fn.call(context, a[0], a[1], a[2]);\n    case 4:\n      return fn.call(context, a[0], a[1], a[2], a[3]);\n    case 5:\n      return fn.call(context, a[0], a[1], a[2], a[3], a[4]);\n    default:\n      return fn.apply(context, a);\n  }\n}\n\ngetClientVersions = function () {\n  return {\n    'web.cordova': getClientArchVersion('web.cordova'),\n    'web.browser': getClientArchVersion('web.browser'),\n    'web.browser.legacy': getClientArchVersion('web.browser.legacy')\n  }\n}\n\n// Returns number of keys of an object, or size of a Map or Set\ncountKeys = function (obj) {\n  if (obj instanceof Map || obj instanceof Set) {\n    return obj.size;\n  }\n\n  return Object.keys(obj).length;\n}\n\n// Iterates objects and maps.\n// Callback is called with a value and key\niterate = function (obj, callback) {\n  if (obj instanceof Map) {\n    return obj.forEach(callback);\n  }\n\n  for (var key in obj) {\n    var value = obj[key];\n    callback(value, key);\n  }\n}\n\n// Returns a property from an object, or an entry from a map\ngetProperty = function (obj, key) {\n  if (obj instanceof Map) {\n    return obj.get(key);\n  }\n\n  return obj[key];\n}\n\nexport function createHistogram () {\n  return new DDSketch({\n    alpha: 0.02\n  });\n}\n","var logger = getLogger();\n\nNtp = function (endpoint) {\n  this.path = '/simplentp/sync';\n  this.setEndpoint(endpoint);\n  this.diff = 0;\n  this.synced = false;\n  this.reSyncCount = 0;\n  this.reSync = new Retry({\n    baseTimeout: 1000*60,\n    maxTimeout: 1000*60*10,\n    minCount: 0\n  });\n}\n\nNtp._now = function() {\n  var now = Date.now();\n  if(typeof now == 'number') {\n    return now;\n  } else if(now instanceof Date) {\n    // some extenal JS libraries override Date.now and returns a Date object\n    // which directly affect us. So we need to prepare for that\n    return now.getTime();\n  } else {\n    // trust me. I've seen now === undefined\n    return (new Date()).getTime();\n  }\n};\n\nNtp.prototype.setEndpoint = function(endpoint) {\n  this.endpoint = endpoint ? endpoint + this.path : null;\n};\n\nNtp.prototype.getTime = function() {\n  return Ntp._now() + Math.round(this.diff);\n};\n\nNtp.prototype.syncTime = function(localTime) {\n  return localTime + Math.ceil(this.diff);\n};\n\nNtp.prototype.sync = function() {\n  if (this.endpoint === null) {\n    return;\n  }\n\n  logger('init sync');\n  var self = this;\n  var retryCount = 0;\n  var retry = new Retry({\n    baseTimeout: 1000*20,\n    maxTimeout: 1000*60,\n    minCount: 1,\n    minTimeout: 0\n  });\n  syncTime();\n\n  function syncTime () {\n    if(retryCount<5) {\n      logger('attempt time sync with server', retryCount);\n      // if we send 0 to the retryLater, cacheDns will run immediately\n      retry.retryLater(retryCount++, cacheDns);\n    } else {\n      logger('maximum retries reached');\n      self.reSync.retryLater(self.reSyncCount++, function () {\n        var args = [].slice.call(arguments);\n        self.sync.apply(self, args);\n      });\n    }\n  }\n\n  // first attempt is to cache dns. So, calculation does not\n  // include DNS resolution time\n  function cacheDns () {\n    self.getServerTime(function(err) {\n      if(!err) {\n        calculateTimeDiff();\n      } else {\n        syncTime();\n      }\n    });\n  }\n\n  function calculateTimeDiff () {\n    var clientStartTime = (new Date()).getTime();\n    self.getServerTime(function(err, serverTime) {\n      if(!err && serverTime) {\n        // (Date.now() + clientStartTime)/2 : Midpoint between req and res\n        var networkTime = ((new Date()).getTime() - clientStartTime)/2\n        var serverStartTime = serverTime - networkTime;\n        self.diff = serverStartTime - clientStartTime;\n        self.synced = true;\n        // we need to send 1 into retryLater.\n        self.reSync.retryLater(self.reSyncCount++, function () {\n          var args = [].slice.call(arguments);\n          self.sync.apply(self, args);\n        });\n        logger('successfully updated diff value', self.diff);\n      } else {\n        syncTime();\n      }\n    });\n  }\n}\n\nNtp.prototype.getServerTime = function(callback) {\n  var self = this;\n\n  if (self.endpoint === null) {\n    throw new Error('getServerTime requires the endpoint to be set');\n  }\n\n  if(Meteor.isServer) {\n    Kadira.coreApi.get(self.path, { noRetries: true }).then(content => {\n      var serverTime = parseInt(content);\n      callback(null, serverTime);\n    })\n      .catch(err => {\n        callback(err);\n      });\n  } else {\n    httpRequest('GET', self.endpoint + `?noCache=${new Date().getTime()}-${Math.random()}`, function(err, res) {\n      if (err) {\n        callback(err);\n      } else {\n        var serverTime = parseInt(res.content);\n        callback(null, serverTime);\n      }\n    });\n  }\n};\n\nfunction getLogger() {\n  if(Meteor.isServer) {\n    return Npm.require('debug')(\"kadira:ntp\");\n  } else {\n    return function(message) {\n      try {\n        var canLogKadira = global.localStorage.getItem('LOG_KADIRA') !== null && typeof console !== 'undefined';\n      } catch (e) { } //older browsers can sometimes throw because of getItem\n      if (canLogKadira) {\n        if (message) {\n          message = \"kadira:ntp \" + message;\n          arguments[0] = message;\n        }\n        console.log.apply(console, arguments);\n      }\n    }\n  }\n}\n","var url = Npm.require('url');\nvar path = Npm.require('path');\nvar fs = Npm.require('fs');\nvar logger = Npm.require('debug')('kadira:apm:sourcemaps');\n\n// Meteor 1.7 and older used clientPaths\nvar clientPaths = __meteor_bootstrap__.configJson.clientPaths;\nvar clientArchs =  __meteor_bootstrap__.configJson.clientArchs;\nvar serverDir = __meteor_bootstrap__.serverDir;\nvar absClientPaths\n\nif (clientArchs) {\n  absClientPaths = clientArchs.reduce((result, arch) => {\n    result[arch] = path.resolve(path.dirname(serverDir), arch)\n\n    return result\n  }, {})\n} else {\n  absClientPaths = Object.keys(clientPaths).reduce((result, key) => {\n    result[key] = path.resolve(serverDir, path.dirname(clientPaths[key]));\n\n    return result;\n  }, {});\n}\n\nhandleApiResponse = function (body = {}) {\n  var unavailable = [];\n\n  if (typeof body === 'string') {\n    try {\n      body = JSON.parse(body);\n    } catch (e) {\n      logger('failed parsing body', e, body)\n      return;\n    }\n  }\n\n  var neededSourcemaps = body.neededSourcemaps || []\n  logger('body', neededSourcemaps)\n\n  var promises = neededSourcemaps.map((sourcemap) => {\n    if (!Kadira.options.uploadSourceMaps) {\n      return unavailable.push(sourcemap)\n    }\n\n    return getSourcemapPath(sourcemap.arch, sourcemap.file.path)\n      .then(function (sourceMapPath) {\n        if (sourceMapPath === null) {\n          unavailable.push(sourcemap)\n        } else {\n          sendSourcemap(sourcemap, sourceMapPath)\n        }\n      })\n  })\n\n  Promise.all(promises).then(function () {\n    if (unavailable.length > 0) {\n      logger('sending unavailable sourcemaps', unavailable)\n      Kadira.coreApi.sendData({\n        unavailableSourcemaps: unavailable\n      })\n      .then(function (body) {\n        handleApiResponse(body);\n      })\n      .catch(function (err) {\n        console.log('Monti APM: unable to send data', err);\n      });\n    }\n  })\n\n}\n\nfunction sendSourcemap(sourcemap, sourcemapPath) {\n  logger('Sending sourcemap', sourcemap, sourcemapPath)\n\n  var stream = fs.createReadStream(sourcemapPath);\n\n  stream.on('error', (err) => {\n    console.log('Monti APM: error while uploading sourcemap', err)\n  });\n\n  var arch = sourcemap.arch;\n  var archVersion = sourcemap.archVersion;\n  var file = encodeURIComponent(sourcemap.file.path);\n  \n  Kadira.coreApi.sendStream(`/sourcemap?arch=${arch}&archVersion=${archVersion}&file=${file}`, stream)\n    .catch(function (err) {\n      console.log('Monti APM: error uploading sourcemap', err);\n    });\n}\n\nfunction preparePath (urlPath) {\n  urlPath = path.posix.normalize(urlPath);\n\n  if (urlPath[0] === '/') {\n    urlPath = urlPath.slice(1);\n  }\n\n  return urlPath;\n}\n\nfunction checkForDynamicImport (arch, urlPath) {\n  const filePath = preparePath(urlPath);\n\n  return new Promise(function (resolve) {\n    const archPath = absClientPaths[arch]\n    const dynamicPath = path.join(archPath, 'dynamic', filePath) + '.map'\n\n    fs.stat(dynamicPath, function (err) {\n      resolve(err ? null : dynamicPath);\n    });\n  });\n}\n\nfunction getSourcemapPath(arch, urlPath) {\n  return new Promise((resolve, reject) => {\n    var clientProgram = WebApp.clientPrograms[arch];\n  \n    if (!clientProgram || !clientProgram.manifest) {\n      return resolve(null);\n    }\n\n    var fileInfo = clientProgram.manifest.find((file) => {\n      return file.url && file.url.startsWith(urlPath);\n    });\n\n    if (fileInfo && fileInfo.sourceMap) {\n      return resolve(path.join(\n        absClientPaths[arch],\n        fileInfo.sourceMap\n      ));\n    }\n\n    checkForDynamicImport(arch, urlPath).then(resolve).catch(reject)\n  });\n}\n","import { _ } from 'meteor/underscore';\n\nconst WAITON_MESSAGE_FIELDS = ['msg', 'id', 'method', 'name', 'waitTime'];\n\n// This is way how we can build waitTime and it's breakdown\nexport class WaitTimeBuilder {\n  constructor() {\n    this._waitListStore = {};\n    this._currentProcessingMessages = {};\n    this._messageCache = {};\n  }\n\n  register(session, msgId) {\n    const mainKey = this._getMessageKey(session.id, msgId);\n\n    let inQueue = session.inQueue || [];\n    if (typeof inQueue.toArray === 'function') {\n      // latest version of Meteor uses a double-ended-queue for the inQueue\n      // info: https://www.npmjs.com/package/double-ended-queue\n      inQueue = inQueue.toArray();\n    }\n\n    const waitList =\n      inQueue.map(msg => {\n        const key = this._getMessageKey(session.id, msg.id);\n\n        return this._getCacheMessage(key, msg);\n      }) || [];\n\n    // add currently processing ddp message if exists\n    const currentlyProcessingMessage =\n      this._currentProcessingMessages[session.id];\n    if (currentlyProcessingMessage) {\n      const key = this._getMessageKey(\n        session.id,\n        currentlyProcessingMessage.id\n      );\n      waitList.unshift(this._getCacheMessage(key, currentlyProcessingMessage));\n    }\n\n    this._waitListStore[mainKey] = waitList;\n  }\n\n  build(session, msgId) {\n    const mainKey = this._getMessageKey(session.id, msgId);\n    const waitList = this._waitListStore[mainKey] || [];\n    delete this._waitListStore[mainKey];\n\n    const filteredWaitList = waitList.map(this._cleanCacheMessage.bind(this));\n\n    return filteredWaitList;\n  }\n\n  _getMessageKey(sessionId, msgId) {\n    return `${sessionId}::${msgId}`;\n  }\n\n  _getCacheMessage(key, msg) {\n    let cachedMessage = this._messageCache[key];\n    if (!cachedMessage) {\n      this._messageCache[key] = cachedMessage = _.pick(\n        msg,\n        WAITON_MESSAGE_FIELDS\n      );\n      cachedMessage._key = key;\n      cachedMessage._registered = 1;\n    } else {\n      cachedMessage._registered++;\n    }\n\n    return cachedMessage;\n  }\n\n  _cleanCacheMessage(msg) {\n    msg._registered--;\n    if (msg._registered == 0) {\n      delete this._messageCache[msg._key];\n    }\n\n    // need to send a clean set of objects\n    // otherwise register can go with this\n    return _.pick(msg, WAITON_MESSAGE_FIELDS);\n  }\n\n  trackWaitTime(session, msg, unblock) {\n    const started = Date.now();\n    this._currentProcessingMessages[session.id] = msg;\n\n    let unblocked = false;\n    const self = this;\n\n    const wrappedUnblock = function() {\n      if (!unblocked) {\n        const waitTime = Date.now() - started;\n        const key = self._getMessageKey(session.id, msg.id);\n        const cachedMessage = self._messageCache[key];\n        if (cachedMessage) {\n          cachedMessage.waitTime = waitTime;\n        }\n        delete self._currentProcessingMessages[session.id];\n        unblocked = true;\n        unblock();\n      }\n    };\n\n    return wrappedUnblock;\n  }\n}\n","// expose for testing purpose\nOplogCheck = {};\n\nOplogCheck._070 = function(cursorDescription) {\n  var options = cursorDescription.options;\n  if (options.limit) {\n    return {\n      code: \"070_LIMIT_NOT_SUPPORTED\",\n      reason: \"Meteor 0.7.0 does not support limit with oplog.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  };\n\n  var exists$ = _.any(cursorDescription.selector, function (value, field) {\n    if (field.substr(0, 1) === '$')\n      return true;\n  });\n\n  if(exists$) {\n    return {\n      code: \"070_$_NOT_SUPPORTED\",\n      reason: \"Meteor 0.7.0 supports only equal checks with oplog.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  };\n\n  var onlyScalers = _.all(cursorDescription.selector, function (value, field) {\n    return typeof value === \"string\" ||\n      typeof value === \"number\" ||\n      typeof value === \"boolean\" ||\n      value === null ||\n      value instanceof Meteor.Collection.ObjectID;\n  });\n\n  if(!onlyScalers) {\n    return {\n      code: \"070_ONLY_SCALERS\",\n      reason: \"Meteor 0.7.0 only supports scalers as comparators.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  }\n\n  return true;\n};\n\nOplogCheck._071 = function(cursorDescription) {\n  var options = cursorDescription.options;\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n  if (options.limit) {\n    return {\n      code: \"071_LIMIT_NOT_SUPPORTED\",\n      reason: \"Meteor 0.7.1 does not support limit with oplog.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    }\n  };\n\n  return true;\n};\n\n\nOplogCheck.env = function() {\n  if(!process.env.MONGO_OPLOG_URL) {\n    return {\n      code: \"NO_ENV\",\n      reason: \"You haven't added oplog support for your the Meteor app.\",\n      solution: \"Add oplog support for your Meteor app. see: http://goo.gl/Co1jJc\"\n    }\n  } else {\n    return true;\n  }\n};\n\nOplogCheck.disableOplog = function(cursorDescription) {\n  if(cursorDescription.options._disableOplog) {\n    return {\n      code: \"DISABLE_OPLOG\",\n      reason: \"You've disable oplog for this cursor explicitly with _disableOplog option.\"\n    };\n  } else {\n    return true;\n  }\n};\n\n// when creating Minimongo.Matcher object, if that's throws an exception\n// meteor won't do the oplog support\nOplogCheck.miniMongoMatcher = function(cursorDescription) {\n  if(Minimongo.Matcher) {\n    try {\n      var matcher = new Minimongo.Matcher(cursorDescription.selector);\n      return true;\n    } catch(ex) {\n      return {\n        code: \"MINIMONGO_MATCHER_ERROR\",\n        reason: \"There's something wrong in your mongo query: \" +  ex.message,\n        solution: \"Check your selector and change it accordingly.\"\n      };\n    }\n  } else {\n    // If there is no Minimongo.Matcher, we don't need to check this\n    return true;\n  }\n};\n\nOplogCheck.miniMongoSorter = function(cursorDescription) {\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n  if(Minimongo.Sorter && cursorDescription.options.sort) {\n    try {\n      var sorter = new Minimongo.Sorter(\n        cursorDescription.options.sort,\n        { matcher: matcher }\n      );\n      return true;\n    } catch(ex) {\n      return {\n        code: \"MINIMONGO_SORTER_ERROR\",\n        reason: \"Some of your sort specifiers are not supported: \" + ex.message,\n        solution: \"Check your sort specifiers and chage them accordingly.\"\n      }\n    }\n  } else {\n    return true;\n  }\n};\n\nOplogCheck.fields = function(cursorDescription) {\n  var options = cursorDescription.options;\n  if(options.fields) {\n    try {\n      LocalCollection._checkSupportedProjection(options.fields);\n      return true;\n    } catch (e) {\n      if (e.name === \"MinimongoError\") {\n        return {\n          code: \"NOT_SUPPORTED_FIELDS\",\n          reason: \"Some of the field filters are not supported: \" + e.message,\n          solution: \"Try removing those field filters.\"\n        };\n      } else {\n        throw e;\n      }\n    }\n  }\n  return true;\n};\n\nOplogCheck.skip = function(cursorDescription) {\n  if(cursorDescription.options.skip) {\n    return {\n      code: \"SKIP_NOT_SUPPORTED\",\n      reason: \"Skip does not support with oplog.\",\n      solution: \"Try to avoid using skip. Use range queries instead: http://goo.gl/b522Av\"\n    };\n  }\n\n  return true;\n};\n\nOplogCheck.where = function(cursorDescription) {\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n  if(matcher.hasWhere()) {\n    return {\n      code: \"WHERE_NOT_SUPPORTED\",\n      reason: \"Meteor does not support queries with $where.\",\n      solution: \"Try to remove $where from your query. Use some alternative.\"\n    }\n  };\n\n  return true;\n};\n\nOplogCheck.geo = function(cursorDescription) {\n  var matcher = new Minimongo.Matcher(cursorDescription.selector);\n\n  if(matcher.hasGeoQuery()) {\n    return {\n      code: \"GEO_NOT_SUPPORTED\",\n      reason: \"Meteor does not support queries with geo partial operators.\",\n      solution: \"Try to remove geo partial operators from your query if possible.\"\n    }\n  };\n\n  return true;\n};\n\nOplogCheck.limitButNoSort = function(cursorDescription) {\n  var options = cursorDescription.options;\n\n  if((options.limit && !options.sort)) {\n    return {\n      code: \"LIMIT_NO_SORT\",\n      reason: \"Meteor oplog implementation does not support limit without a sort specifier.\",\n      solution: \"Try adding a sort specifier.\"\n    }\n  };\n\n  return true;\n};\n\nOplogCheck.olderVersion = function(cursorDescription, driver) {\n  if(driver && !driver.constructor.cursorSupported) {\n    return {\n      code: \"OLDER_VERSION\",\n      reason: \"Your Meteor version does not have oplog support.\",\n      solution: \"Upgrade your app to Meteor version 0.7.2 or later.\"\n    };\n  }\n  return true;\n};\n\nOplogCheck.gitCheckout = function(cursorDescription, driver) {\n  if(!Meteor.release) {\n    return {\n      code: \"GIT_CHECKOUT\",\n      reason: \"Seems like your Meteor version is based on a Git checkout and it doesn't have the oplog support.\",\n      solution: \"Try to upgrade your Meteor version.\"\n    };\n  }\n  return true;\n};\n\nvar preRunningMatchers = [\n  OplogCheck.env,\n  OplogCheck.disableOplog,\n  OplogCheck.miniMongoMatcher\n];\n\nvar globalMatchers = [\n  OplogCheck.fields,\n  OplogCheck.skip,\n  OplogCheck.where,\n  OplogCheck.geo,\n  OplogCheck.limitButNoSort,\n  OplogCheck.miniMongoSorter,\n  OplogCheck.olderVersion,\n  OplogCheck.gitCheckout\n];\n\nvar versionMatchers = [\n  [/^0\\.7\\.1/, OplogCheck._071],\n  [/^0\\.7\\.0/, OplogCheck._070],\n];\n\nKadira.checkWhyNoOplog = function(cursorDescription, observerDriver) {\n  if(typeof Minimongo == 'undefined') {\n    return {\n      code: \"CANNOT_DETECT\",\n      reason: \"You are running an older Meteor version and Kadira can't check oplog state.\",\n      solution: \"Try updating your Meteor app\"\n    }\n  }\n\n  var result = runMatchers(preRunningMatchers, cursorDescription, observerDriver);\n  if(result !== true) {\n    return result;\n  }\n\n  var meteorVersion = Meteor.release;\n  for(var lc=0; lc<versionMatchers.length; lc++) {\n    var matcherInfo = versionMatchers[lc];\n    if(matcherInfo[0].test(meteorVersion)) {\n      var matched = matcherInfo[1](cursorDescription, observerDriver);\n      if(matched !== true) {\n        return matched;\n      }\n    }\n  }\n\n  result = runMatchers(globalMatchers, cursorDescription, observerDriver);\n  if(result !== true) {\n    return result;\n  }\n\n  return {\n    code: \"OPLOG_SUPPORTED\",\n    reason: \"This query should support oplog. It's weird if it's not.\",\n    solution: \"Please contact Kadira support and let's discuss.\"\n  };\n};\n\nfunction runMatchers(matcherList, cursorDescription, observerDriver) {\n  for(var lc=0; lc<matcherList.length; lc++) {\n    var matcher = matcherList[lc];\n    var matched = matcher(cursorDescription, observerDriver);\n    if(matched !== true) {\n      return matched;\n    }\n  }\n  return true;\n}\n","var eventLogger = Npm.require('debug')('kadira:tracer');\nvar REPETITIVE_EVENTS = {'db': true, 'http': true, 'email': true, 'wait': true, 'async': true, 'custom': true, 'fs': true};\nvar TRACE_TYPES = ['sub', 'method', 'http'];\nvar MAX_TRACE_EVENTS = 1500;\n\nTracer = function Tracer() {\n  this._filters = [];\n  this._filterFields = ['password'];\n  this.maxArrayItemsToFilter = 20;\n};\n\n//In the future, we might wan't to track inner fiber events too.\n//Then we can't serialize the object with methods\n//That's why we use this method of returning the data\nTracer.prototype.start = function (name, type, {\n  sessionId,\n  msgId,\n  userId\n} = {}) {\n\n  // for backward compatibility\n  if (typeof name === 'object' && typeof type === 'object') {\n    let session = name;\n    let msg = type;\n    sessionId = session.id;\n    msgId = msg.id;\n    userId = session.userId;\n\n    if(msg.msg == 'method') {\n      type = 'method';\n      name = msg.method;\n    } else if(msg.msg == 'sub') {\n      type = 'sub';\n      name = msg.name;\n    } else {\n      return null;\n    }\n  }\n\n  if (TRACE_TYPES.indexOf(type) === -1) {\n    console.warn(`Monti APM: unknown trace type \"${type}\"`);\n    return null;\n  }\n\n\n  var traceInfo = {\n    _id: `${sessionId}::${msgId || DefaultUniqueId.get()}`,\n    type,\n    name,\n    session: sessionId,\n    id: msgId,\n    events: [],\n    userId,\n  };\n\n  return traceInfo;\n};\n\nTracer.prototype.event = function (traceInfo, type, data, metaData) {\n  // do not allow to proceed, if already completed or errored\n  var lastEvent = this.getLastEvent(traceInfo);\n\n  if(\n    // trace completed but has not been processed\n    lastEvent &&\n    ['complete', 'error'].indexOf(lastEvent.type) >= 0 ||\n    // trace completed and processed.\n    traceInfo.isEventsProcessed\n    ) {\n    return false;\n  }\n\n  var event = {\n    type,\n    at: Ntp._now(),\n    endAt: null,\n    nested: [],\n  };\n\n  // special handling for events that are not repetitive\n  if (!REPETITIVE_EVENTS[type]) {\n    event.endAt = event.at;\n  }\n\n  if(data) {\n    var info = _.pick(traceInfo, 'type', 'name')\n    event.data = this._applyFilters(type, data, info, \"start\");\n  }\n\n  if (metaData && metaData.name) {\n    event.name = metaData.name\n  }\n\n  if (Kadira.options.eventStackTrace) {\n    event.stack = CreateUserStack()\n  }\n  \n  eventLogger(\"%s %s\", type, traceInfo._id);\n\n  if (lastEvent && !lastEvent.endAt) {\n    if (!lastEvent.nested) {\n      console.error('Monti: invalid trace. Please share the trace below at');\n      console.error('Monti: https://github.com/monti-apm/monti-apm-agent/issues/14');\n      console.dir(traceInfo, { depth: 10 });\n    }\n    var lastNested = lastEvent.nested[lastEvent.nested.length - 1];\n\n    // Only nest one level\n    if (!lastNested || lastNested.endAt) {\n      lastEvent.nested.push(event);\n      return event;\n    }\n\n    return false;\n  }\n  \n  traceInfo.events.push(event);\n\n  return event;\n};\n\nTracer.prototype.eventEnd = function(traceInfo, event, data) {\n  if (event.endAt) {\n    // Event already ended or is not a repititive event\n    return false;\n  }\n\n  event.endAt = Ntp._now();\n\n  if(data) {\n    var info = _.pick(traceInfo, 'type', 'name')\n    event.data = Object.assign(\n      event.data || {},\n      this._applyFilters(`${event.type}end`, data, info, 'end')\n    );\n  }\n  eventLogger(\"%s %s\", event.type + 'end', traceInfo._id);\n\n  return true;\n};\n\nTracer.prototype.getLastEvent = function(traceInfo) {\n  return traceInfo.events[traceInfo.events.length -1]\n};\n\nTracer.prototype.endLastEvent = function(traceInfo) {\n  var lastEvent = this.getLastEvent(traceInfo);\n\n  if (!lastEvent.endAt) {\n    this.eventEnd(traceInfo, lastEvent);\n    lastEvent.forcedEnd = true;\n    return true;\n  }\n  return false;\n};\n\n// Most of the time, all of the nested events are async\n// which is not helpful. This returns true if\n// there are nested events other than async.\nTracer.prototype._hasUsefulNested = function (event) {\n  return !event.nested.every(event => {\n    return event.type === 'async';\n  });\n}\n\nTracer.prototype.buildEvent = function(event, depth = 0, trace) {\n  var elapsedTimeForEvent = event.endAt - event.at;\n  var builtEvent = [event.type];\n  var nested = [];\n\n  builtEvent.push(elapsedTimeForEvent);\n  builtEvent.push(event.data || {});\n  \n  if (event.nested.length && this._hasUsefulNested(event)) {\n    let prevEnd = event.at;\n    for(let i = 0; i < event.nested.length; i++) {\n      var nestedEvent = event.nested[i];\n      if (!nestedEvent.endAt) {\n        this.eventEnd(trace, nestedEvent);\n        nestedEvent.forcedEnd = true;\n      }\n\n      var computeTime = nestedEvent.at - prevEnd;\n      if (computeTime > 0) {\n        nested.push(['compute', computeTime]);\n      }\n\n      nested.push(this.buildEvent(nestedEvent, depth + 1, trace));\n      prevEnd = nestedEvent.endAt;\n    }\n  }\n\n\n  if (\n    nested.length ||\n    event.stack ||\n    event.forcedEnd ||\n    event.name\n  ) {\n    builtEvent.push({\n      stack: event.stack,\n      nested: nested.length ? nested : undefined,\n      forcedEnd: event.forcedEnd,\n      name: event.name\n    });\n  }\n\n  return builtEvent;\n}\n\nTracer.prototype.buildTrace = function (traceInfo) {\n  var firstEvent = traceInfo.events[0];\n  var lastEvent = traceInfo.events[traceInfo.events.length - 1];\n  var processedEvents = [];\n\n  if (firstEvent.type !== 'start') {\n    console.warn('Monti APM: trace has not started yet');\n    return null;\n  } else if (lastEvent.type !== 'complete' && lastEvent.type !== 'error') {\n    //trace is not completed or errored yet\n    console.warn('Monti APM: trace has not completed or errored yet');\n    return null;\n  } else {\n    //build the metrics\n    traceInfo.errored = lastEvent.type === 'error';\n    traceInfo.at = firstEvent.at;\n\n    var metrics = {\n      total: lastEvent.at - firstEvent.at,\n    };\n\n    var totalNonCompute = 0;\n\n    firstEvent = ['start', 0];\n    if (traceInfo.events[0].data) {\n      firstEvent.push(traceInfo.events[0].data);\n    }\n    processedEvents.push(firstEvent);\n\n    for (var lc = 1; lc < traceInfo.events.length - 1; lc += 1) {\n      var prevEvent = traceInfo.events[lc - 1];\n      var event = traceInfo.events[lc];\n\n      if (!event.endAt) {\n        console.error('Monti APM: no end event for type: ', event.type);\n        return null;\n      }\n\n      var computeTime = event.at - prevEvent.endAt;\n      if (computeTime > 0) {\n        processedEvents.push(['compute', computeTime]);\n      }\n      var builtEvent = this.buildEvent(event, 0, traceInfo);\n      processedEvents.push(builtEvent);\n\n      metrics[event.type] = metrics[event.type] || 0;\n      metrics[event.type] += builtEvent[1];\n      totalNonCompute += builtEvent[1];\n    }\n  }\n\n  computeTime = lastEvent.at - traceInfo.events[traceInfo.events.length - 2].endAt;\n  if(computeTime > 0) processedEvents.push(['compute', computeTime]);\n\n  var lastEventData = [lastEvent.type, 0];\n  if(lastEvent.data) lastEventData.push(lastEvent.data);\n  processedEvents.push(lastEventData);\n\n  if (processedEvents.length > MAX_TRACE_EVENTS) {\n    const removeCount = processedEvents.length - MAX_TRACE_EVENTS\n    processedEvents.splice(MAX_TRACE_EVENTS, removeCount);\n  }\n\n  metrics.compute = metrics.total - totalNonCompute;\n  traceInfo.metrics = metrics;\n  traceInfo.events = processedEvents;\n  traceInfo.isEventsProcessed = true;\n  return traceInfo;\n};\n\nTracer.prototype.addFilter = function(filterFn) {\n  this._filters.push(filterFn);\n};\n\nTracer.prototype.redactField = function (field) {\n  this._filterFields.push(field);\n};\n\nTracer.prototype._applyFilters = function(eventType, data, info) {\n  this._filters.forEach(function(filterFn) {\n    data = filterFn(eventType, _.clone(data), info);\n  });\n\n  return data;\n};\n\nTracer.prototype._applyObjectFilters = function (toFilter) {\n  const filterObject = (obj) => {\n    let cloned;\n    this._filterFields.forEach(function (field) {\n      if (field in obj) {\n        cloned = cloned || Object.assign({}, obj);\n        cloned[field] = 'Monti: redacted';\n      }\n    });\n\n    return cloned;\n  }\n\n  if (Array.isArray(toFilter)) {\n    let cloned;\n    // There could be thousands or more items in the array, and this usually runs\n    // before the data is validated. For performance reasons we limit how\n    // many to check\n    let length = Math.min(toFilter.length, this.maxArrayItemsToFilter);\n    for (let i = 0; i < length; i++) {\n      if (typeof toFilter[i] === 'object' && toFilter[i] !== null) {\n        let result = filterObject(toFilter[i]);\n        if (result) {\n          cloned = cloned || [...toFilter];\n          cloned[i] = result;\n        }\n      }\n    }\n\n    return cloned || toFilter;\n  }\n\n  return filterObject(toFilter) || toFilter;\n}\n\nKadira.tracer = new Tracer();\n// need to expose Tracer to provide default set of filters\nKadira.Tracer = Tracer;\n","// strip sensitive data sent to Monti APM engine.\n// possible to limit types by providing an array of types to strip\n// possible types are: \"start\", \"db\", \"http\", \"email\"\nTracer.stripSensitive = function stripSensitive(typesToStrip, receiverType, name) {\n  typesToStrip =  typesToStrip || [];\n\n  var strippedTypes = {};\n  typesToStrip.forEach(function(type) {\n    strippedTypes[type] = true;\n  });\n\n  return function (type, data, info) {\n    if(typesToStrip.length > 0 && !strippedTypes[type])\n      return data;\n\n    if(receiverType && receiverType != info.type)\n      return data;\n\n    if(name && name != info.name)\n      return data;\n\n    if(type == \"start\") {\n      if (data.params) {\n        data.params = \"[stripped]\";\n      }\n      if (data.headers) {\n        data.headers = \"[stripped]\";\n      }\n      if (data.body) {\n        data.body = \"[stripped]\";\n      }\n    } else if(type == \"db\") {\n      data.selector = \"[stripped]\";\n    } else if(type == \"http\") {\n      data.url = \"[stripped]\";\n    } else if(type == \"email\") {\n      [\"from\", \"to\", \"cc\", \"bcc\", \"replyTo\"].forEach(function(item) {\n        if(data[item]) {\n          data[item] = \"[stripped]\";\n        }\n      });\n    }\n\n    return data;\n  };\n};\n\n// Strip sensitive data sent to Monti APM engine.\n// In contrast to stripSensitive, this one has an allow list of what to keep\n// to guard against forgetting to strip new fields\n// In the future this one might replace Tracer.stripSensitive\n// options\nTracer.stripSensitiveThorough = function stripSensitive() {\n  return function (type, data) {\n    let fieldsToKeep = [];\n\n    if (type == \"start\") {\n      fieldsToKeep = ['userId'];\n    } else if (type === 'waitend') {\n      fieldsToKeep = [ 'waitOn' ];\n    } else if (type == \"db\") {\n      fieldsToKeep = [\n        'coll', 'func', 'cursor', 'limit', 'docsFetched', 'docSize', 'oplog',\n        'fields', 'projection', 'wasMultiplexerReady', 'queueLength', 'elapsedPollingTime',\n        'noOfCachedDocs'\n      ];\n    } else if (type == \"http\") {\n      fieldsToKeep = ['method', 'statusCode'];\n    } else if (type == \"email\") {\n      fieldsToKeep = [];\n    } else if (type === 'custom') {\n      // This is supplied by the user so we assume they are only giving data that can be sent\n      fieldsToKeep = Object.keys(data);\n    } else if (type === 'error') {\n      fieldsToKeep = ['error'];\n    }\n\n    Object.keys(data).forEach(key => {\n      if (fieldsToKeep.indexOf(key) === -1) {\n        data[key] = '[stripped]';\n      }\n    });\n\n    return data;\n  };\n};\n\n// strip selectors only from the given list of collection names\nTracer.stripSelectors = function stripSelectors(collectionList, receiverType, name) {\n  collectionList = collectionList || [];\n\n  var collMap = {};\n  collectionList.forEach(function(collName) {\n    collMap[collName] = true;\n  });\n\n  return function(type, data, info) {\n    if(type != \"db\" || (data && !collMap[data.coll])) {\n      return data\n    }\n\n    if(receiverType && receiverType != info.type)\n      return data;\n\n    if(name && name != info.name)\n      return data;\n\n    data.selector = \"[stripped]\";\n    return data;\n  };\n}\n","var logger = Npm.require('debug')('kadira:ts');\n\nTracerStore = function TracerStore(options) {\n  options = options || {};\n\n  this.maxTotalPoints = options.maxTotalPoints || 30;\n  this.interval = options.interval || 1000 * 60;\n  this.archiveEvery = options.archiveEvery || this.maxTotalPoints / 6;\n\n  //store max total on the past 30 minutes (or past 30 items)\n  this.maxTotals = Object.create(null);\n  //store the max trace of the current interval\n  this.currentMaxTrace = Object.create(null);\n  //archive for the traces\n  this.traceArchive = [];\n\n  this.processedCnt = Object.create(null);\n\n  //group errors by messages between an interval\n  this.errorMap = Object.create(null);\n};\n\nTracerStore.prototype.addTrace = function(trace) {\n  var kind = [trace.type, trace.name].join('::');\n  if(!this.currentMaxTrace[kind]) {\n    this.currentMaxTrace[kind] = EJSON.clone(trace);\n  } else if(this.currentMaxTrace[kind].metrics.total < trace.metrics.total) {\n    this.currentMaxTrace[kind] = EJSON.clone(trace);\n  } else if(trace.errored) {\n    this._handleErrors(trace);\n  }\n};\n\nTracerStore.prototype.collectTraces = function() {\n  var traces = this.traceArchive;\n  this.traceArchive = [];\n\n  // convert at(timestamp) into the actual serverTime\n  traces.forEach(function(trace) {\n    trace.at = Kadira.syncedDate.syncTime(trace.at);\n  });\n  return traces;\n};\n\nTracerStore.prototype.start = function() {\n  this._timeoutHandler = setInterval(this.processTraces.bind(this), this.interval);\n};\n\nTracerStore.prototype.stop = function() {\n  if(this._timeoutHandler) {\n    clearInterval(this._timeoutHandler);\n  }\n};\n\nTracerStore.prototype._handleErrors = function(trace) {\n  // sending error requests as it is\n  var lastEvent = trace.events[trace.events.length -1];\n  if(lastEvent && lastEvent[2]) {\n    var error = lastEvent[2].error;\n\n    // grouping errors occured (reset after processTraces)\n    var errorKey = [trace.type, trace.name, error.message].join(\"::\");\n    if(!this.errorMap[errorKey]) {\n      var erroredTrace = EJSON.clone(trace);\n      this.errorMap[errorKey] = erroredTrace;\n\n      this.traceArchive.push(erroredTrace);\n    }\n  } else {\n    logger('last events is not an error: ', JSON.stringify(trace.events));\n  }\n};\n\nTracerStore.prototype.processTraces = function() {\n  var self = this;\n  \n  let kinds = new Set();\n  Object.keys(this.maxTotals).forEach(key => {\n    kinds.add(key);\n  });\n  Object.keys(this.currentMaxTrace).forEach(key => {\n    kinds.add(key);\n  });\n\n  for (kind of kinds) {\n    self.processedCnt[kind] = self.processedCnt[kind] || 0;\n    var currentMaxTrace = self.currentMaxTrace[kind];\n    var currentMaxTotal = currentMaxTrace? currentMaxTrace.metrics.total : 0;\n\n    self.maxTotals[kind] = self.maxTotals[kind] || [];\n    //add the current maxPoint\n    self.maxTotals[kind].push(currentMaxTotal);\n    var exceedingPoints = self.maxTotals[kind].length - self.maxTotalPoints;\n    if(exceedingPoints > 0) {\n      self.maxTotals[kind].splice(0, exceedingPoints);\n    }\n\n    var archiveDefault = (self.processedCnt[kind] % self.archiveEvery) == 0;\n    self.processedCnt[kind]++;\n\n    var canArchive = archiveDefault\n      || self._isTraceOutlier(kind, currentMaxTrace);\n\n    if(canArchive && currentMaxTrace) {\n      self.traceArchive.push(currentMaxTrace);\n    }\n\n    //reset currentMaxTrace\n    self.currentMaxTrace[kind] = null;\n  };\n\n  //reset the errorMap\n  self.errorMap = Object.create(null);\n};\n\nTracerStore.prototype._isTraceOutlier = function(kind, trace) {\n  if(trace) {\n    var dataSet = this.maxTotals[kind];\n    return this._isOutlier(dataSet, trace.metrics.total, 3);\n  } else {\n    return false;\n  }\n};\n\n/*\n  Data point must exists in the dataSet\n*/\nTracerStore.prototype._isOutlier = function(dataSet, dataPoint, maxMadZ) {\n  var median = this._getMedian(dataSet);\n  var mad = this._calculateMad(dataSet, median);\n  var madZ = this._funcMedianDeviation(median)(dataPoint) / mad;\n\n  return madZ > maxMadZ;\n};\n\nTracerStore.prototype._getMedian = function(dataSet) {\n  var sortedDataSet = _.clone(dataSet).sort(function(a, b) {\n    return a-b;\n  });\n  return this._pickQuartile(sortedDataSet, 2);\n};\n\nTracerStore.prototype._pickQuartile = function(dataSet, num) {\n  var pos = ((dataSet.length + 1) * num) / 4;\n  if(pos % 1 == 0) {\n    return dataSet[pos -1];\n  } else {\n    pos = pos - (pos % 1);\n    return (dataSet[pos -1] + dataSet[pos])/2\n  }\n};\n\nTracerStore.prototype._calculateMad = function(dataSet, median) {\n  var medianDeviations = _.map(dataSet, this._funcMedianDeviation(median));\n  var mad = this._getMedian(medianDeviations);\n\n  return mad;\n};\n\nTracerStore.prototype._funcMedianDeviation = function(median) {\n  return function(x) {\n    return Math.abs(median - x);\n  };\n};\n\nTracerStore.prototype._getMean = function(dataPoints) {\n  if(dataPoints.length > 0) {\n    var total = 0;\n    dataPoints.forEach(function(point) {\n      total += point;\n    });\n    return total/dataPoints.length;\n  } else {\n    return 0;\n  }\n};\n","var LRU = Npm.require('lru-cache');\nvar crypto = Npm.require('crypto');\nvar jsonStringify = Npm.require('json-stringify-safe');\n\nDocSzCache = function (maxItems, maxValues) {\n  this.items = new LRU({max: maxItems});\n  this.maxValues = maxValues;\n  this.cpuUsage = 0;\n}\n\n// This is called from SystemModel.prototype.cpuUsage and saves cpu usage.\nDocSzCache.prototype.setPcpu = function (pcpu) {\n  this.cpuUsage = pcpu;\n};\n\nDocSzCache.prototype.getSize = function (coll, query, opts, data) {\n  // If the dataset is null or empty we can't calculate the size\n  // Do not process this data and return 0 as the document size.\n  if (!(data && (data.length || (typeof data.size === 'function' && data.size())))) {\n    return 0;\n  }\n\n  var key = this.getKey(coll, query, opts);\n  var item = this.items.get(key);\n\n  if (!item) {\n    item = new DocSzCacheItem(this.maxValues);\n    this.items.set(key, item);\n  }\n\n  if (this.needsUpdate(item)) {\n    var doc = {};\n    if(typeof data.get === 'function'){\n      // This is an IdMap\n      data.forEach(function(element){\n        doc = element;\n        return false; // return false to stop loop. We only need one doc.\n      })\n    } else {\n      doc = data[0];\n    }\n    var size = Buffer.byteLength(jsonStringify(doc), 'utf8');\n    item.addData(size);\n  }\n\n  return item.getValue();\n};\n\nDocSzCache.prototype.getKey = function (coll, query, opts) {\n  return jsonStringify([coll, query, opts]);\n};\n\n// returns a score between 0 and 1 for a cache item\n// this score is determined by:\n//  * available cache item slots\n//  * time since last updated\n//  * cpu usage of the application\nDocSzCache.prototype.getItemScore = function (item) {\n  return [\n    (item.maxValues - item.values.length)/item.maxValues,\n    (Date.now() - item.updated) / 60000,\n    (100 - this.cpuUsage) / 100,\n  ].map(function (score) {\n    return score > 1 ? 1 : score;\n  }).reduce(function (total, score) {\n    return (total || 0) + score;\n  }) / 3;\n};\n\nDocSzCache.prototype.needsUpdate = function (item) {\n  // handle newly made items\n  if (!item.values.length) {\n    return true;\n  }\n\n  var currentTime = Date.now();\n  var timeSinceUpdate = currentTime - item.updated;\n  if (timeSinceUpdate > 1000*60) {\n    return true;\n  }\n\n  return this.getItemScore(item) > 0.5;\n};\n\n\nDocSzCacheItem = function (maxValues) {\n  this.maxValues = maxValues;\n  this.updated = 0;\n  this.values = [];\n}\n\nDocSzCacheItem.prototype.addData = function (value) {\n  this.values.push(value);\n  this.updated = Date.now();\n\n  if (this.values.length > this.maxValues) {\n    this.values.shift();\n  }\n};\n\nDocSzCacheItem.prototype.getValue = function () {\n  function sortNumber(a, b) {\n    return a - b;\n  }\n  var sorted = this.values.sort(sortNumber);\n  var median = 0;\n\n  if (sorted.length % 2 === 0) {\n    var idx = sorted.length / 2;\n    median = (sorted[idx] + sorted[idx-1]) / 2;\n  } else {\n    var idx = Math.floor(sorted.length / 2);\n    median = sorted[idx];\n  }\n\n  return median;\n};\n","import HttpModel from \"./models/http\";\nimport packageMap from './.meteor-package-versions';\nimport { getErrorParameters  } from \"./common/utils\";\nimport { WaitTimeBuilder } from \"./wait_time_builder\";\n\nvar hostname = Npm.require('os').hostname();\nvar logger = Npm.require('debug')('kadira:apm');\nvar Fibers = Npm.require('fibers');\n\nvar KadiraCore = Npm.require('monti-apm-core').Kadira;\n\nKadira.models = {};\nKadira.options = {};\nKadira.env = {\n  currentSub: null, // keep current subscription inside ddp\n  kadiraInfo: new Meteor.EnvironmentVariable(),\n};\nKadira.waitTimeBuilder = new WaitTimeBuilder();\nKadira.errors = [];\nKadira.errors.addFilter = Kadira.errors.push.bind(Kadira.errors);\n\nKadira.models.methods = new MethodsModel();\nKadira.models.pubsub = new PubsubModel();\nKadira.models.system = new SystemModel();\nKadira.models.http = new HttpModel();\nKadira.docSzCache = new DocSzCache(100000, 10);\nKadira.syncedDate = new Ntp();\n\n// If the agent is not connected, we still want to build the payload occasionally\n// since building the payload does some cleanup to prevent memory leaks\n// Once connected, this interval is cleared\nlet buildInterval = Meteor.setInterval(() => {\n  Kadira._buildPayload();\n}, 1000 * 60);\n\n\nKadira.connect = function(appId, appSecret, options) {\n  options = options || {};\n  options.appId = appId;\n  options.appSecret = appSecret;\n  options.payloadTimeout = options.payloadTimeout || 1000 * 20;\n  options.endpoint = options.endpoint || \"https://engine.montiapm.com\";\n  options.clientEngineSyncDelay = options.clientEngineSyncDelay || 10000;\n  options.thresholds = options.thresholds || {};\n  options.isHostNameSet = !!options.hostname;\n  options.hostname = options.hostname || hostname;\n  options.proxy = options.proxy || null;\n  options.recordIPAddress = options.recordIPAddress || 'full';\n  options.eventStackTrace = options.eventStackTrace || false;\n\n  if(options.documentSizeCacheSize) {\n    Kadira.docSzCache = new DocSzCache(options.documentSizeCacheSize, 10);\n  }\n\n  // remove trailing slash from endpoint url (if any)\n  if(_.last(options.endpoint) === '/') {\n    options.endpoint = options.endpoint.substr(0, options.endpoint.length - 1);\n  }\n\n  // error tracking is enabled by default\n  if(options.enableErrorTracking === undefined) {\n    options.enableErrorTracking = true;\n  }\n\n  // uploading sourcemaps is enabled by default in production\n  if (options.uploadSourceMaps === undefined && Meteor.isProduction) {\n    options.uploadSourceMaps = true;\n  }\n\n  Kadira.options = options;\n  Kadira.options.authHeaders = {\n    'KADIRA-APP-ID': Kadira.options.appId,\n    'KADIRA-APP-SECRET': Kadira.options.appSecret\n  };\n\n  if (appId && appSecret) {\n    options.appId = options.appId.trim();\n    options.appSecret = options.appSecret.trim();\n\n    Kadira.coreApi = new KadiraCore({\n      appId: options.appId,\n      appSecret: options.appSecret,\n      endpoint: options.endpoint,\n      hostname: options.hostname,\n      agentVersion: packageMap['montiapm:agent'] || '<unknown>'\n    });\n\n    Kadira.coreApi._checkAuth()\n      .then(function () {\n        logger('connected to app: ', appId);\n        console.log('Monti APM: Successfully connected');\n        Kadira._sendAppStats();\n        Kadira._schedulePayloadSend();\n      })\n      .catch(function (err) {\n        if (err.message === \"Unauthorized\") {\n          console.log('Monti APM: authentication failed - check your appId & appSecret')\n        } else {\n          console.log('Monti APM: unable to connect. ' + err.message);\n        }\n      });\n  } else {\n    throw new Error('Monti APM: required appId and appSecret');\n  }\n\n  Kadira.syncedDate = new Ntp(options.endpoint);\n  Kadira.syncedDate.sync();\n  Kadira.models.error = new ErrorModel(appId);\n\n  // handle pre-added filters\n  var addFilterFn = Kadira.models.error.addFilter.bind(Kadira.models.error);\n  Kadira.errors.forEach(addFilterFn);\n  Kadira.errors = Kadira.models.error;\n\n  // setting runtime info, which will be sent to kadira\n  __meteor_runtime_config__.kadira = {\n    appId: appId,\n    endpoint: options.endpoint,\n    clientEngineSyncDelay: options.clientEngineSyncDelay,\n    recordIPAddress: options.recordIPAddress,\n  };\n\n  if(options.enableErrorTracking) {\n    Kadira.enableErrorTracking();\n  } else {\n    Kadira.disableErrorTracking();\n  }\n\n  // start tracking errors\n  Meteor.startup(function () {\n    TrackUncaughtExceptions();\n    TrackUnhandledRejections();\n    TrackMeteorDebug();\n  })\n\n  Meteor.publish(null, function () {\n    var options = __meteor_runtime_config__.kadira;\n    this.added('kadira_settings', Random.id(), options);\n    this.ready();\n  });\n\n  // notify we've connected\n  Kadira.connected = true;\n};\n\n//track how many times we've sent the data (once per minute)\nKadira._buildPayload = function () {\n  var payload = {host: Kadira.options.hostname, clientVersions: getClientVersions()};\n  var buildDetailedInfo = Kadira._isDetailedInfo();\n  _.extend(payload, Kadira.models.methods.buildPayload(buildDetailedInfo));\n  _.extend(payload, Kadira.models.pubsub.buildPayload(buildDetailedInfo));\n  _.extend(payload, Kadira.models.system.buildPayload());\n  _.extend(payload, Kadira.models.http.buildPayload());\n\n  if(Kadira.options.enableErrorTracking) {\n    _.extend(payload, Kadira.models.error.buildPayload());\n  }\n\n  return payload;\n}\n\nKadira._countDataSent = 0;\nKadira._detailInfoSentInterval = Math.ceil((1000*60) / Kadira.options.payloadTimeout);\nKadira._isDetailedInfo = function () {\n  return (Kadira._countDataSent++ % Kadira._detailInfoSentInterval) == 0;\n}\n\nKadira._sendAppStats = function () {\n  var appStats = {};\n  appStats.release = Meteor.release;\n  appStats.protocolVersion = '1.0.0';\n  appStats.packageVersions = [];\n  appStats.clientVersions = getClientVersions();\n\n  _.each(Package, function (v, name) {\n    appStats.packageVersions.push({\n      name: name,\n      version: packageMap[name] || null\n    });\n  });\n\n  Kadira.coreApi.sendData({\n    startTime: new Date(),\n    appStats: appStats\n  }).then(function(body) {\n    handleApiResponse(body);\n  }).catch(function(err) {\n    console.error('Monti APM Error on sending appStats:', err.message);\n  });\n}\n\nKadira._schedulePayloadSend = function () {\n  clearInterval(buildInterval);\n\n  setTimeout(function () {\n    Kadira._schedulePayloadSend();\n    Kadira._sendPayload();\n  }, Kadira.options.payloadTimeout);\n}\n\nKadira._sendPayload = function () {\n  new Fibers(function() {\n    var payload = Kadira._buildPayload();\n    Kadira.coreApi.sendData(payload)\n      .then(function (body) {\n        handleApiResponse(body);\n      })\n    .catch(function(err) {\n        console.log('Monti APM Error:', err.message);\n      });\n  }).run();\n}\n\n// this return the __kadiraInfo from the current Fiber by default\n// if called with 2nd argument as true, it will get the kadira info from\n// Meteor.EnvironmentVariable\n//\n// WARNNING: returned info object is the reference object.\n//  Changing it might cause issues when building traces. So use with care\nKadira._getInfo = function(currentFiber, useEnvironmentVariable) {\n  currentFiber = currentFiber || Fibers.current;\n  if(currentFiber) {\n    if(useEnvironmentVariable) {\n      return Kadira.env.kadiraInfo.get();\n    }\n    return currentFiber.__kadiraInfo;\n  }\n};\n\n// this does not clone the info object. So, use with care\nKadira._setInfo = function(info) {\n  Fibers.current.__kadiraInfo = info;\n};\n\nKadira.startContinuousProfiling = function () {\n  MontiProfiler.startContinuous(function onProfile({ profile, startTime, endTime }) {\n    if (!Kadira.connected) {\n      return;\n    }\n\n    Kadira.coreApi.sendData({ profiles: [{profile, startTime, endTime }]})\n      .catch(e => console.log('Monti: err sending cpu profile', e));\n  });\n}\n\nKadira.enableErrorTracking = function () {\n  __meteor_runtime_config__.kadira.enableErrorTracking = true;\n  Kadira.options.enableErrorTracking = true;\n};\n\nKadira.disableErrorTracking = function () {\n  __meteor_runtime_config__.kadira.enableErrorTracking = false;\n  Kadira.options.enableErrorTracking = false;\n};\n\nKadira.trackError = function () {\n  if (!Kadira.options.enableErrorTracking) {\n    return;\n  }\n\n  const { message, subType, stack, type } = getErrorParameters(arguments);\n\n  if (message) {\n    var trace = {\n      type: type || 'server-internal',\n      subType: subType || 'server',\n      name: message,\n      errored: true,\n      at: Kadira.syncedDate.getTime(),\n      events: [['start', 0, {}], ['error', 0, { error: { message, stack } }]],\n      metrics: { total: 0 }\n    };\n\n    Kadira.models.error.trackError({ message, stack }, trace);\n  }\n}\n\nKadira.ignoreErrorTracking = function (err) {\n  err._skipKadira = true;\n}\n\nKadira.startEvent = function (name, data = {}) {\n  var kadiraInfo = Kadira._getInfo();\n  if(kadiraInfo) {\n    return Kadira.tracer.event(kadiraInfo.trace, 'custom', data, { name });\n  }\n\n  return false\n}\n\nKadira.endEvent = function (event, data) {\n  var kadiraInfo = Kadira._getInfo();\n\n  // The event could be false if it could not be started.\n  // Handle it here instead of requiring the app to.\n  if (kadiraInfo && event) {\n    Kadira.tracer.eventEnd(kadiraInfo.trace, event, data);\n  }\n}\n","var Fiber = Npm.require('fibers');\n\nwrapServer = function(serverProto) {\n  var originalHandleConnect = serverProto._handleConnect\n  serverProto._handleConnect = function(socket, msg) {\n    originalHandleConnect.call(this, socket, msg);\n    var session = socket._meteorSession;\n    // sometimes it is possible for _meteorSession to be undefined\n    // one such reason would be if DDP versions are not matching\n    // if then, we should not process it\n    if(!session) {\n      return;\n    }\n\n    Kadira.EventBus.emit('system', 'createSession', msg, socket._meteorSession);\n\n    if(Kadira.connected) {\n      Kadira.models.system.handleSessionActivity(msg, socket._meteorSession);\n    }\n  };\n};\n","import { MeteorDebugIgnore } from \"./error\";\n\nconst MAX_PARAMS_LENGTH = 4000\n\nwrapSession = function(sessionProto) {\n  var originalProcessMessage = sessionProto.processMessage;\n  sessionProto.processMessage = function(msg) {\n    if(true) {\n      var kadiraInfo = {\n        session: this.id,\n        userId: this.userId\n      };\n\n      if(msg.msg == 'method' || msg.msg == 'sub') {\n        kadiraInfo.trace = Kadira.tracer.start(this, msg);\n        Kadira.waitTimeBuilder.register(this, msg.id);\n\n        let params = Kadira.tracer._applyObjectFilters(msg.params || []);\n        // use JSON instead of EJSON to save the CPU\n        let stringifiedParams = JSON.stringify(params);\n\n        // The params could be several mb or larger.\n        // Truncate if it is large\n        if (stringifiedParams.length > MAX_PARAMS_LENGTH) {\n          stringifiedParams = `Monti APM: params are too big. First ${MAX_PARAMS_LENGTH} characters: ${stringifiedParams.slice(0, MAX_PARAMS_LENGTH)}`;\n        }\n\n        var startData = { userId: this.userId, params: stringifiedParams };\n        Kadira.tracer.event(kadiraInfo.trace, 'start', startData);\n        var waitEventId = Kadira.tracer.event(kadiraInfo.trace, 'wait', {}, kadiraInfo);\n        msg._waitEventId = waitEventId;\n        msg.__kadiraInfo = kadiraInfo;\n\n        if(msg.msg == 'sub') {\n          // start tracking inside processMessage allows us to indicate\n          // wait time as well\n          Kadira.EventBus.emit('pubsub', 'subReceived', this, msg);\n          Kadira.models.pubsub._trackSub(this, msg);\n        }\n      }\n\n      // Update session last active time\n      Kadira.EventBus.emit('system', 'ddpMessageReceived', this, msg);\n      Kadira.models.system.handleSessionActivity(msg, this);\n    }\n\n    return originalProcessMessage.call(this, msg);\n  };\n\n  // adding the method context to the current fiber\n  var originalMethodHandler = sessionProto.protocol_handlers.method;\n  sessionProto.protocol_handlers.method = function(msg, unblock) {\n    var self = this;\n    //add context\n    var kadiraInfo = msg.__kadiraInfo;\n    if(kadiraInfo) {\n      Kadira._setInfo(kadiraInfo);\n\n      // end wait event\n      var waitList = Kadira.waitTimeBuilder.build(this, msg.id);\n      Kadira.tracer.eventEnd(kadiraInfo.trace, msg._waitEventId, {waitOn: waitList});\n\n      unblock = Kadira.waitTimeBuilder.trackWaitTime(this, msg, unblock);\n      var response = Kadira.env.kadiraInfo.withValue(kadiraInfo, function () {\n        return originalMethodHandler.call(self, msg, unblock);\n      });\n      unblock();\n    } else {\n      var response = originalMethodHandler.call(self, msg, unblock);\n    }\n\n    return response;\n  };\n\n  //to capture the currently processing message\n  var orginalSubHandler = sessionProto.protocol_handlers.sub;\n  sessionProto.protocol_handlers.sub = function(msg, unblock) {\n    var self = this;\n    //add context\n    var kadiraInfo = msg.__kadiraInfo;\n    if(kadiraInfo) {\n      Kadira._setInfo(kadiraInfo);\n\n      // end wait event\n      var waitList = Kadira.waitTimeBuilder.build(this, msg.id);\n      Kadira.tracer.eventEnd(kadiraInfo.trace, msg._waitEventId, {waitOn: waitList});\n\n      unblock = Kadira.waitTimeBuilder.trackWaitTime(this, msg, unblock);\n      var response = Kadira.env.kadiraInfo.withValue(kadiraInfo, function () {\n        return orginalSubHandler.call(self, msg, unblock);\n      });\n      unblock();\n    } else {\n      var response = orginalSubHandler.call(self, msg, unblock);\n    }\n\n    return response;\n  };\n\n  //to capture the currently processing message\n  var orginalUnSubHandler = sessionProto.protocol_handlers.unsub;\n  sessionProto.protocol_handlers.unsub = function(msg, unblock) {\n    unblock = Kadira.waitTimeBuilder.trackWaitTime(this, msg, unblock);\n    var response = orginalUnSubHandler.call(this, msg, unblock);\n    unblock();\n    return response;\n  };\n\n  //track method ending (to get the result of error)\n  var originalSend = sessionProto.send;\n  sessionProto.send = function(msg) {\n    if(msg.msg == 'result') {\n      var kadiraInfo = Kadira._getInfo();\n      if(kadiraInfo) {\n        if(msg.error) {\n          var error = _.pick(msg.error, ['message', 'stack', 'details']);\n\n          // pick the error from the wrapped method handler\n          if(kadiraInfo && kadiraInfo.currentError) {\n            // the error stack is wrapped so Meteor._debug can identify\n            // this as a method error.\n            error = _.pick(kadiraInfo.currentError, ['message', 'stack', 'details']);\n            // see wrapMethodHanderForErrors() method def for more info\n            if(error.stack && error.stack.stack) {\n              error.stack = error.stack.stack;\n            }\n          }\n\n          Kadira.tracer.endLastEvent(kadiraInfo.trace);\n          Kadira.tracer.event(kadiraInfo.trace, 'error', {error: error});\n        } else {\n          Kadira.tracer.endLastEvent(kadiraInfo.trace);\n          Kadira.tracer.event(kadiraInfo.trace, 'complete');\n        }\n\n        //processing the message\n        var trace = Kadira.tracer.buildTrace(kadiraInfo.trace);\n        Kadira.EventBus.emit('method', 'methodCompleted', trace, this);\n        Kadira.models.methods.processMethod(trace);\n\n        // error may or may not exist and error tracking can be disabled\n        if(error && Kadira.options.enableErrorTracking) {\n          Kadira.models.error.trackError(error, trace);\n        }\n\n        //clean and make sure, fiber is clean\n        //not sure we need to do this, but a preventive measure\n        Kadira._setInfo(null);\n      }\n    }\n\n    return originalSend.call(this, msg);\n  };\n};\n\n// wrap existing method handlers for capturing errors\n_.each(Meteor.server.method_handlers, function(handler, name) {\n  wrapMethodHanderForErrors(name, handler, Meteor.server.method_handlers);\n});\n\n// wrap future method handlers for capturing errors\nvar originalMeteorMethods = Meteor.methods;\nMeteor.methods = function(methodMap) {\n  _.each(methodMap, function(handler, name) {\n    wrapMethodHanderForErrors(name, handler, methodMap);\n  });\n  originalMeteorMethods(methodMap);\n};\n\n\nfunction wrapMethodHanderForErrors(name, originalHandler, methodMap) {\n  methodMap[name] = function() {\n    try{\n      return originalHandler.apply(this, arguments);\n    } catch(ex) {\n      if(ex && Kadira._getInfo()) {\n        // sometimes error may be just an string or a primitive\n        // in that case, we need to make it a psuedo error\n        if(typeof ex !== 'object') {\n          ex = {message: ex, stack: ex};\n        }\n        // Now we are marking this error to get tracked via methods\n        // But, this also triggers a Meteor.debug call and\n        // it only gets the stack\n        // We also track Meteor.debug errors and want to stop\n        // tracking this error. That's why we do this\n        // See Meteor.debug error tracking code for more\n        // If error tracking is disabled, we do not modify the stack since\n        // it would be shown as an object in the logs\n        if (Kadira.options.enableErrorTracking) {\n          ex.stack = {stack: ex.stack, source: 'method', [MeteorDebugIgnore]: true};\n          Kadira._getInfo().currentError = ex;\n        }\n      }\n      throw ex;\n    }\n  }\n}\n","import { MeteorDebugIgnore } from \"./error\";\n\nwrapSubscription = function(subscriptionProto) {\n  // If the ready event runs outside the Fiber, Kadira._getInfo() doesn't work.\n  // we need some other way to store kadiraInfo so we can use it at ready hijack.\n  var originalRunHandler = subscriptionProto._runHandler;\n  subscriptionProto._runHandler = function() {\n    var kadiraInfo = Kadira._getInfo();\n    if (kadiraInfo) {\n      this.__kadiraInfo = kadiraInfo;\n    };\n    originalRunHandler.call(this);\n  }\n\n  var originalReady = subscriptionProto.ready;\n  subscriptionProto.ready = function() {\n    // meteor has a field called `_ready` which tracks this\n    // but we need to make it future proof\n    if(!this._apmReadyTracked) {\n      var kadiraInfo = Kadira._getInfo() || this.__kadiraInfo;\n      delete this.__kadiraInfo;\n      //sometime .ready can be called in the context of the method\n      //then we have some problems, that's why we are checking this\n      //eg:- Accounts.createUser\n      // Also, when the subscription is created by fast render, _subscriptionId and\n      // the trace.id are both undefined but we don't want to complete the HTTP trace here\n      if(kadiraInfo && this._subscriptionId && this._subscriptionId == kadiraInfo.trace.id) {\n        Kadira.tracer.endLastEvent(kadiraInfo.trace);\n        Kadira.tracer.event(kadiraInfo.trace, 'complete');\n        var trace = Kadira.tracer.buildTrace(kadiraInfo.trace);\n      }\n\n      Kadira.EventBus.emit('pubsub', 'subCompleted', trace, this._session, this);\n      Kadira.models.pubsub._trackReady(this._session, this, trace);\n      this._apmReadyTracked = true;\n    }\n\n    // we still pass the control to the original implementation\n    // since multiple ready calls are handled by itself\n    originalReady.call(this);\n  };\n\n  var originalError = subscriptionProto.error;\n  subscriptionProto.error = function(err) {\n    if (typeof err === 'string') {\n      err = { message: err };\n    }\n\n    var kadiraInfo = Kadira._getInfo();\n\n    if (kadiraInfo && this._subscriptionId && this._subscriptionId == kadiraInfo.trace.id) {\n      Kadira.tracer.endLastEvent(kadiraInfo.trace);\n\n      var errorForApm = _.pick(err, 'message', 'stack');\n      Kadira.tracer.event(kadiraInfo.trace, 'error', {error: errorForApm});\n      var trace = Kadira.tracer.buildTrace(kadiraInfo.trace);\n\n      Kadira.models.pubsub._trackError(this._session, this, trace);\n\n      // error tracking can be disabled and if there is a trace\n      // trace should be available all the time, but it won't\n      // if something wrong happened on the trace building\n      if(Kadira.options.enableErrorTracking && trace) {\n        Kadira.models.error.trackError(err, trace);\n      }\n    }\n\n    // wrap error stack so Meteor._debug can identify and ignore it\n    // it is not wrapped when error tracking is disabled since it\n    // would be shown as an object in the logs\n    if (Kadira.options.enableErrorTracking) {\n      err.stack = {stack: err.stack, source: 'subscription', [MeteorDebugIgnore]: true};\n    }\n    originalError.call(this, err);\n  };\n\n  var originalDeactivate = subscriptionProto._deactivate;\n  subscriptionProto._deactivate = function() {\n    Kadira.EventBus.emit('pubsub', 'subDeactivated', this._session, this);\n    Kadira.models.pubsub._trackUnsub(this._session, this);\n    originalDeactivate.call(this);\n  };\n\n  //adding the currenSub env variable\n  ['added', 'changed', 'removed'].forEach(function(funcName) {\n    var originalFunc = subscriptionProto[funcName];\n    subscriptionProto[funcName] = function(collectionName, id, fields) {\n      var self = this;\n\n      // we need to run this code in a fiber and that's how we track\n      // subscription info. May be we can figure out, some other way to do this\n      // We use this currently to get the publication info when tracking message\n      // sizes at wrap_ddp_stringify.js\n      Kadira.env.currentSub = self;\n      var res = originalFunc.call(self, collectionName, id, fields);\n      Kadira.env.currentSub = null;\n\n      return res;\n    };\n  });\n};\n","wrapOplogObserveDriver = function(proto) {\n  // Track the polled documents. This is reflect to the RAM size and\n  // for the CPU usage directly\n  var originalPublishNewResults = proto._publishNewResults;\n  proto._publishNewResults = function(newResults, newBuffer) {\n    var coll = this._cursorDescription.collectionName;\n    var query = this._cursorDescription.selector;\n    var opts = this._cursorDescription.options;\n    var docSize = Kadira.docSzCache.getSize(coll, query, opts, newResults);\n    var docSize = Kadira.docSzCache.getSize(coll, query, opts, newBuffer);\n    var count = newResults.size() + newBuffer.size();\n    if(this._ownerInfo) {\n      Kadira.models.pubsub.trackPolledDocuments(this._ownerInfo, count);\n      Kadira.models.pubsub.trackDocSize(this._ownerInfo.name, \"polledFetches\", docSize*count);\n    } else {\n      this._polledDocuments = count;\n      this._docSize = {\n        polledFetches: docSize*count\n      }\n    }\n    return originalPublishNewResults.call(this, newResults, newBuffer);\n  };\n\n  var originalHandleOplogEntryQuerying = proto._handleOplogEntryQuerying;\n  proto._handleOplogEntryQuerying = function(op) {\n    Kadira.models.pubsub.trackDocumentChanges(this._ownerInfo, op);\n    return originalHandleOplogEntryQuerying.call(this, op);\n  };\n\n  var originalHandleOplogEntrySteadyOrFetching = proto._handleOplogEntrySteadyOrFetching;\n  proto._handleOplogEntrySteadyOrFetching = function(op) {\n    Kadira.models.pubsub.trackDocumentChanges(this._ownerInfo, op);\n    return originalHandleOplogEntrySteadyOrFetching.call(this, op);\n  };\n\n  // track live updates\n  ['_addPublished', '_removePublished', '_changePublished'].forEach(function(fnName) {\n    var originalFn = proto[fnName];\n    proto[fnName] = function(a, b, c) {\n      if(this._ownerInfo) {\n        Kadira.models.pubsub.trackLiveUpdates(this._ownerInfo, fnName, 1);\n\n        if(fnName === \"_addPublished\") {\n          var coll = this._cursorDescription.collectionName;\n          var query = this._cursorDescription.selector;\n          var opts = this._cursorDescription.options;\n          var docSize = Kadira.docSzCache.getSize(coll, query, opts, [b]);\n\n          Kadira.models.pubsub.trackDocSize(this._ownerInfo.name, \"liveFetches\", docSize);\n        }\n      } else {\n        // If there is no ownerInfo, that means this is the initial adds\n        if(!this._liveUpdatesCounts) {\n          this._liveUpdatesCounts = {\n            _initialAdds: 0\n          };\n        }\n\n        this._liveUpdatesCounts._initialAdds++;\n\n        if(fnName === \"_addPublished\") {\n          if(!this._docSize) {\n            this._docSize = {\n              initialFetches: 0\n            };\n          }\n\n          if(!this._docSize.initialFetches) {\n            this._docSize.initialFetches = 0;\n          }\n\n          var coll = this._cursorDescription.collectionName;\n          var query = this._cursorDescription.selector;\n          var opts = this._cursorDescription.options;\n          var docSize = Kadira.docSzCache.getSize(coll, query, opts, [b]);\n\n          this._docSize.initialFetches += docSize;\n        }\n      }\n\n      return originalFn.call(this, a, b, c);\n    };\n  });\n\n  var originalStop = proto.stop;\n  proto.stop = function() {\n    if(this._ownerInfo && this._ownerInfo.type === 'sub') {\n      Kadira.EventBus.emit('pubsub', 'observerDeleted', this._ownerInfo);\n      Kadira.models.pubsub.trackDeletedObserver(this._ownerInfo);\n    }\n\n    return originalStop.call(this);\n  };\n};\n\nwrapPollingObserveDriver = function(proto) {\n  var originalPollMongo = proto._pollMongo;\n  proto._pollMongo = function() {\n    var start = Date.now();\n    originalPollMongo.call(this);\n\n    // Current result is stored in the following variable.\n    // So, we can use that\n    // Sometimes, it's possible to get size as undefined.\n    // May be something with different version. We don't need to worry about\n    // this now\n    var count = 0;\n    var docSize = 0;\n\n    if(this._results && this._results.size) {\n      count = this._results.size() || 0;\n\n      var coll = this._cursorDescription.collectionName;\n      var query = this._cursorDescription.selector;\n      var opts = this._cursorDescription.options;\n\n      docSize = Kadira.docSzCache.getSize(coll, query, opts, this._results._map)*count;\n    }\n\n    if(this._ownerInfo) {\n      Kadira.models.pubsub.trackPolledDocuments(this._ownerInfo, count);\n      Kadira.models.pubsub.trackDocSize(this._ownerInfo.name, \"polledFetches\", docSize);\n    } else {\n      this._polledDocuments = count;\n      this._polledDocSize = docSize;\n    }\n  };\n\n  var originalStop = proto.stop;\n  proto.stop = function() {\n    if(this._ownerInfo && this._ownerInfo.type === 'sub') {\n      Kadira.EventBus.emit('pubsub', 'observerDeleted', this._ownerInfo);\n      Kadira.models.pubsub.trackDeletedObserver(this._ownerInfo);\n    }\n\n    return originalStop.call(this);\n  };\n};\n\nwrapMultiplexer = function(proto) {\n  var originalInitalAdd = proto.addHandleAndSendInitialAdds;\n   proto.addHandleAndSendInitialAdds = function(handle) {\n    if(!this._firstInitialAddTime) {\n      this._firstInitialAddTime = Date.now();\n    }\n\n    handle._wasMultiplexerReady = this._ready();\n    handle._queueLength = this._queue._taskHandles.length;\n\n    if(!handle._wasMultiplexerReady) {\n      handle._elapsedPollingTime = Date.now() - this._firstInitialAddTime;\n    }\n    return originalInitalAdd.call(this, handle);\n  };\n};\n\nwrapForCountingObservers = function() {\n  // to count observers\n  var mongoConnectionProto = MeteorX.MongoConnection.prototype;\n  var originalObserveChanges = mongoConnectionProto._observeChanges;\n  mongoConnectionProto._observeChanges = function(cursorDescription, ordered, callbacks) {\n    var ret = originalObserveChanges.call(this, cursorDescription, ordered, callbacks);\n    // get the Kadira Info via the Meteor.EnvironmentalVariable\n    var kadiraInfo = Kadira._getInfo(null, true);\n\n    if(kadiraInfo && ret._multiplexer) {\n      if(!ret._multiplexer.__kadiraTracked) {\n        // new multiplexer\n        ret._multiplexer.__kadiraTracked = true;\n        Kadira.EventBus.emit('pubsub', 'newSubHandleCreated', kadiraInfo.trace);\n        Kadira.models.pubsub.incrementHandleCount(kadiraInfo.trace, false);\n        if(kadiraInfo.trace.type == 'sub') {\n          var ownerInfo = {\n            type: kadiraInfo.trace.type,\n            name: kadiraInfo.trace.name,\n            startTime: (new Date()).getTime()\n          };\n\n          var observerDriver = ret._multiplexer._observeDriver;\n          observerDriver._ownerInfo = ownerInfo;\n          Kadira.EventBus.emit('pubsub', 'observerCreated', ownerInfo);\n          Kadira.models.pubsub.trackCreatedObserver(ownerInfo);\n\n          // We need to send initially polled documents if there are\n          if(observerDriver._polledDocuments) {\n            Kadira.models.pubsub.trackPolledDocuments(ownerInfo, observerDriver._polledDocuments);\n            observerDriver._polledDocuments = 0;\n          }\n\n          // We need to send initially polled documents if there are\n          if(observerDriver._polledDocSize) {\n            Kadira.models.pubsub.trackDocSize(ownerInfo.name, \"polledFetches\", observerDriver._polledDocSize);\n            observerDriver._polledDocSize = 0;\n          }\n\n          // Process _liveUpdatesCounts\n          _.each(observerDriver._liveUpdatesCounts, function(count, key) {\n            Kadira.models.pubsub.trackLiveUpdates(ownerInfo, key, count);\n          });\n\n          // Process docSize\n          _.each(observerDriver._docSize, function(count, key) {\n            Kadira.models.pubsub.trackDocSize(ownerInfo.name, key, count);\n          });\n        }\n      } else {\n        Kadira.EventBus.emit('pubsub', 'cachedSubHandleCreated', kadiraInfo.trace);\n        Kadira.models.pubsub.incrementHandleCount(kadiraInfo.trace, true);\n      }\n    }\n\n    return ret;\n  }\n};","wrapStringifyDDP = function() {\n  var originalStringifyDDP = DDPCommon.stringifyDDP;\n\n  DDPCommon.stringifyDDP = function(msg) {\n    var msgString = originalStringifyDDP(msg);\n    var msgSize = Buffer.byteLength(msgString, 'utf8');\n\n    var kadiraInfo = Kadira._getInfo(null, true);\n\n    if(kadiraInfo && !Kadira.env.currentSub) {\n      if(kadiraInfo.trace.type === 'method') {\n        Kadira.models.methods.trackMsgSize(kadiraInfo.trace.name, msgSize);\n      }\n\n      return msgString;\n    }\n\n    // 'currentSub' is set when we wrap Subscription object and override\n    // handlers for 'added', 'changed', 'removed' events. (see lib/hijack/wrap_subscription.js)\n    if(Kadira.env.currentSub) {\n      if(Kadira.env.currentSub.__kadiraInfo){\n        Kadira.models.pubsub.trackMsgSize(Kadira.env.currentSub._name, \"initialSent\", msgSize);\n        return msgString;\n      }\n      Kadira.models.pubsub.trackMsgSize(Kadira.env.currentSub._name, \"liveSent\", msgSize);\n      return msgString;\n    }\n\n    Kadira.models.methods.trackMsgSize(\"<not-a-method-or-a-pub>\", msgSize);\n    return msgString;\n  }\n}\n","import { wrapWebApp } from \"./wrap_webapp.js\";\nimport { wrapFastRender } from \"./fast_render.js\";\nimport { wrapFs } from \"./fs.js\";\nimport { wrapPicker } from \"./picker.js\";\nimport { wrapRouters } from './wrap_routers.js';\nimport { wrapFibers } from './async.js';\n\nvar instrumented = false;\nKadira._startInstrumenting = function(callback) {\n  if(instrumented) {\n    callback();\n    return;\n  }\n\n  instrumented = true;\n  wrapFibers();\n  wrapStringifyDDP();\n  wrapWebApp();\n  wrapFastRender();\n  wrapPicker();\n  wrapFs();\n  wrapRouters();\n\n  MeteorX.onReady(function() {\n    //instrumenting session\n    wrapServer(MeteorX.Server.prototype);\n    wrapSession(MeteorX.Session.prototype);\n    wrapSubscription(MeteorX.Subscription.prototype);\n\n    if(MeteorX.MongoOplogDriver) {\n      wrapOplogObserveDriver(MeteorX.MongoOplogDriver.prototype);\n    }\n\n    if(MeteorX.MongoPollingDriver) {\n      wrapPollingObserveDriver(MeteorX.MongoPollingDriver.prototype);\n    }\n\n    if(MeteorX.Multiplexer) {\n      wrapMultiplexer(MeteorX.Multiplexer.prototype);\n    }\n\n    wrapForCountingObservers();\n    hijackDBOps();\n\n    setLabels();\n    callback();\n  });\n};\n\n// We need to instrument this right away and it's okay\n// One reason for this is to call `setLables()` function\n// Otherwise, CPU profile can't see all our custom labeling\nKadira._startInstrumenting(function() {\n  console.log('Monti APM: completed instrumenting the app')\n});\n","// This hijack is important to make sure, collections created before\n// we hijack dbOps, even gets tracked.\n//  Meteor does not simply expose MongoConnection object to the client\n//  It picks methods which are necessory and make a binded object and\n//  assigned to the Mongo.Collection\n//  so, even we updated prototype, we can't track those collections\n//  but, this will fix it.\nvar originalOpen = MongoInternals.RemoteCollectionDriver.prototype.open;\nMongoInternals.RemoteCollectionDriver.prototype.open = function open(name) {\n  var self = this;\n  var ret = originalOpen.call(self, name);\n\n  _.each(ret, function(fn, m) {\n    // make sure, it's in the actual mongo connection object\n    // meteorhacks:mongo-collection-utils package add some arbitary methods\n    // which does not exist in the mongo connection\n    if(self.mongo[m]) {\n      ret[m] = function() {\n        Array.prototype.unshift.call(arguments, name);\n        return OptimizedApply(self.mongo, self.mongo[m], arguments);\n      };\n    }\n  });\n\n  return ret;\n};\n\n// TODO: this should be added to Meteorx\nfunction getSyncronousCursor() {\n  const MongoColl = typeof Mongo !== \"undefined\" ? Mongo.Collection : Meteor.Collection;\n  const coll = new MongoColl(\"__dummy_coll_\" + Random.id());\n  // we need to wait until the db is connected with meteor. findOne does that\n  coll.findOne();\n  \n  const cursor = coll.find();\n  cursor.fetch();\n  return cursor._synchronousCursor.constructor\n}\n\nhijackDBOps = function hijackDBOps() {\n  var mongoConnectionProto = MeteorX.MongoConnection.prototype;\n  //findOne is handled by find - so no need to track it\n  //upsert is handles by update\n  //2.4 replaced _ensureIndex with createIndex\n  [\n    'find', 'update', 'remove', 'insert', '_ensureIndex', '_dropIndex', 'createIndex'\n  ].forEach(function(func) {\n    var originalFunc = mongoConnectionProto[func];\n\n    if (!originalFunc) {\n      return;\n    }\n\n    mongoConnectionProto[func] = function(collName, selector, mod, options) {\n      var payload = {\n        coll: collName,\n        func: func,\n      };\n\n      if(func == 'insert') {\n        //add nothing more to the payload\n      } else if(func == '_ensureIndex' || func == '_dropIndex' || func === 'createIndex') {\n        //add index\n        payload.index = JSON.stringify(selector);\n      } else if(func == 'update' && options && options.upsert) {\n        payload.func = 'upsert';\n        payload.selector = JSON.stringify(selector);\n      } else {\n        //all the other functions have selectors\n        payload.selector = JSON.stringify(selector);\n      }\n\n      var kadiraInfo = Kadira._getInfo();\n      if(kadiraInfo) {\n        var eventId = Kadira.tracer.event(kadiraInfo.trace, 'db', payload);\n      }\n\n      //this cause V8 to avoid any performance optimizations, but this is must to use\n      //otherwise, if the error adds try catch block our logs get messy and didn't work\n      //see: issue #6\n      try{\n        var ret = originalFunc.apply(this, arguments);\n        //handling functions which can be triggered with an asyncCallback\n        var endOptions = {};\n\n        if(HaveAsyncCallback(arguments)) {\n          endOptions.async = true;\n        }\n\n        if(func == 'update') {\n          // upsert only returns an object when called `upsert` directly\n          // otherwise it only act an update command\n          if(options && options.upsert && typeof ret == 'object') {\n            endOptions.updatedDocs = ret.numberAffected;\n            endOptions.insertedId = ret.insertedId;\n          } else {\n            endOptions.updatedDocs = ret;\n          }\n        } else if(func == 'remove') {\n          endOptions.removedDocs = ret;\n        }\n\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, endOptions);\n        }\n      } catch(ex) {\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n        }\n        throw ex;\n      }\n\n      return ret;\n    };\n  });\n\n  var cursorProto = MeteorX.MongoCursor.prototype;\n  ['forEach', 'map', 'fetch', 'count', 'observeChanges', 'observe'].forEach(function(type) {\n    var originalFunc = cursorProto[type];\n    cursorProto[type] = function() {\n      var cursorDescription = this._cursorDescription;\n      var payload = Object.assign(Object.create(null), {\n        coll: cursorDescription.collectionName,\n        selector: JSON.stringify(cursorDescription.selector),\n        func: type,\n        cursor: true\n      });\n\n      if(cursorDescription.options) {\n        var cursorOptions = _.pick(cursorDescription.options, ['fields', 'projection', 'sort', 'limit']);\n        for(var field in cursorOptions) {\n          var value = cursorOptions[field]\n          if(typeof value == 'object') {\n            value = JSON.stringify(value);\n          }\n          payload[field] = value;\n        }\n      }\n\n      var kadiraInfo = Kadira._getInfo();\n      var previousTrackNextObject;\n      if(kadiraInfo) {\n        var eventId = Kadira.tracer.event(kadiraInfo.trace, 'db', payload);\n\n        previousTrackNextObject = kadiraInfo.trackNextObject\n        if (type === 'forEach' || type === 'map') {\n          kadiraInfo.trackNextObject = true;\n        }\n      }\n\n      try{\n        var ret = originalFunc.apply(this, arguments);\n\n        var endData = {};\n        if(type == 'observeChanges' || type == 'observe') {\n          var observerDriver;\n          endData.oplog = false;\n          // get data written by the multiplexer\n          endData.wasMultiplexerReady = ret._wasMultiplexerReady;\n          endData.queueLength = ret._queueLength;\n          endData.elapsedPollingTime = ret._elapsedPollingTime;\n\n          if(ret._multiplexer) {\n            // older meteor versions done not have an _multiplexer value\n            observerDriver = ret._multiplexer._observeDriver;\n            if(observerDriver) {\n              observerDriver = ret._multiplexer._observeDriver;\n              var observerDriverClass = observerDriver.constructor;\n              var usesOplog = typeof observerDriverClass.cursorSupported == 'function';\n              endData.oplog = usesOplog;\n              var size = 0;\n              ret._multiplexer._cache.docs.forEach(function() {size++});\n              endData.noOfCachedDocs = size;\n\n              // if multiplexerWasNotReady, we need to get the time spend for the polling\n              if(!ret._wasMultiplexerReady) {\n                endData.initialPollingTime = observerDriver._lastPollTime;\n              }\n            }\n          }\n\n          if(!endData.oplog) {\n            // let's try to find the reason\n            var reasonInfo = Kadira.checkWhyNoOplog(cursorDescription, observerDriver);\n            endData.noOplogCode = reasonInfo.code;\n            endData.noOplogReason = reasonInfo.reason;\n            endData.noOplogSolution = reasonInfo.solution;\n          }\n        } else if(type == 'fetch' || type == 'map'){\n          //for other cursor operation\n\n          endData.docsFetched = ret.length;\n\n          if(type == 'fetch') {\n            var coll = cursorDescription.collectionName;\n            var query = cursorDescription.selector;\n            var opts = cursorDescription.options;\n            var docSize = Kadira.docSzCache.getSize(coll, query, opts, ret) * ret.length;\n            endData.docSize = docSize;\n\n            if(kadiraInfo) {\n              if(kadiraInfo.trace.type === 'method') {\n                Kadira.models.methods.trackDocSize(kadiraInfo.trace.name, docSize);\n              } else if(kadiraInfo.trace.type === 'sub') {\n                Kadira.models.pubsub.trackDocSize(kadiraInfo.trace.name, \"cursorFetches\", docSize);\n              }\n\n              kadiraInfo.trackNextObject = previousTrackNextObject\n            } else {\n              // Fetch with no kadira info are tracked as from a null method\n              Kadira.models.methods.trackDocSize(\"<not-a-method-or-a-pub>\", docSize);\n            }\n\n            // TODO: Add doc size tracking to `map` as well.\n          }\n        }\n\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, endData);\n        }\n        return ret;\n      } catch(ex) {\n        if(eventId) {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n        }\n        throw ex;\n      }\n    };\n  });\n\n  const SyncronousCursor = getSyncronousCursor();\n  var origNextObject = SyncronousCursor.prototype._nextObject\n  SyncronousCursor.prototype._nextObject = function () {\n    var kadiraInfo = Kadira._getInfo();\n    var shouldTrack = kadiraInfo && kadiraInfo.trackNextObject;\n    if(shouldTrack ) {\n      var event = Kadira.tracer.event(kadiraInfo.trace, 'db', {\n        func: '_nextObject',\n        coll: this._cursorDescription.collectionName\n      });\n    }\n\n    var result = origNextObject.call(this);\n\n    if (shouldTrack) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n    }\n    return result;\n  }\n};\n","if (Package['http']) {\n  const HTTP = Package['http'].HTTP;\n\n  var originalCall = HTTP.call;\n\n  HTTP.call = function (method, url) {\n    var kadiraInfo = Kadira._getInfo();\n    if (kadiraInfo) {\n      var eventId = Kadira.tracer.event(kadiraInfo.trace, 'http', { method: method, url: url });\n    }\n\n    try {\n      var response = originalCall.apply(this, arguments);\n\n      //if the user supplied an asynCallback, we don't have a response object and it handled asynchronously\n      //we need to track it down to prevent issues like: #3\n      var endOptions = HaveAsyncCallback(arguments) ? { async: true } : { statusCode: response.statusCode };\n      if (eventId) {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, endOptions);\n      }\n      return response;\n    } catch (ex) {\n      if (eventId) {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, { err: ex.message });\n      }\n      throw ex;\n    }\n  };\n}","if (Package['email']) {\n  const Email = Package['email'].Email;\n\n  var originalSend = Email.send;\n\nEmail.send = function(options) {\n    var kadiraInfo = Kadira._getInfo();\n  if(kadiraInfo) {\n      var data = _.pick(options, 'from', 'to', 'cc', 'bcc', 'replyTo');\n      var eventId = Kadira.tracer.event(kadiraInfo.trace, 'email', data);\n    }\n    try {\n      var ret = originalSend.call(this, options);\n    if(eventId) {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, eventId);\n      }\n      return ret;\n  } catch(ex) {\n    if(eventId) {\n      Kadira.tracer.eventEnd(kadiraInfo.trace, eventId, {err: ex.message});\n      }\n      throw ex;\n    }\n  };\n}","var Fibers = Npm.require('fibers');\nvar EventSymbol = Symbol();\nvar StartTracked = Symbol();\n\nvar activeFibers = 0;\nvar wrapped = false;\n\nexport function wrapFibers() {\n  if (wrapped) {\n    return;\n  }\n  wrapped = true;\n\n  var originalYield = Fibers.yield;\n  Fibers.yield = function () {\n    var kadiraInfo = Kadira._getInfo();\n    if (kadiraInfo) {\n      var eventId = Kadira.tracer.event(kadiraInfo.trace, 'async');\n      if (eventId) {\n        // The event unique to this fiber\n        // Using a symbol since Meteor doesn't copy symbols to new fibers created\n        // for promises. This is needed so the correct event is ended when a fiber runs after being yielded.\n        Fibers.current[EventSymbol] = eventId;\n      }\n    }\n\n    return originalYield();\n  };\n\n  var originalRun = Fibers.prototype.run;\n  var originalThrowInto = Fibers.prototype.throwInto;\n\n  function ensureFiberCounted(fiber) {\n    // If fiber.started is true, and StartTracked is false\n    // then the fiber was probably initially ran before we wrapped Fibers.run\n    if (!fiber.started || !fiber[StartTracked]) {\n      activeFibers += 1;\n      fiber[StartTracked] = true;\n    }\n  }\n\n  Fibers.prototype.run = function (val) {\n    ensureFiberCounted(this);\n\n    if (this[EventSymbol]) {\n      var kadiraInfo = Kadira._getInfo(this);\n      if (kadiraInfo) {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, this[EventSymbol]);\n        this[EventSymbol] = null;\n      }\n    } else if (!this.__kadiraInfo && Fibers.current && Fibers.current.__kadiraInfo) {\n      // Copy kadiraInfo when packages or user code creates a new fiber\n      // Done by many apps and packages in connect middleware since older\n      // versions of Meteor did not do it automatically\n      this.__kadiraInfo = Fibers.current.__kadiraInfo;\n    }\n\n    let result;\n    try {\n      result = originalRun.call(this, val);\n    } finally {\n      if (!this.started) {\n        activeFibers -= 1;\n        this[StartTracked] = false;\n      }\n    }\n\n    return result;\n  };\n\n  Fibers.prototype.throwInto = function (val) {\n    ensureFiberCounted(this);\n\n    // TODO: this should probably end the current async event since in some places\n    // Meteor calls throwInto instead of run after a fiber is yielded. For example,\n    // when a promise is awaited and rejects an error.\n\n    let result;\n    try {\n      result = originalThrowInto.call(this, val);\n    } finally {\n      if (!this.started) {\n        activeFibers -= 1;\n        this[StartTracked] = false;\n      }\n    }\n\n    return result;\n  };\n}\n\nlet activeFiberTotal = 0;\nlet activeFiberCount = 0;\nlet previousTotalCreated = 0;\n\nsetInterval(() => {\n  activeFiberTotal += activeFibers;\n  activeFiberCount += 1;\n}, 1000);\n\nexport function getFiberMetrics() {\n  return {\n    created: Fibers.fibersCreated - previousTotalCreated,\n    active: activeFiberTotal / activeFiberCount,\n    poolSize: Fibers.poolSize\n  }\n}\n\nexport function resetFiberMetrics() {\n  activeFiberTotal = 0;\n  activeFiberCount = 0;\n  previousTotalCreated = Fibers.fibersCreated;\n}\n","export const MeteorDebugIgnore = Symbol()\n\nTrackUncaughtExceptions = function () {\n  process.on('uncaughtException', function (err) {\n    // skip errors with `_skipKadira` flag\n    if(err._skipKadira) {\n      return;\n    }\n\n    // let the server crash normally if error tracking is disabled\n    if(!Kadira.options.enableErrorTracking) {\n      printErrorAndKill(err);\n    }\n\n    // looking for already tracked errors and throw them immediately\n    // throw error immediately if kadira is not ready\n    if(err._tracked || !Kadira.connected) {\n      printErrorAndKill(err);\n    }\n\n    var trace = getTrace(err, 'server-crash', 'uncaughtException');\n    Kadira.models.error.trackError(err, trace);\n    Kadira._sendPayload(function () {\n      clearTimeout(timer);\n      throwError(err);\n    });\n\n    var timer = setTimeout(function () {\n      throwError(err);\n    }, 1000*10);\n\n    function throwError(err) {\n      // sometimes error came back from a fiber.\n      // But we don't fibers to track that error for us\n      // That's why we throw the error on the nextTick\n      process.nextTick(function() {\n        // we need to mark this error where we really need to throw\n        err._tracked = true;\n        printErrorAndKill(err);\n      });\n    }\n  });\n\n  function printErrorAndKill(err) {\n    // since we are capturing error, we are also on the error message.\n    // so developers think we are also reponsible for the error.\n    // But we are not. This will fix that.\n    console.error(err.stack);\n    process.exit(7);\n  }\n}\n\nTrackUnhandledRejections = function () {\n  process.on('unhandledRejection', function (reason) {\n    // skip errors with `_skipKadira` flag\n    if(\n      reason._skipKadira ||\n      !Kadira.options.enableErrorTracking\n    ) {\n      return;\n    }\n\n    var trace = getTrace(reason, 'server-internal', 'unhandledRejection');\n    Kadira.models.error.trackError(reason, trace);\n\n    // TODO: we should respect the --unhandled-rejections option\n    // message taken from \n    // https://github.com/nodejs/node/blob/f4797ff1ef7304659d747d181ec1e7afac408d50/lib/internal/process/promises.js#L243-L248\n    const message =\n      'This error originated either by ' +\n      'throwing inside of an async function without a catch block, ' +\n      'or by rejecting a promise which was not handled with .catch().' +\n      ' The promise rejected with the reason: ';\n\n    // We could emit a warning instead like Node does internally\n    // but it requires Node 8 or newer\n    console.warn(message);\n    console.error(reason && reason.stack ? reason.stack : reason)\n  });\n}\n\nTrackMeteorDebug = function () {\n  var originalMeteorDebug = Meteor._debug;\n  Meteor._debug = function (message, stack) {\n    // Sometimes Meteor calls Meteor._debug with no arguments\n    // to log an empty line\n    const isArgs = message !== undefined || stack !== undefined;\n\n    // We've changed `stack` into an object at method and sub handlers so we can\n    // detect the error here. These errors are already tracked so don't track them again.\n    var alreadyTracked = false;\n\n    // Some Meteor versions pass the error, and other versions pass the error stack\n    // Restore so origionalMeteorDebug shows the stack as a string instead as an object\n    if (stack && stack[MeteorDebugIgnore]) {\n      alreadyTracked = true;\n      arguments[1] = stack.stack;\n    } else if (stack && stack.stack && stack.stack[MeteorDebugIgnore]) {\n      alreadyTracked = true;\n      arguments[1] = stack.stack.stack;\n    }\n\n    // only send to the server if connected to kadira\n    if (\n      Kadira.options.enableErrorTracking &&\n      isArgs &&\n      !alreadyTracked &&\n      Kadira.connected\n    ) {\n      let errorMessage = message;\n\n      if (typeof message == 'string' && stack instanceof Error) {\n        const separator = message.endsWith(':') ? '' : ':'\n        errorMessage = `${message}${separator} ${stack.message}`\n      }\n\n      let error = new Error(errorMessage);\n      if (stack instanceof Error) {\n        error.stack = stack.stack;\n      } else if (stack) {\n        error.stack = stack;\n      } else {\n        error.stack = CreateUserStack(error);\n      }\n      var trace = getTrace(error, 'server-internal', 'Meteor._debug');\n      Kadira.models.error.trackError(error, trace);\n    }\n\n    return originalMeteorDebug.apply(this, arguments);\n  }\n}\n\nfunction getTrace(err, type, subType) {\n  return {\n    type: type,\n    subType: subType,\n    name: err.message,\n    errored: true,\n    at: Kadira.syncedDate.getTime(),\n    events: [\n      ['start', 0, {}],\n      ['error', 0, {error: {message: err.message, stack: err.stack}}]\n    ],\n    metrics: {\n      total: 0\n    }\n  };\n}\n","setLabels = function () {\n  // name Session.prototype.send\n  var originalSend = MeteorX.Session.prototype.send;\n  MeteorX.Session.prototype.send = function kadira_Session_send (msg) {\n    return originalSend.call(this, msg);\n  }\n\n  // name Multiplexer initial adds\n  // Multiplexer is undefined in rocket chat\n  if (MeteorX.Multiplexer) {\n    var originalSendAdds = MeteorX.Multiplexer.prototype._sendAdds;\n    MeteorX.Multiplexer.prototype._sendAdds = function kadira_Multiplexer_sendAdds (handle) {\n      return originalSendAdds.call(this, handle);\n    }\n  }\n\n  // name MongoConnection insert\n  var originalMongoInsert = MeteorX.MongoConnection.prototype._insert;\n  MeteorX.MongoConnection.prototype._insert = function kadira_MongoConnection_insert (coll, doc, cb) {\n    return originalMongoInsert.call(this, coll, doc, cb);\n  }\n\n  // name MongoConnection update\n  var originalMongoUpdate = MeteorX.MongoConnection.prototype._update;\n  MeteorX.MongoConnection.prototype._update = function kadira_MongoConnection_update (coll, selector, mod, options, cb) {\n    return originalMongoUpdate.call(this, coll, selector, mod, options, cb);\n  }\n\n  // name MongoConnection remove\n  var originalMongoRemove = MeteorX.MongoConnection.prototype._remove;\n  MeteorX.MongoConnection.prototype._remove = function kadira_MongoConnection_remove (coll, selector, cb) {\n    return originalMongoRemove.call(this, coll, selector, cb);\n  }\n\n  // name Pubsub added\n  var originalPubsubAdded = MeteorX.Session.prototype.sendAdded;\n  MeteorX.Session.prototype.sendAdded = function kadira_Session_sendAdded (coll, id, fields) {\n    return originalPubsubAdded.call(this, coll, id, fields);\n  }\n\n  // name Pubsub changed\n  var originalPubsubChanged = MeteorX.Session.prototype.sendChanged;\n  MeteorX.Session.prototype.sendChanged = function kadira_Session_sendChanged (coll, id, fields) {\n    return originalPubsubChanged.call(this, coll, id, fields);\n  }\n\n  // name Pubsub removed\n  var originalPubsubRemoved = MeteorX.Session.prototype.sendRemoved;\n  MeteorX.Session.prototype.sendRemoved = function kadira_Session_sendRemoved (coll, id) {\n    return originalPubsubRemoved.call(this, coll, id);\n  }\n\n  // name MongoCursor forEach\n  var originalCursorForEach = MeteorX.MongoCursor.prototype.forEach;\n  MeteorX.MongoCursor.prototype.forEach = function kadira_Cursor_forEach () {\n    return originalCursorForEach.apply(this, arguments);\n  }\n\n  // name MongoCursor map\n  var originalCursorMap = MeteorX.MongoCursor.prototype.map;\n  MeteorX.MongoCursor.prototype.map = function kadira_Cursor_map () {\n    return originalCursorMap.apply(this, arguments);\n  }\n\n  // name MongoCursor fetch\n  var originalCursorFetch = MeteorX.MongoCursor.prototype.fetch;\n  MeteorX.MongoCursor.prototype.fetch = function kadira_Cursor_fetch () {\n    return originalCursorFetch.apply(this, arguments);\n  }\n\n  // name MongoCursor count\n  var originalCursorCount = MeteorX.MongoCursor.prototype.count;\n  MeteorX.MongoCursor.prototype.count = function kadira_Cursor_count () {\n    return originalCursorCount.apply(this, arguments);\n  }\n\n  // name MongoCursor observeChanges\n  var originalCursorObserveChanges = MeteorX.MongoCursor.prototype.observeChanges;\n  MeteorX.MongoCursor.prototype.observeChanges = function kadira_Cursor_observeChanges () {\n    return originalCursorObserveChanges.apply(this, arguments);\n  }\n\n  // name MongoCursor observe\n  var originalCursorObserve = MeteorX.MongoCursor.prototype.observe;\n  MeteorX.MongoCursor.prototype.observe = function kadira_Cursor_observe () {\n    return originalCursorObserve.apply(this, arguments);\n  }\n\n  // name CrossBar listen\n  var originalCrossbarListen = DDPServer._Crossbar.prototype.listen;\n  DDPServer._Crossbar.prototype.listen = function kadira_Crossbar_listen (trigger, callback) {\n    return originalCrossbarListen.call(this, trigger, callback);\n  }\n\n  // name CrossBar fire\n  var originalCrossbarFire = DDPServer._Crossbar.prototype.fire;\n  DDPServer._Crossbar.prototype.fire = function kadira_Crossbar_fire (notification) {\n    return originalCrossbarFire.call(this, notification);\n  }\n}\n","export function wrapFastRender () {\n  Meteor.startup(() => {\n    if (Package['staringatlights:fast-render']) {\n      const FastRender = Package['staringatlights:fast-render'].FastRender;\n\n      // Flow Router doesn't call FastRender.route until after all\n      // Meteor.startup callbacks finish\n      let origRoute = FastRender.route\n      FastRender.route = function (path, _callback) {\n        let callback = function () {\n          const info = Kadira._getInfo()\n          if (info) {\n            info.suggestedRouteName = path\n          }\n\n          return _callback.apply(this, arguments)\n        }\n\n        return origRoute.call(FastRender, path, callback)\n      }\n    }\n  });\n}\n","import fs from 'fs';\nconst Fibers = require('fibers');\n\nfunction wrapCallback(args, createWrapper) {\n  if (typeof args[args.length - 1] === 'function') {\n    args[args.length - 1] = createWrapper(args[args.length - 1])\n  }\n}\n\nexport function handleErrorEvent(eventEmitter, trace, event) {\n  function handler (error) {\n    if (trace && event) {\n      Kadira.tracer.eventEnd(trace, event, {\n        error: error\n      });\n    }\n\n    // Node throws the error if there are no listeners\n    // We want it to behave as if we are not listening to it\n    if (eventEmitter.listenerCount('error') === 1) {\n      eventEmitter.removeListener('error', handler);\n      eventEmitter.emit('error', error);\n    }\n  }\n\n  eventEmitter.on('error', handler);\n}\n\nexport function wrapFs() {\n  // Some npm packages will do fs calls in the\n  // callback of another fs call.\n  // This variable is set with the kadiraInfo while\n  // a callback is run so we can track other fs calls\n  let fsKadiraInfo = null;\n  \n  let originalStat = fs.stat;\n  fs.stat = function () {\n    const kadiraInfo = Kadira._getInfo() || fsKadiraInfo;\n\n    if (kadiraInfo) {\n      let event = Kadira.tracer.event(kadiraInfo.trace, 'fs', {\n        func: 'stat',\n        path: arguments[0],\n        options: typeof arguments[1] === 'object' ? arguments[1] : undefined\n      });\n\n      wrapCallback(arguments, (cb) => {\n        return function () {\n          Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n\n          if (!Fibers.current) {\n            fsKadiraInfo = kadiraInfo;\n          }\n\n          try {\n            cb.apply(null, arguments)\n          } finally {\n            fsKadiraInfo = null;\n          }\n        }\n      });\n    }\n\n    return originalStat.apply(fs, arguments);\n  };\n\n  let originalCreateReadStream = fs.createReadStream;\n  fs.createReadStream = function () {\n    const kadiraInfo = Kadira._getInfo() || fsKadiraInfo;\n    let stream = originalCreateReadStream.apply(this, arguments);\n\n    if (kadiraInfo) {\n      const event = Kadira.tracer.event(kadiraInfo.trace, 'fs', {\n        func: 'createReadStream',\n        path: arguments[0],\n        options: JSON.stringify(arguments[1])\n      });\n\n      stream.on('end', () => {\n        Kadira.tracer.eventEnd(kadiraInfo.trace, event);\n      });\n\n      handleErrorEvent(stream, kadiraInfo.trace, event);\n    }\n\n    return stream;\n  };\n}\n","let PerformanceObserver;\nlet constants;\nlet performance;\n\ntry {\n  // Only available in Node 8.5 and newer\n  ({\n    PerformanceObserver,\n    constants,\n    performance\n  } = require('perf_hooks'));\n} catch (e) {}\n\nexport default class GCMetrics {\n  constructor() {\n    this._observer = null;\n    this.started = false;\n    this.metrics = {};\n\n    this.reset();\n  }\n\n  start() {\n    if (this.started) {\n      return false;\n    }\n\n    if (!PerformanceObserver || !constants) {\n      // The node version is too old to have PerformanceObserver\n      return false;\n    }\n\n    this.started = true;\n\n    this.observer = new PerformanceObserver(list => {\n      list.getEntries().forEach(entry => {\n        let metric = this._mapKindToMetric(entry.kind);\n        this.metrics[metric] += entry.duration;\n      });\n\n      // The function was removed in Node 10 since it stopped storing old\n      // entries\n      if (typeof performance.clearGC === 'function') {\n        performance.clearGC();\n      }\n    });\n\n    this.observer.observe({ entryTypes: ['gc'], buffered: false });\n  }\n\n  _mapKindToMetric(gcKind) {\n    switch(gcKind) {\n      case constants.NODE_PERFORMANCE_GC_MAJOR:\n        return 'gcMajor';\n      case constants.NODE_PERFORMANCE_GC_MINOR:\n        return 'gcMinor';\n      case constants.NODE_PERFORMANCE_GC_INCREMENTAL:\n        return 'gcIncremental';\n      case constants.NODE_PERFORMANCE_GC_WEAKCB:\n        return 'gcWeakCB';\n      default:\n        console.log(`Monti APM: Unrecognized GC Kind: ${gcKind}`);\n    }\n  }\n\n  reset() {\n    this.metrics = {\n      gcMajor: 0,\n      gcMinor: 0,\n      gcIncremental: 0,\n      gcWeakCB: 0\n    };\n  }\n}\n","var client;\nvar serverStatus = Object.create(null);\n\nvar otherCheckouts = 0;\n\n// These metrics are only for the mongo pool for the primary Mongo server\nvar primaryCheckouts = 0;\nvar totalCheckoutTime = 0;\nvar maxCheckoutTime = 0;\nvar created = 0;\nvar measurementCount = 0;\nvar pendingTotal = 0;\nvar checkedOutTotal = 0;\n\nsetInterval(() => {\n  let status = getServerStatus(getPrimary(), true);\n\n  if (status) {\n    pendingTotal += status.pending.length;\n    checkedOutTotal += status.checkedOut.size;\n    measurementCount += 1;\n  }\n}, 1000);\n\n// Version 4 of the driver defaults to 100. Older versions used 10.\nvar DEFAULT_MAX_POOL_SIZE = 100;\n\nfunction getPoolSize () {\n  if (client && client.topology && client.topology.s && client.topology.s.options) {\n    return client.topology.s.options.maxPoolSize || DEFAULT_MAX_POOL_SIZE;\n  }\n\n  return 0;\n}\n\nexport function getMongoDriverStats () {\n  return {\n    poolSize: getPoolSize(),\n    primaryCheckouts,\n    otherCheckouts,\n    checkoutTime: totalCheckoutTime,\n    maxCheckoutTime,\n    pending: pendingTotal ? pendingTotal / measurementCount : 0,\n    checkedOut: checkedOutTotal ? checkedOutTotal / measurementCount : 0,\n    created\n  };\n};\n\nexport function resetMongoDriverStats() {\n  primaryCheckouts = 0;\n  otherCheckouts = 0;\n  totalCheckoutTime = 0;\n  maxCheckoutTime = 0;\n  pendingTotal = 0;\n  checkedOutTotal = 0;\n  measurementCount = 0;\n  primaryCheckouts = 0;\n  created = 0;\n}\n\nMeteor.startup(() => {\n  let _client = MongoInternals.defaultRemoteCollectionDriver().mongo.client;\n\n  if (!_client || !_client.s) {\n    // Old version of agent\n    return;\n  }\n\n  let options = _client.s.options || {};\n  let versionParts = MongoInternals.NpmModules.mongodb.version.split('.')\n    .map(part => parseInt(part, 10));\n\n    // Version 4 of the driver removed the option and enabled it by default\n  if (!options.useUnifiedTopology && versionParts[0] < 4) {\n    // CMAP and topology monitoring requires useUnifiedTopology\n    return;\n  }\n\n  // Meteor 1.9 enabled useUnifiedTopology, but CMAP events were only added\n  // in version 3.5 of the driver.\n  if (versionParts[0] === 3 && versionParts[1] < 5) {\n    return;\n  }\n\n  client = _client;\n\n  // Get the number of connections already created\n  let primaryDescription = getServerDescription(getPrimary());\n  if (primaryDescription && primaryDescription.s && primaryDescription.s.pool) {\n    let pool = primaryDescription.s.pool;\n    let totalConnections = pool.totalConnectionCount;\n    let availableConnections = pool.availableConnectionCount;\n\n    // totalConnectionCount counts available connections twice\n    created += totalConnections - availableConnections;\n  }\n\n  client.on('connectionCreated', event => {\n    let primary = getPrimary();\n    if (primary === event.address) {\n      created += 1;\n    }\n  });\n\n  client.on('connectionClosed', event => {\n    let status = getServerStatus(event.address, true);\n    if (status) {\n      status.checkedOut.delete(event.connectionId);\n    }\n  });\n\n  client.on('connectionCheckOutStarted', event => {\n    let status = getServerStatus(event.address);\n    status.pending.push(event.time);\n  });\n\n  client.on('connectionCheckOutFailed', event => {\n    let status = getServerStatus(event.address, true);\n    if (status) {\n      status.pending.shift();\n    }\n  });\n\n  client.on('connectionCheckedOut', event => {\n    let status = getServerStatus(event.address);\n    let start = status.pending.shift();\n    let primary = getPrimary();\n\n    if (start && primary === event.address) {\n      let checkoutDuration = event.time.getTime() - start.getTime();\n\n      primaryCheckouts += 1;\n      totalCheckoutTime += checkoutDuration;\n      if (checkoutDuration > maxCheckoutTime) {\n        maxCheckoutTime = checkoutDuration;\n      }\n    } else {\n      otherCheckouts += 1;\n    }\n\n    status.checkedOut.add(event.connectionId);\n  });\n\n  client.on('connectionCheckedIn', event => {\n    let status = getServerStatus(event.address, true);\n    if (status) {\n      status.checkedOut.delete(event.connectionId);\n    }\n  });\n\n  client.on('serverClosed', function (event) {\n    delete serverStatus[event.address];\n  });\n});\n\nfunction getServerStatus(address, disableCreate) {\n  if (typeof address !== 'string') {\n    return null;\n  }\n\n  if (address in serverStatus) {\n    return serverStatus[address];\n  }\n\n  if (disableCreate) {\n    return null;\n  }\n\n  serverStatus[address] = {\n    pending: [],\n    checkedOut: new Set(),\n  }\n\n  return serverStatus[address];\n}\n\nfunction getPrimary() {\n  if (!client || !client.topology) {\n    return null;\n  }\n  // The driver renamed lastIsMaster in version 4.3.1 to lastHello\n  let server = client.topology.lastIsMaster ?\n    client.topology.lastIsMaster() :\n    client.topology.lastHello();\n\n  if (server.type === 'Standalone') {\n    return server.address;\n  }\n\n  if (!server || !server.primary) {\n    return null;\n  }\n\n  return server.primary;\n}\n\nfunction getServerDescription(address) {\n  if (!client || !client.topology || !client.topology.s || !client.topology.s.servers) {\n    return null;\n  }\n  let description = client.topology.s.servers.get(address);\n\n  return description || null;\n}\n","import Fiber from \"fibers\";\n\nexport function wrapPicker () {\n  Meteor.startup(() => {\n    if (!Package['meteorhacks:picker']) {\n      return;\n    }\n\n    const Picker = Package['meteorhacks:picker'].Picker;\n\n    // Wrap Picker._processRoute to make sure it runs the\n    // handler in a Fiber with __kadiraInfo set\n    // Needed if any previous middleware called `next` outside of a fiber.\n    const origProcessRoute = Picker.constructor.prototype._processRoute;\n    Picker.constructor.prototype._processRoute = function (callback, params, req) {\n      const args = arguments;\n\n      if (!Fiber.current) {\n        return new Fiber(() => {\n          Kadira._setInfo(req.__kadiraInfo)\n          return origProcessRoute.apply(this, args);\n        }).run();\n      }\n      \n      if (req.__kadiraInfo) {\n        Kadira._setInfo(req.__kadiraInfo);\n      }\n\n      return origProcessRoute.apply(this, args);\n    };\n  });\n}\n","import Fibers from 'fibers';\n\nexport function wrapRouters () {\n  let connectRoutes = []\n  try {\n    connectRoutes.push(require('connect-route'));\n  } catch (e) {\n    // We can ignore errors\n  }\n\n  try {\n    if (Package['simple:json-routes']) {\n      // Relative from .npm/node_modules/meteor/montiapm_agent/node_modules\n      // Npm.require is less strict on what paths you use than require\n      connectRoutes.push(Npm.require('../../simple_json-routes/node_modules/connect-route'));\n    }\n  } catch (e) {\n     // we can ignore errors\n  }\n\n  connectRoutes.forEach(connectRoute => {\n    if (typeof connectRoute !== 'function') {\n      return;\n    }\n  \n    connectRoute((router) => {\n      const oldAdd = router.constructor.prototype.add;\n      router.constructor.prototype.add = function (method, route, handler) {\n        // Unlike most routers, connect-route doesn't look at the arguments length\n        oldAdd.call(this, method, route, function () {\n          if (arguments[0] && arguments[0].__kadiraInfo) {\n            arguments[0].__kadiraInfo.suggestedRouteName = route;\n          }\n\n          handler.apply(null, arguments)\n        });\n      }\n    });\n  })\n}\n","import { WebAppInternals, WebApp } from 'meteor/webapp';\nimport Fibers from 'fibers';\n\n// Maximum content-length size\nMAX_BODY_SIZE = 8000\n// Maximum characters for stringified body\nMAX_STRINGIFIED_BODY_SIZE = 4000\n\nconst canWrapStaticHandler = !!WebAppInternals.staticFilesByArch\n\n// This checks if running on a version of Meteor that\n// wraps connect handlers in a fiber.\n// This check is dependant on Meteor's implementation of `use`,\n// which wraps every handler in a new fiber.\n// This will need to be updated if Meteor starts reusing\n// fibers when they exist.\nexport function checkHandlersInFiber () {\n  const handlersLength = WebApp.rawConnectHandlers.stack.length;\n  let inFiber = false;\n  let outsideFiber = Fibers.current;\n\n  WebApp.rawConnectHandlers.use((_req, _res, next) => {\n    inFiber = Fibers.current && Fibers.current !== outsideFiber;\n    \n    // in case we didn't successfully remove this handler\n    // and it is a real request\n    next();\n  });\n\n  if (WebApp.rawConnectHandlers.stack[handlersLength]) {\n    let handler = WebApp.rawConnectHandlers.stack[handlersLength].handle;\n\n    // remove the newly added handler\n    // We remove it immediately so there is no opportunity for\n    // other code to add handlers first if the current fiber is yielded\n    // while running the handler\n    while (WebApp.rawConnectHandlers.stack.length > handlersLength) {\n      WebApp.rawConnectHandlers.stack.pop();\n    }\n\n    handler({}, {}, () => {})\n  }\n\n  return inFiber;\n}\n\nconst InfoSymbol = Symbol()\n\nexport async function wrapWebApp() {\n  if (!checkHandlersInFiber() || !canWrapStaticHandler) {\n    return;\n  }\n\n  const parseUrl = require('parseurl');\n\n  WebAppInternals.registerBoilerplateDataCallback('__montiApmRouteName', function (request) {\n    // TODO: record in trace which arch is used\n\n    if (request[InfoSymbol]) {\n      request[InfoSymbol].isAppRoute = true\n    }\n\n    // Let WebApp know we didn't make changes\n    // so it can use a cache\n    return false\n  })\n\n  // We want the request object returned by categorizeRequest to have\n  // __kadiraInfo\n  let origCategorizeRequest = WebApp.categorizeRequest;\n  WebApp.categorizeRequest = function (req) {\n    let result = origCategorizeRequest.apply(this, arguments);\n\n    if (result && req.__kadiraInfo) {\n      result[InfoSymbol] = req.__kadiraInfo;\n    }\n\n    return result;\n  }\n\n  // Adding the handler directly to the stack\n  // to force it to be the first one to run\n  WebApp.rawConnectHandlers.stack.unshift({\n    route: '',\n    handle: (req, res, next) => {\n    const name = parseUrl(req).pathname;\n    const trace = Kadira.tracer.start(`${req.method}-${name}`, 'http');\n\n    const headers = Kadira.tracer._applyObjectFilters(req.headers);\n    Kadira.tracer.event(trace, 'start', {\n      url: req.url,\n      method: req.method,\n      headers: JSON.stringify(headers),\n    });\n    req.__kadiraInfo = { trace };\n\n    res.on('finish', () => {\n      if (req.__kadiraInfo.asyncEvent) {\n        Kadira.tracer.eventEnd(trace, req.__kadiraInfo.asyncEvent);\n      }\n\n      Kadira.tracer.endLastEvent(trace);\n\n      if (req.__kadiraInfo.isStatic) {\n        trace.name = `${req.method}-<static file>`\n      } else if (req.__kadiraInfo.suggestedRouteName) {\n        trace.name = `${req.method}-${req.__kadiraInfo.suggestedRouteName}`\n      } else if (req.__kadiraInfo.isAppRoute) {\n        trace.name = `${req.method}-<app>`\n      }\n\n      const isJson = req.headers['content-type'] === 'application/json';\n      const hasSmallBody = req.headers['content-length'] > 0 && req.headers['content-length'] < MAX_BODY_SIZE\n\n      // Check after all middleware have run to see if any of them\n      // set req.body\n      // Technically bodies can be used with any method, but since many load balancers and\n      // other software only support bodies for POST requests, we are\n      // not recording the body for other methods.\n      if (req.method === 'POST' && req.body && isJson && hasSmallBody) {\n        try {\n          let body = JSON.stringify(req.body);\n\n          // Check the body size again in case it is much\n          // larger than what was in the content-length header\n          if (body.length < MAX_STRINGIFIED_BODY_SIZE) {\n            trace.events[0].data.body = body;\n          }\n        } catch (e) {\n          // It is okay if this fails\n        }\n      }\n\n      // TODO: record status code\n      Kadira.tracer.event(trace, 'complete');\n      let built = Kadira.tracer.buildTrace(trace);\n      Kadira.models.http.processRequest(built, req, res);\n    });\n\n    next();\n  }\n});\n\n\n  function wrapHandler(handler) {\n    // connect identifies error handles by them accepting\n    // four arguments\n    let errorHandler = handler.length === 4;\n\n    function wrapper(req, res, next) {\n      let error;\n      if (errorHandler) {\n        error = req;\n        req = res;\n        res = next;\n        next = arguments[3]\n      }\n\n      const kadiraInfo = req.__kadiraInfo;\n      Kadira._setInfo(kadiraInfo);\n\n      let nextCalled = false;\n      // TODO: track errors passed to next or thrown\n      function wrappedNext(...args) {\n        if (kadiraInfo && kadiraInfo.asyncEvent) {\n          Kadira.tracer.eventEnd(req.__kadiraInfo.trace, req.__kadiraInfo.asyncEvent);\n          req.__kadiraInfo.asyncEvent = null;\n        }\n\n        nextCalled = true;\n        next(...args)\n      }\n\n      let potentialPromise\n\n      if (errorHandler) {\n        potentialPromise = handler.call(this, error, req, res, wrappedNext);\n      } else {\n        potentialPromise = handler.call(this, req, res, wrappedNext);\n      }\n\n      if (potentialPromise && typeof potentialPromise.then === 'function') {\n        potentialPromise.then(() => {\n          // res.finished is depreciated in Node 13, but it is the only option\n          // for Node 12.9 and older.\n          if (kadiraInfo && !res.finished && !nextCalled) {\n            const lastEvent = Kadira.tracer.getLastEvent(kadiraInfo.trace)\n            if (lastEvent.endAt) {\n              // req is not done, and next has not been called\n              // create an async event that will end when either of those happens\n              kadiraInfo.asyncEvent = Kadira.tracer.event(kadiraInfo.trace, 'async');\n            }\n          }\n        });\n      }\n\n      return potentialPromise;\n    }\n\n    if (errorHandler) {\n      return function (error, req, res, next) {\n        return wrapper(error, req, res, next);\n      }\n    } else {\n      return function (req, res, next) {\n        return wrapper(req, res, next);\n      }\n    }\n  }\n\n  function wrapConnect(app, wrapStack) {\n    let oldUse = app.use;\n    if (wrapStack) {\n      // We need to set kadiraInfo on the Fiber the handler will run in.\n      // Meteor has already wrapped the handler to run it in a new Fiber\n      // by using Promise.asyncApply so we are not able to directly set it\n      // on that Fiber. \n      // Meteor's promise library copies properties from the current fiber to\n      // the new fiber, so we can wrap it in another Fiber with kadiraInfo set\n      // and Meteor will copy kadiraInfo to the new Fiber.\n      // It will only create the additional Fiber if it isn't already running in a Fiber\n      app.stack.forEach(entry => {\n        let wrappedHandler = wrapHandler(entry.handle)\n        if (entry.handle.length >= 4) {\n          entry.handle = function (error, req, res, next) {\n            return Promise.asyncApply(\n              wrappedHandler,\n              this,\n              arguments,\n              true\n            );\n          };\n        } else {\n          entry.handle = function (req, res, next) {\n            return Promise.asyncApply(\n              wrappedHandler,\n              this,\n              arguments,\n              true\n            )\n          }\n        }\n      });\n    }\n    app.use = function (...args) {\n      args[args.length - 1] = wrapHandler(args[args.length - 1])\n      return oldUse.apply(app, args);\n    }\n  }\n\n  wrapConnect(WebApp.rawConnectHandlers, false);\n  wrapConnect(WebAppInternals.meteorInternalHandlers, false);\n\n  // The oauth package and other core packages might have already added their middleware,\n  // so we need to wrap the existing middleware\n  wrapConnect(WebApp.connectHandlers, true);\n\n  wrapConnect(WebApp.connectApp, false);\n\n  let oldStaticFilesMiddleware = WebAppInternals.staticFilesMiddleware;\n  const staticHandler = wrapHandler(oldStaticFilesMiddleware.bind(WebAppInternals, WebAppInternals.staticFilesByArch));\n  WebAppInternals.staticFilesMiddleware = function (_staticFiles, req, res, next) {\n    if (req.__kadiraInfo) {\n      req.__kadiraInfo.isStatic = true;\n    }\n\n    return staticHandler(req, res, function () {\n      // if the request is for a static file, the static handler will end the response\n      // instead of calling next\n      req.__kadiraInfo.isStatic = false;\n      return next.apply(this, arguments);\n    });\n  };\n}\n","function normalizedPrefix (name) {\n  return name.replace('KADIRA_', 'MONTI_');\n}\n\nKadira._parseEnv = function (env) {\n  var options = {};\n  for(var name in env) {\n    var value = env[name];\n    var normalizedName = normalizedPrefix(name);\n    var info = Kadira._parseEnv._options[normalizedName];\n\n    if(info && value) {\n      options[info.name] = info.parser(value);\n    }\n  }\n\n  return options;\n};\n\n\nKadira._parseEnv.parseInt = function (str) {\n  var num = parseInt(str);\n  if(num || num === 0) return num;\n  throw new Error('Kadira: Match Error: \"'+num+'\" is not a number');\n};\n\n\nKadira._parseEnv.parseBool = function (str) {\n  str = str.toLowerCase();\n  if(str === 'true') return true;\n  if(str === 'false') return false;\n  throw new Error('Kadira: Match Error: '+str+' is not a boolean');\n};\n\n\nKadira._parseEnv.parseUrl = function (str) {\n  return str;\n};\n\n\nKadira._parseEnv.parseString = function (str) {\n  return str;\n};\n\n\nKadira._parseEnv._options = {\n  // auth\n  MONTI_APP_ID: {\n    name: 'appId',\n    parser: Kadira._parseEnv.parseString\n  },\n  MONTI_APP_SECRET: {\n    name: 'appSecret',\n    parser: Kadira._parseEnv.parseString\n  },\n  // delay to send the initial ping to the kadira engine after page loads\n  MONTI_OPTIONS_CLIENT_ENGINE_SYNC_DELAY: {\n    name: 'clientEngineSyncDelay',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // time between sending errors to the engine\n  MONTI_OPTIONS_ERROR_DUMP_INTERVAL: {\n    name: 'errorDumpInterval',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // no of errors allowed in a given interval\n  MONTI_OPTIONS_MAX_ERRORS_PER_INTERVAL: {\n    name: 'maxErrorsPerInterval',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // a zone.js specific option to collect the full stack trace(which is not much useful)\n  MONTI_OPTIONS_COLLECT_ALL_STACKS: {\n    name: 'collectAllStacks',\n    parser: Kadira._parseEnv.parseBool,\n  },\n  // enable error tracking (which is turned on by default)\n  MONTI_OPTIONS_ENABLE_ERROR_TRACKING: {\n    name: 'enableErrorTracking',\n    parser: Kadira._parseEnv.parseBool,\n  },\n  // kadira engine endpoint\n  MONTI_OPTIONS_ENDPOINT: {\n    name: 'endpoint',\n    parser: Kadira._parseEnv.parseUrl,\n  },\n  // define the hostname of the current running process\n  MONTI_OPTIONS_HOSTNAME: {\n    name: 'hostname',\n    parser: Kadira._parseEnv.parseString,\n  },\n  // interval between sending data to the kadira engine from the server\n  MONTI_OPTIONS_PAYLOAD_TIMEOUT: {\n    name: 'payloadTimeout',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // set HTTP/HTTPS proxy\n  MONTI_OPTIONS_PROXY: {\n    name: 'proxy',\n    parser: Kadira._parseEnv.parseUrl,\n  },\n  // number of items cached for tracking document size\n  MONTI_OPTIONS_DOCUMENT_SIZE_CACHE_SIZE: {\n    name: 'documentSizeCacheSize',\n    parser: Kadira._parseEnv.parseInt,\n  },\n  // enable uploading sourcemaps\n  MONTI_UPLOAD_SOURCE_MAPS: {\n    name: 'uploadSourceMaps',\n    parser: Kadira._parseEnv.parseBool\n  },\n  MONTI_RECORD_IP_ADDRESS: {\n    name: 'recordIPAddress',\n    parser: Kadira._parseEnv.parseString,\n  },\n  MONTI_EVENT_STACK_TRACE: {\n    name: 'eventStackTrace',\n    parser: Kadira._parseEnv.parseBool,\n  }\n};\n","Kadira._connectWithEnv = function() {\n  var options = Kadira._parseEnv(process.env);\n  if(options.appId && options.appSecret) {\n\n    Kadira.connect(\n      options.appId,\n      options.appSecret,\n      options\n    );\n\n    Kadira.connect = function() {\n      throw new Error('Kadira has been already connected using credentials from Environment Variables');\n    };\n  }\n};\n\n\nKadira._connectWithSettings = function () {\n  var montiSettings = Meteor.settings.monti || Meteor.settings.kadira\n\n  if(\n    montiSettings &&\n    montiSettings.appId &&\n    montiSettings.appSecret\n  ) {\n    Kadira.connect(\n      montiSettings.appId,\n      montiSettings.appSecret,\n      montiSettings.options || {}\n    );\n\n    Kadira.connect = function() {\n      throw new Error('Kadira has been already connected using credentials from Meteor.settings');\n    };\n  }\n};\n\n\n// Try to connect automatically\nKadira._connectWithEnv();\nKadira._connectWithSettings();\n","import { Meteor } from 'meteor/meteor';\n\nconst conflictingPackages = [\n  'mdg:meteor-apm-agent',\n  'lmachens:kadira',\n  'meteorhacks:kadira'\n];\n\nMeteor.startup(() => {\n  conflictingPackages.forEach(name => {\n    if (name in Package) {\n      console.log(\n        `Monti APM: your app is using the ${name} package. Using more than one APM agent in an app can cause unexpected problems.`\n      );\n    }\n  });\n});\n"]}